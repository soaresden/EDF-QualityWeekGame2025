<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.25, viewport-fit=cover, user-scalable=yes">
  <title>Quality Inspector - EDF</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;900&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
    body { font-family: 'Poppins', sans-serif; background: #0a0e27; color: #ccc; overflow: hidden; height: 100vh; touch-action: manipulation; }
    
    canvas { 
      touch-action: none;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
    }

    .header {
      background: linear-gradient(90deg, #0254A0 0%, #00A8E9 100%);
      color: white;
      padding: 8px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.4);
      border-bottom: 3px solid #00A8E9;
      height: 45px;
    }

    .header-left h1 { font-size: 1.2rem; margin-bottom: 0; }
    .header-right { text-align: right; font-size: 0.85rem; }

    .timer-bar-full {
      background: linear-gradient(90deg, #0254A0 0%, #00A8E9 100%);
      border-bottom: 2px solid #00A8E9;
      padding: 12px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 20px;
      box-shadow: 0 4px 20px rgba(0, 168, 233, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }

    .windmill {
      font-size: 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      min-width: 50px;
    }

    .windmill-blades {
      width: 40px;
      height: 40px;
      animation: windmill-spin 3s linear infinite;
    }

    @keyframes windmill-spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .windmill-wind {
      font-size: 1.2rem;
      animation: wind-wave 0.6s ease-in-out infinite;
    }

    @keyframes wind-wave {
      0%, 100% { opacity: 0.3; transform: translateX(-2px); }
      50% { opacity: 1; transform: translateX(2px); }
    }

    .timer-display { 
      font-size: 2.5rem; 
      font-weight: 900; 
      color: #FFD700;
      min-width: 120px;
      font-family: 'Courier New', monospace;
      letter-spacing: 3px;
      animation: electric-pulse 0.4s ease-in-out infinite;
      filter: drop-shadow(0 0 12px rgba(255, 215, 0, 0.9)) drop-shadow(0 0 6px rgba(255, 215, 0, 0.5));
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
    }

    @keyframes electric-pulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.15); opacity: 0.95; }
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    .timer-bar { 
      flex: 1;
      height: 22px; 
      background: rgba(0, 0, 0, 0.5); 
      border-radius: 15px; 
      overflow: hidden; 
      border: 2px solid rgba(0, 168, 233, 0.4);
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.6);
      position: relative;
    }

    .timer-bar::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: transparent;
      z-index: 0;
    }

    @keyframes wave-animation {
      0% { background-position: 0 0, 20px 0, 40px 0; }
      100% { background-position: 80px 0, 100px 0, 120px 0; }
    }

    .timer-fill { 
      height: 100%; 
      width: 100%; 
      background: linear-gradient(90deg, #0254A0 0%, #00A8E9 30%, #00D4FF 60%, #0254A0 100%);
      background-size: 200% 100%;
      animation: gradient-flow 3s linear infinite;
      transition: width 0.1s linear;
      box-shadow: 
        0 0 20px rgba(0, 168, 233, 0.8),
        inset 0 1px 2px rgba(255, 255, 255, 0.3),
        inset 0 -1px 2px rgba(0, 0, 0, 0.5);
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: center;
      padding: 0 8px;
    }

    .timer-fill::before {
      content: '';
      position: absolute;
      inset: 0;
      background: transparent;
      z-index: 1;
    }

    .wind-effect {
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.3);
      font-weight: bold;
      letter-spacing: -2px;
      animation: wind-flow 2s linear infinite;
      white-space: nowrap;
      z-index: 2;
      position: relative;
    }

    @keyframes wind-flow {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    @keyframes gradient-flow {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    .timer-fill::after {
      content: '';
      position: absolute;
      right: 0;
      top: 0;
      bottom: 0;
      width: 30px;
      background: linear-gradient(90deg, transparent, rgba(0, 212, 255, 0.6), rgba(0, 168, 233, 0.3));
      filter: blur(8px);
      animation: edge-glow 1s ease-in-out infinite;
      z-index: 2;
    }

    @keyframes edge-glow {
      0% { opacity: 0.5; }
      50% { opacity: 1; }
      100% { opacity: 0.5; }
    }

    .stat-item { text-align: center; }
    .stat-label { font-size: 0.65rem; color: #888; text-transform: uppercase; margin-bottom: 2px; }
    .stat-val { 
      font-size: 1.4rem; 
      font-weight: bold; 
      color: #10B981;
      text-shadow: 0 0 8px rgba(16, 185, 129, 0.5);
    }
    .stat-val.warning { color: #FF5716; text-shadow: 0 0 8px rgba(245, 158, 11, 0.5); }
    .stat-val.danger { color: #EF4444; text-shadow: 0 0 8px rgba(239, 68, 68, 0.5); }

    .main-container {
      display: grid;
      grid-template-columns: 1fr 200px;
      height: calc(100vh - 85px);
      gap: 0;
    }

    .left-panel {
      background: linear-gradient(135deg, #0a0e27 0%, #1a1f2e 100%);
      border-right: 2px solid #10B981;
      padding: 20px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 15px;
      align-items: center;
      justify-content: center;
    }

    .center-area {
      background: linear-gradient(135deg, #0a0e27 0%, #1a1f2e 100%);
      display: flex;
      flex-direction: column;
      align-items: stretch;
      justify-content: flex-start;
      position: relative;
      padding: 15px;
      gap: 8px;
      border-left: 2px solid #00A8E9;
      border-right: 2px solid #10B981;
      height: calc(100vh - 85px);
    }

    .inspection-content {
      display: flex;
      gap: 12px;
      flex: 1;
      min-height: 0;
    }

    .inspection-title {
      font-size: 1.2rem;
      font-weight: 900;
      color: #FFD700;
      text-align: center;
      padding: 6px 12px;
      margin-bottom: 4px;
      letter-spacing: 1px;
      text-transform: uppercase;
      text-shadow: 0 0 15px rgba(255, 215, 0, 0.8), 0 0 30px rgba(255, 215, 0, 0.4);
      animation: title-glow 2s ease-in-out infinite;
      background: linear-gradient(90deg, rgba(2, 84, 160, 0.3) 0%, rgba(0, 168, 233, 0.3) 100%);
      border-bottom: 2px solid #FFD700;
      border-radius: 8px 8px 0 0;
    }

    @keyframes title-glow {
      0%, 100% { text-shadow: 0 0 15px rgba(255, 215, 0, 0.8), 0 0 30px rgba(255, 215, 0, 0.4); }
      50% { text-shadow: 0 0 20px rgba(255, 215, 0, 1), 0 0 40px rgba(255, 215, 0, 0.6); }
    }

    .canvas-container {
      position: relative;
      width: 100%;
      flex: 1;
      z-index: 10;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 4px;
      max-height: calc(100vh - 200px);
      padding: 8px;
      background: rgba(0, 168, 233, 0.05);
      border: 2px solid rgba(0, 168, 233, 0.3);
      border-radius: 8px;
    }

    @keyframes product-transition {
      0% { 
        opacity: 0;
        transform: scale(0.9);
      }
      50% {
        opacity: 0.5;
        transform: scale(1.05);
      }
      100% { 
        opacity: 1;
        transform: scale(1);
      }
    }

    .magnifier-info {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 8px 12px;
      background: rgba(255, 215, 0, 0.1);
      border: 2px solid rgba(255, 215, 0, 0.3);
      border-radius: 6px;
      margin-bottom: 8px;
      width: 100%;
    }

    .btn {
      padding: 14px 12px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 900;
      font-size: 0.9rem;
      transition: all 0.3s;
      text-transform: uppercase;
      letter-spacing: 1px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      flex: 1;
      min-height: 50px;
    }

    .btn.reject {
      background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
      color: white;
      border: 1px solid #DC2626;
    }

    .btn.reject:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
    }

    .btn.approve {
      background: linear-gradient(135deg, #10B981 0%, #059669 100%);
      color: white;
      border: 1px solid #059669;
    }

    .btn.approve:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
    }

    .magnifier-circle {
      position: fixed;
      width: 150px;
      height: 150px;
      border: 3px solid #FF5716;
      border-radius: 50%;
      background: transparent;
      pointer-events: none;
      z-index: 100;
      transform: translate(-50%, -50%);
      display: none;
    }

    .magnifier-circle::before {
      content: '';
      position: absolute;
      width: 3px;
      height: 50px;
      background: #FF5716;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
    }

    .magnifier-circle::after {
      content: '';
      position: absolute;
      width: 50px;
      height: 3px;
      background: #FF5716;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
    }

    .defect-emoji {
      position: absolute;
      font-size: 1.8rem;
      pointer-events: none;
      animation: popDefect 0.4s ease-out forwards;
      cursor: default;
    }

    @keyframes popDefect {
      0% { transform: scale(0) rotate(0deg); opacity: 0; }
      100% { transform: scale(1) rotate(360deg); opacity: 1; }
    }

    .status-message {
      font-size: 1.1rem;
      font-weight: bold;
      color: #ccc;
    }

    .status-score {
      font-size: 1.3rem;
      font-weight: bold;
      margin-top: 5px;
    }

    .status-score.good { color: #10B981; }
    .status-score.bad { color: #EF4444; }

    .kpi-section {
      background: rgba(0, 168, 233, 0.2);
      border: 2px solid #00A8E9;
      border-radius: 8px;
      padding: 12px 8px;
      flex: 0 0 auto;
      text-align: center;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .kpi-section.inspected {
      background: rgba(128, 128, 128, 0.2);
      border-color: #808080;
    }

    .kpi-section.well {
      background: rgba(16, 185, 129, 0.2);
      border-color: #10B981;
    }

    .kpi-section.quality {
      background: rgba(255, 140, 0, 0.2);
      border-color: #FF8C00;
    }

    .kpi-section.quality.high {
      background: rgba(255, 215, 0, 0.2);
      border-color: #FFD700;
    }

    .kpi-section-title {
      font-size: 0.65rem;
      font-weight: 900;
      color: #FFD700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin: 0;
    }

    .kpi-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0;
      padding: 0;
    }

    .kpi-item:last-child {
      margin-bottom: 0;
    }

    .kpi-label {
      font-size: 0.6rem;
      color: #999;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.3px;
      margin-bottom: 2px;
    }

    .kpi-value {
      font-size: 1.8rem;
      font-weight: 900;
      color: #10B981;
      font-family: 'Courier New', monospace;
      text-shadow: 0 0 10px rgba(16, 185, 129, 0.4);
      line-height: 1;
    }

    .kpi-value.inspected {
      color: #808080;
      text-shadow: 0 0 10px rgba(128, 128, 128, 0.4);
    }

    .kpi-value.well {
      color: #10B981;
      text-shadow: 0 0 10px rgba(16, 185, 129, 0.4);
    }

    .kpi-value.quality {
      color: #FF8C00;
      text-shadow: 0 0 10px rgba(255, 140, 0, 0.4);
    }

    .kpi-value.quality.high {
      color: #FFD700;
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.6);
    }

    .quality-smiley {
      font-size: 2.5rem;
      text-align: center;
      margin-top: 8px;
      animation: bounce 2s infinite;
    }

    .shewart-chart {
      width: 100%;
      height: 90px;
      background: rgba(0, 0, 0, 0.4);
      border-radius: 6px;
      border: 1px solid #10B981;
      position: relative;
      margin-top: 8px;
    }

    .rules-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 9999;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .rules-modal.active {
      display: flex;
    }

    .rules-content {
      background: linear-gradient(135deg, #0254A0 0%, #00A8E9 100%);
      border: 3px solid #FFD700;
      border-radius: 15px;
      padding: 30px;
      max-width: 900px;
      max-height: 90vh;
      overflow-y: auto;
      color: white;
      box-shadow: 0 0 40px rgba(255, 215, 0, 0.6);
    }

    .rules-content h1 {
      text-align: center;
      font-size: 2.2rem;
      margin-bottom: 20px;
      color: #FFD700;
      text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
    }

    .rules-section {
      margin-bottom: 25px;
      padding: 15px;
      background: rgba(0, 0, 0, 0.3);
      border-left: 4px solid #FFD700;
      border-radius: 8px;
    }

    .rules-section h2 {
      color: #00D4FF;
      font-size: 1.3rem;
      margin-bottom: 10px;
    }

    .rules-section p {
      font-size: 1rem;
      line-height: 1.6;
      margin: 8px 0;
    }

    .scoring-table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
      background: rgba(0, 0, 0, 0.2);
      border: 2px solid #FFD700;
      border-radius: 8px;
      overflow: hidden;
    }

    .scoring-table th {
      background: linear-gradient(90deg, #0254A0, #00A8E9);
      color: #FFD700;
      padding: 12px;
      text-align: left;
      font-weight: 900;
      border-bottom: 2px solid #FFD700;
    }

    .scoring-table td {
      padding: 10px 12px;
      border-bottom: 1px solid rgba(255, 215, 0, 0.2);
      color: #fff;
    }

    .scoring-table tr:hover {
      background: rgba(255, 215, 0, 0.1);
    }

    .grade-s { color: #FF1493; font-weight: 900; }
    .grade-a { color: #00BFFF; font-weight: 900; }
    .grade-b { color: #00FF00; font-weight: 900; }
    .grade-c { color: #ADFF2F; font-weight: 900; }
    .grade-d { color: #FF8C00; font-weight: 900; }
    .grade-e { color: #C0C0C0; font-weight: 900; }

    .rules-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 25px;
    }

    .rules-buttons button {
      padding: 12px 30px;
      font-size: 1rem;
      font-weight: 900;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 1px;
      transition: all 0.3s;
    }

    .btn-start-game {
      background: linear-gradient(135deg, #10B981, #059669);
      color: white;
      border: 2px solid #10B981;
    }

    .btn-start-game:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(16, 185, 129, 0.6);
    }

    .btn-close-rules {
      background: rgba(255, 87, 22, 0.8);
      color: white;
      border: 2px solid #FF5716;
    }

    .btn-close-rules:hover {
      background: rgba(255, 87, 22, 1);
      transform: translateY(-2px);
    }
      background: linear-gradient(135deg, #6B7280 0%, #4B5563 100%);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 900;
      font-size: 0.85rem;
      transition: all 0.3s;
      margin-top: auto;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .quit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
      background: linear-gradient(135deg, #5a6470 0%, #3a445a 100%);
    }

    .btn { padding: 12px 8px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 0.85rem; transition: all 0.2s; text-transform: uppercase; }
    .btn.reject { background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%); color: white; border: 1px solid #DC2626; }
    .btn.reject:hover { transform: translateY(-2px); }
    .btn.approve { background: linear-gradient(135deg, #10B981 0%, #059669 100%); color: white; border: 1px solid #059669; }
    .btn.approve:hover { transform: translateY(-2px); }

    .modal h1 { color: #00A8E9; margin-bottom: 20px; font-size: 1.8rem; }
    .modal p { color: #ccc; line-height: 1.6; margin-bottom: 16px; }

    .btn-primary {
      background: linear-gradient(135deg, #00A8E9, #009bcf);
      color: white;
      border: none;
      padding: 14px 32px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      font-size: 1rem;
      width: 100%;
      margin-top: 16px;
      transition: all 0.2s;
    }

    .btn-primary:hover:not(:disabled) { transform: translateY(-2px); }
    .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }

    input {
      width: 100%;
      padding: 12px;
      border: 2px solid #00A8E9;
      background: #0f1419;
      color: white;
      border-radius: 6px;
      font-size: 1rem;
      margin-bottom: 16px;
      font-family: 'Courier New', monospace;
    }

    input:focus { outline: none; box-shadow: 0 0 0 3px rgba(0, 168, 233, 0.3); }

    .rank-timeline {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 8px;
      margin: 30px 0;
      padding: 20px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
    }

    .rank-node {
      padding: 12px;
      border-radius: 6px;
      text-align: center;
      border: 2px solid #333;
      background: rgba(255, 255, 255, 0.05);
    }

    .rank-node.e { border-color: #EF4444; background: rgba(239, 68, 68, 0.1); }
    .rank-node.d { border-color: #00A8E9; background: rgba(0, 168, 233, 0.1); }
    .rank-node.c { border-color: #10B981; background: rgba(16, 185, 129, 0.1); }
    .rank-node.b { border-color: #FF5716; background: rgba(245, 158, 11, 0.1); }
    .rank-node.a { border-color: #FF6B00; background: rgba(255, 107, 0, 0.1); }
    .rank-node.s { border-color: #FFD700; background: rgba(255, 215, 0, 0.1); }

    .rank-node.active {
      box-shadow: 0 0 20px currentColor;
      transform: scale(1.15);
      border-color: currentColor;
    }

    .rank-node.active.e { color: #EF4444; }
    .rank-node.active.d { color: #00A8E9; }
    .rank-node.active.c { color: #10B981; }
    .rank-node.active.b { color: #FF5716; }
    .rank-node.active.a { color: #FF6B00; }
    .rank-node.active.s { color: #FFD700; }

    .rank-letter { font-size: 2rem; font-weight: bold; }
    .rank-name { font-size: 0.7rem; color: #999; margin-top: 4px; }

    .performance-message {
      background: rgba(0, 168, 233, 0.15);
      border: 2px solid #00A8E9;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
      text-align: center;
      font-size: 1.1rem;
      color: #ccc;
      min-height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }

    .performance-emoji { font-size: 2.5rem; margin-bottom: 10px; }

    .leaderboard-table { width: 100%; margin-top: 20px; border-collapse: collapse; }
    .leaderboard-table th, .leaderboard-table td { padding: 12px; text-align: left; border-bottom: 1px solid #333; color: #ccc; }
    .leaderboard-table th { background: #0254A0; color: white; }
    .leaderboard-table tr:hover { background: rgba(0, 168, 233, 0.1); }

    .leaderboard-container {
      background: rgba(0, 0, 0, 0.3);
      border: 3px solid #FFD700;
      border-radius: 15px;
      padding: 30px;
      max-width: 950px;
      width: 95%;
      max-height: 90vh;
      overflow-y: auto;
    }

    .leaderboard-layout {
      display: grid;
      grid-template-columns: 35% 65%;
      gap: 30px;
      margin-bottom: 20px;
    }

    .leaderboard-left {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .your-score-box {
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(0, 168, 233, 0.2));
      border: 3px solid #FFD700;
      border-radius: 12px;
      padding: 25px;
      text-align: center;
      width: 100%;
    }

    .score-title {
      color: #FFD700;
      font-size: 0.8rem;
      font-weight: 900;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 10px;
    }

    .score-emoji {
      font-size: 3rem;
      margin-bottom: 15px;
    }

    .score-text {
      color: #00A8E9;
      font-weight: 900;
      font-size: 1.1rem;
      margin-bottom: 10px;
    }

    .score-value {
      color: #10B981;
      font-weight: 900;
      font-size: 2.5rem;
      text-shadow: 0 0 20px rgba(16, 185, 129, 0.6);
      margin-bottom: 10px;
    }

    .score-ratio {
      color: #FFD700;
      font-weight: 700;
      font-size: 0.95rem;
    }

    .leaderboard-right {
      background: rgba(0, 0, 0, 0.5);
      border: 2px solid #00A8E9;
      border-radius: 10px;
      padding: 15px;
      max-height: 500px;
      overflow-y: auto;
    }

    .leaderboard-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .leaderboard-row {
      display: grid;
      grid-template-columns: 50px 1fr 80px 50px;
      gap: 10px;
      padding: 18px;
      background: rgba(0, 168, 233, 0.1);
      border-radius: 6px;
      align-items: center;
      border-left: 3px solid #00A8E9;
      transition: all 0.2s;
      min-height: 50px;
    }

    .leaderboard-row:hover {
      background: rgba(0, 168, 233, 0.2);
      border-left-color: #FFD700;
    }

    .leaderboard-row.highlight {
      background: linear-gradient(90deg, rgba(255, 215, 0, 0.3), rgba(0, 168, 233, 0.2));
      border-left-color: #FFD700;
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
    }

    .leaderboard-rank {
      font-weight: 900;
      color: #FFD700;
      font-size: 1.1rem;
      text-align: center;
    }

    .leaderboard-name {
      color: #ccc;
      font-weight: 700;
      overflow: hidden;
      text-overflow: ellipsis;
      font-size: 1.1rem;
    }

    .leaderboard-score {
      color: #10B981;
      font-weight: 900;
      text-align: right;
      font-size: 1.3rem;
    }

    .leaderboard-grade {
      color: #FFD700;
      font-weight: 900;
      text-align: center;
      font-size: 0.9rem;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin: 20px 0;
      background: rgba(0, 168, 233, 0.1);
      padding: 15px;
      border-radius: 8px;
    }

    .stat-box { text-align: center; }
    .stat-box-label { font-size: 0.85rem; color: #999; text-transform: uppercase; margin-bottom: 8px; }
    .stat-box-value { font-size: 1.5rem; font-weight: bold; color: #10B981; }

    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: #0f1419; }
    ::-webkit-scrollbar-thumb { background: #00A8E9; border-radius: 3px; }

    @keyframes heartbeat {
      0%, 100% { transform: scale(1); }
      25% { transform: scale(1.1); }
      50% { transform: scale(1.2); }
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
    @keyframes slideLeft { from { opacity: 0; transform: translateX(-50px); } to { opacity: 1; transform: translateX(0); } }
    @keyframes slideRight { from { opacity: 0; transform: translateX(50px); } to { opacity: 1; transform: translateX(0); } }
    50% { box-shadow: 0 15px 60px rgba(255,87,22,0.7); transform: scale(1.05); } }
    @keyframes firework { 0% { transform: translate(0, 0) scale(1); opacity: 1; } 100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; } }
    .firework { position: absolute; width: 10px; height: 10px; border-radius: 50%; pointer-events: none; }

    .overlay-start-inspecting {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.45);
      display: none;
      align-items: flex-end;
      justify-content: center;
      z-index: 200;
      backdrop-filter: blur(3px);
    }

    .overlay-start-inspecting.active {
      display: flex;
    }

    .start-inspecting-content {
      background: linear-gradient(135deg, #0254A0 0%, #1a2f4f 100%);
      border: 3px solid #00A8E9;
      border-radius: 16px 16px 0 0;
      padding: 30px 50px;
      text-align: center;
      box-shadow: 0 0 40px rgba(0, 168, 233, 0.5), inset 0 0 20px rgba(0, 168, 233, 0.2);
      max-width: 95%;
      width: 100%;
      max-height: 40vh;
      animation: slideUp 0.35s cubic-bezier(0.16, 1, 0.3, 1);
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 15px;
    }

    @keyframes slideUp {
      from { 
        transform: translateY(100%); 
        opacity: 0; 
      }
      to { 
        transform: translateY(0); 
        opacity: 1; 
      }
    }

    .start-inspecting-content h2 {
      font-size: 1.5rem;
      color: #00A8E9;
      margin: 0;
      text-shadow: 0 0 10px rgba(0, 168, 233, 0.6);
      font-weight: 700;
    }

    .start-inspecting-content p {
      font-size: 0.95rem;
      color: #ddd;
      margin: 0;
      line-height: 1.5;
      font-weight: 400;
    }

    .start-inspecting-buttons {
      display: flex;
      gap: 20px;
      justify-content: center;
      margin-top: 10px;
    }

    .start-inspecting-buttons button {
      padding: 12px 35px;
      font-size: 0.95rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 700;
      transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .start-inspecting-buttons .btn-yes {
      background: linear-gradient(135deg, #10B981 0%, #059669 100%);
      color: white;
      border: 2px solid #10B981;
    }

    .start-inspecting-buttons .btn-yes:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(16, 185, 129, 0.6);
    }

    .start-inspecting-buttons .btn-no {
      background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
      color: white;
      border: 2px solid #EF4444;
    }

    .start-inspecting-buttons .btn-no:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(239, 68, 68, 0.6);
    }

    .collapsible-header {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      user-select: none;
      transition: all 0.3s ease;
      padding: 12px;
      font-size: 1.3rem;
      font-weight: 700;
      margin: 0;
      flex-wrap: wrap;
    }

    .collapsible-header:hover { transform: translateX(3px); }

    .chevron {
      font-size: 1.2rem;
      transition: transform 0.3s ease;
      display: inline-block;
    }

    .chevron.collapsed { transform: rotate(-90deg); }

    .collapsible-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease, opacity 0.3s ease, padding 0.3s ease;
      opacity: 0;
      margin: 0;
      padding: 0 !important;
    }

    .collapsible-content.collapsed {
      max-height: 0;
      opacity: 0;
      padding: 0 !important;
      overflow: hidden;
    }

    .collapsible-content:not(.collapsed) {
      max-height: 600px;
      opacity: 1;
      padding: 0 12px 12px 12px !important;
      overflow-y: auto;
    }

    #rulesContent:not(.collapsed) {
      max-height: 550px;
    }

    #hallContent:not(.collapsed) {
      max-height: 550px;
    }

    .player-name-box {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.85));
      border: 3px solid white;
      border-radius: 12px;
      padding: 18px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
      margin-bottom: 15px;
      animation: slideDown 0.6s ease-out;
    }

    .logo-container {
      text-align: center;
      margin-bottom: 15px;
      animation: fadeInScale 0.8s ease-out;
    }

    .logo-container img {
      height: 60px;
      width: auto;
      object-fit: contain;
      filter: drop-shadow(0 8px 16px rgba(0, 0, 0, 0.2)) drop-shadow(0 0 20px rgba(0, 168, 233, 0.15));
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      transform: scale(1) rotateZ(-1deg);
    }

    .logo-container img:hover {
      transform: scale(1.08) rotateZ(0deg);
      filter: drop-shadow(0 12px 24px rgba(0, 0, 0, 0.3)) drop-shadow(0 0 30px rgba(0, 168, 233, 0.25));
    }

    @keyframes slideDown { from { opacity: 0; transform: translateY(-30px); } to { opacity: 1; transform: translateY(0); } }

    @keyframes fadeInScale {
      from {
        opacity: 0;
        transform: scale(0.8);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .player-name-label {
      font-size: 0.95rem;
      font-weight: bold;
      color: #0254A0;
      margin-bottom: 8px;
      display: block;
    }

    .player-name-input {
      width: 100%;
      padding: 10px 12px !important;
      border: 2px solid #0254A0 !important;
      background: rgba(2, 84, 160, 0.05) !important;
      color: #0254A0 !important;
      font-size: 0.95rem !important;
      margin-bottom: 10px !important;
      font-weight: bold;
      transition: all 0.2s;
    }

    .player-name-input::placeholder { color: rgba(2, 84, 160, 0.6); }
    .player-name-input:focus { 
      outline: none;
      box-shadow: 0 0 0 4px rgba(2, 84, 160, 0.2) !important;
      background: rgba(2, 84, 160, 0.1) !important;
    }

    .validate-btn {
      width: 100%;
      padding: 10px 16px;
      background: linear-gradient(135deg, #FF5716, #E84E0F);
      color: white;
      border: none;
      border-radius: 6px;
      font-weight: 900;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .validate-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(255, 87, 22, 0.3); }
    .validate-btn:active { transform: translateY(0); }

    .history-table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border: 2px solid #0254A0;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(2, 84, 160, 0.2);
    }

    .history-table thead {
      background: linear-gradient(90deg, #0254A0 0%, #00A8E9 100%);
      color: white;
    }

    .history-table th {
      padding: 12px 10px;
      font-weight: 900;
      text-align: center;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .history-table td {
      padding: 10px 10px;
      text-align: center;
      border-top: 1px solid #e0e0e0;
      color: #0254A0;
      font-weight: 700;
      font-size: 0.8rem;
      font-family: 'Courier New', monospace;
    }

    .history-table tbody tr:hover {
      background: rgba(0, 168, 233, 0.1);
    }

    .intro-content {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      width: 100%;
      margin: 0;
      padding: 0 20px;
      box-sizing: border-box;
      height: auto;
      max-height: fit-content;
      align-items: start;
    }

    #rulesContainer,
    #hallofFameContainer {
      display: flex;
      flex-direction: column;
      min-height: auto;
    }

    #rulesContainer .collapsible-content,
    #hallofFameContainer .collapsible-content {
      flex: 1;
    }

    #rulesContainer {
      background: linear-gradient(135deg, rgba(2,84,160,0.95) 0%, rgba(0,168,233,0.85) 100%);
      border-radius: 12px;
      box-shadow: 0 15px 50px rgba(2,84,160,0.4), inset 0 0 30px rgba(255,255,255,0.1);
      animation: slideLeft 0.8s ease-out;
      border: 2px solid rgba(0,168,233,0.8);
      overflow: hidden;
      height: auto;
      align-self: start;
    }

    #rulesContainer .collapsible-header {
      padding: 12px;
      margin: 0;
    }

    #rulesContainer .collapsible-content {
      padding: 0 12px 12px 12px;
    }

    #hallofFameContainer {
      background: linear-gradient(135deg, rgba(255,87,22,0.95) 0%, rgba(255,150,22,0.85) 100%);
      border-radius: 12px;
      box-shadow: 0 15px 50px rgba(255,87,22,0.4), inset 0 0 30px rgba(255,255,255,0.1);
      animation: slideRight 0.8s ease-out;
      border: 2px solid rgba(255,200,100,0.8);
      overflow: hidden;
      height: auto;
      align-self: start;
    }

    #hallofFameContainer .collapsible-header {
      padding: 12px;
      margin: 0;
    }

    #hallofFameContainer .collapsible-content {
      padding: 0 12px 12px 12px;
    }

    @media (max-width: 650px) {
      .intro-content {
        grid-template-columns: 1fr;
      }
    }
  

    /* ===== STYLES DU JEU (NEW2) ===== */
* { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: 'Poppins', sans-serif; 
      background: linear-gradient(135deg, #0a0e27 0%, #1a1f2e 100%);
      color: #ccc; 
      overflow: hidden; 
      height: 100vh;
    }

    /* ===== HEADER ===== */
    .header {
      background: linear-gradient(90deg, #0254A0 0%, #00A8E9 100%);
      height: 45px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 20px;
      border-bottom: 3px solid #00A8E9;
      box-shadow: 0 4px 20px rgba(0, 168, 233, 0.4);
    }

    .headerTitle { 
      font-size: 1rem; 
      font-weight: 900; 
      color: white;
    }

    .headerRight {
      font-size: 0.75rem;
      color: white;
    }

    /* ===== TIMER BAR ===== */
    .gameStatusBar {
      background: linear-gradient(90deg, #0254A0 0%, #00A8E9 100%);
      height: 70px;
      display: flex;
      justify-content: flex-start;
      align-items: center;
      padding: 0 20px;
      gap: 8px;
      border-bottom: 2px solid #00A8E9;
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.1), 0 4px 20px rgba(0, 168, 233, 0.2);
    }

    .timerDisplay {
      font-size: 2rem;
      font-weight: 900;
      color: #FFD700;
      font-family: 'Courier New', monospace;
      letter-spacing: 2px;
      min-width: 90px;
      animation: electric-pulse 0.4s ease-in-out infinite;
      filter: drop-shadow(0 0 12px rgba(255, 215, 0, 0.9));
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
    }


    .windmill {
      width: 45px;
      height: 45px;
      animation: spin 1.5s linear infinite;
      filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.4));
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .timerBarContainer {
      flex: 1;
      max-width: none;
      height: 20px;
      background: linear-gradient(90deg, #000000 0%, rgba(0, 0, 0, 0.7) 50%, #000000 100%);
      border-radius: 15px;
      overflow: hidden;
      border: 2px solid rgba(0, 168, 233, 0.7);
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.8), 0 0 15px rgba(0, 168, 233, 0.3);
    }

    .timerFill {
      height: 100%;
      background: linear-gradient(90deg, 
        transparent 0%, 
        rgba(0, 212, 255, 0.3) 20%,
        rgba(0, 168, 233, 0.6) 50%, 
        rgba(0, 212, 255, 0.3) 80%,
        transparent 100%);
      background-size: 200% 100%;
      animation: electricity-flow 1.5s linear infinite;
      width: 100%;
      box-shadow: 
        inset 0 0 30px rgba(0, 212, 255, 0.6),
        inset -3px 0 15px rgba(0, 212, 255, 0.5),
        0 0 30px rgba(0, 168, 233, 0.5);
    }

    @keyframes electricity-flow {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    .windWave {
      font-size: 1.3rem;
      animation: wave 0.6s ease-in-out infinite;
      margin-right: -8px;
      margin-left: -5px;
    }

    @keyframes wave {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 1; }
    }

    /* ===== GAME ZONE ===== */
    .gameZone {
      display: grid;
      grid-template-columns: 1fr 18%;
      gap: 15px;
      padding: 15px;
      height: calc(100vh - 115px);
      background: linear-gradient(135deg, #0a0e27 0%, #1a1f2e 100%);
    }

    /* ===== INSPECTION ZONE (TABLEAU 2 COL) ===== */
    .inspectionZone {
      display: grid;
      grid-template-columns: 1fr 140px;
      grid-template-rows: auto auto 1fr;
      gap: 12px;
      background: rgba(2, 84, 160, 0.1);
      border: 2px solid rgba(0, 168, 233, 0.25);
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 4px 15px rgba(2, 84, 160, 0.15);
    }

    /* Ligne 1: INSPECTION | Give Up */
    .inspectionHeader {
      grid-column: 1 / 2;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .inspectionTitle {
      font-size: 1rem;
      font-weight: 900;
      color: #FFD700;
      text-shadow: 0 0 8px rgba(255, 215, 0, 0.4);
    }

    .giveUpBtn {
      grid-column: 2 / 3;
      grid-row: 1 / 2;
      padding: 8px 14px;
      background: linear-gradient(135deg, #7B7B7B 0%, #5C5C5C 100%);
      color: white;
      border: 1px solid #4a4a4a;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      font-size: 0.8rem;
      transition: all 0.2s;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .giveUpBtn:hover {
      transform: translateY(-1px);
      background: linear-gradient(135deg, #8A8A8A 0%, #6B6B6B 100%);
    }

    /* Ligne 2: Status | (vide) */
    .statusBox {
      grid-column: 1 / 2;
      grid-row: 2 / 3;
      background: linear-gradient(90deg, rgba(0, 168, 233, 0.15), rgba(0, 168, 233, 0.08));
      border: 2px solid rgba(0, 168, 233, 0.35);
      border-radius: 8px;
      padding: 10px;
      text-align: center;
      min-height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 10px rgba(0, 168, 233, 0.1);
    }

    .statusMessage {
      color: #00A8E9;
      font-size: 0.8rem;
      font-weight: 600;
    }

    /* Ligne 3-4: ZONE DESSIN (fusionnée 2 lignes) | BUTTONS */
    .drawingZone {
      grid-column: 1 / 2;
      grid-row: 3 / 5;
      background: linear-gradient(135deg, #001a33 0%, #003d66 100%);
      border: 3px solid #10B981;
      border-radius: 12px;
      padding: 15px;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: auto;
      box-shadow: 0 8px 30px rgba(16, 185, 129, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.05);
    }

    #productCanvas {
      max-width: 280px;
      max-height: 280px;
      background: linear-gradient(135deg, #001a33 0%, #003d66 100%);
      border-radius: 8px;
      cursor: none;
    }

    /* ===== LOUPE INTERACTIVE ===== */
    .magnifyingGlass {
      position: fixed;
      width: 35px;
      height: 35px;
      border: 1.5px solid #FFD700;
      border-radius: 50%;
      pointer-events: none;
      z-index: 500;
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.6), inset 0 0 10px rgba(255, 215, 0, 0.2);
      display: none;
    }

    .magnifyingGlass.active {
      display: block;
    }

    .magnifyingGlassHandle {
      position: fixed;
      width: 3px;
      height: 12px;
      background: linear-gradient(45deg, #FFD700, #FFA500);
      pointer-events: none;
      z-index: 500;
      display: none;
      transform: rotate(45deg);
      bottom: -10px;
      right: -10px;
      box-shadow: 0 0 8px rgba(255, 215, 0, 0.5);
    }

    .magnifyingGlassHandle.active {
      display: block;
    }

    .searchZone {
      position: fixed;
      background: rgba(0, 0, 0, 0.8);
      border: 1px solid rgba(255, 215, 0, 0.4);
      border-radius: 4px;
      padding: 2px 6px;
      font-size: 0.6rem;
      color: #FFD700;
      pointer-events: none;
      z-index: 501;
      display: none;
      white-space: nowrap;
      text-shadow: 0 0 8px rgba(255, 215, 0, 0.4);
    }

    .searchZone.active {
      display: block;
    }

    /* ===== OVERLAY RÈGLES ===== */
    .rulesOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(0, 0, 0, 0.4) 0%, rgba(2, 84, 160, 0.25) 100%);
      z-index: 1000;
      display: flex;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(3px);
      padding: 20px;
    }

        .rulesContainer {
      background: linear-gradient(135deg, rgba(2, 84, 160, 0.6) 0%, rgba(0, 168, 233, 0.4) 100%);
      border: 4px solid rgba(255, 215, 0, 0.8);
      border-radius: 20px;
      padding: 40px;
      max-width: 95%;
      width: 100%;
      text-align: center;
      box-shadow: 0 0 80px rgba(0, 168, 233, 0.6), 0 0 40px rgba(255, 215, 0, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.1);
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 30px;
      align-items: stretch;
      grid-auto-rows: 1fr;
    }

    @media (max-width: 1024px) {
      .rulesContainer {
        grid-template-columns: 1fr 1fr;
        padding: 30px;
        gap: 25px;
      }
    }

    @media (max-width: 768px) {
      .rulesContainer {
        grid-template-columns: 1fr;
        padding: 30px;
        gap: 30px;
      }
    }

    .rulesTitle {
      grid-column: 1 / -1;
      font-size: 3rem;
      font-weight: 900;
      color: #FFD700;
      text-shadow: 0 0 30px rgba(255, 215, 0, 0.8), 0 0 60px rgba(0, 168, 233, 0.6);
      margin-bottom: 30px;
      letter-spacing: 2px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }

    .rulesTitle::before {
      content: '⚡';
      font-size: 3.5rem;
      animation: lightning-glow 2s ease-in-out infinite;
      filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.8));
    }

    @keyframes lightning-glow {
      0%, 100% { opacity: 1; filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.6)); }
      50% { opacity: 0.7; filter: drop-shadow(0 0 30px rgba(255, 215, 0, 1)) drop-shadow(0 0 50px rgba(0, 168, 233, 0.8)); }
    }

    .rankTable {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 8px;
    }

    .rankRow {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 15px;
      background: rgba(0, 0, 0, 0.3);
      border-left: 5px solid;
      border-radius: 6px;
      font-weight: 900;
      font-size: 0.95rem;
    }

    .rankRow.rank-s { border-left-color: #FF1493; }
    .rankRow.rank-a { border-left-color: #00BFFF; }
    .rankRow.rank-b { border-left-color: #00FF00; }
    .rankRow.rank-c { border-left-color: #ADFF2F; }
    .rankRow.rank-d { border-left-color: #FFD700; }
    .rankRow.rank-e { border-left-color: #E8E8E8; }

    /* Hover: juste un effet visuel, pas d'override de couleur */
    .rankRow:hover {
      background: rgba(0, 0, 0, 0.5);
      transform: translateX(4px);
      transition: all 0.2s ease;
    }

    .rankLetter {
      min-width: 30px;
      text-align: center;
      font-size: 1.3rem;
    }

    .rankRange {
      flex: 1;
      text-align: left;
      color: #00D4FF;
      font-size: 0.9rem;
    }

    .rulesSection {
      text-align: left;
      display: flex;
      flex-direction: column;
      gap: 20px;
      background: rgba(0, 0, 0, 0.3);
      border: 2px solid rgba(255, 215, 0, 0.5);
      border-radius: 15px;
      padding: 25px;
      backdrop-filter: blur(10px);
    }

    .rulesSectionTitle {
      font-size: 1.8rem;
      font-weight: 900;
      color: #FFD700;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
      text-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
      letter-spacing: 1px;
    }

    .rulesContent {
      color: #00D4FF;
      font-size: 1.1rem;
      line-height: 1.8;
      font-weight: 700;
    }

    .rulesContent ul {
      list-style: none;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .rulesContent li {
      padding: 12px 15px;
      background: rgba(0, 212, 255, 0.1);
      border-left: 4px solid #00D4FF;
      border-radius: 8px;
      font-size: 1.05rem;
    }

    .rulesStat {
      background: linear-gradient(90deg, rgba(255, 215, 0, 0.15) 0%, rgba(0, 212, 255, 0.15) 100%);
      border-left: 5px solid #FFD700;
      border-right: 2px solid #00D4FF;
      padding: 18px 20px;
      margin: 12px 0;
      border-radius: 8px;
      font-weight: 900;
      font-size: 1.15rem;
      color: #FFFFFF;
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.4);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .rulesStat strong {
      color: #FFD700;
      font-size: 1.2rem;
      text-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
    }

    .rulesTitle {
      font-size: 1.6rem;
      font-weight: 900;
      color: #FFD700;
      margin-bottom: 12px;
      text-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
      letter-spacing: 1px;
      grid-column: 1 / -1;
    }

    .rulesSection {
      text-align: left;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .rulesSectionTitle {
      font-size: 1rem;
      font-weight: 900;
      color: #FFD700;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .rulesContent {
      color: #00A8E9;
      font-size: 0.8rem;
      line-height: 1.5;
    }

    .rulesContent ul {
      list-style: none;
      padding: 0;
    }

    .rulesContent li {
      margin: 4px 0;
      padding-left: 18px;
      position: relative;
    }

    .rulesContent li:before {
      content: "✓";
      position: absolute;
      left: 0;
      color: #10B981;
      font-weight: bold;
      font-size: 0.9rem;
    }

    .rulesStat {
      background: rgba(0, 168, 233, 0.1);
      border-left: 2px solid #FFD700;
      padding: 6px;
      margin: 4px 0;
      border-radius: 3px;
      font-weight: 600;
      font-size: 0.78rem;
    }

    .startButton {
      padding: 25px 60px;
      background: linear-gradient(135deg, #10B981 0%, #059669 100%);
      color: white;
      border: 3px solid #FFD700;
      border-radius: 12px;
      font-size: 1.6rem;
      font-weight: 900;
      cursor: pointer;
      transition: all 0.3s;
      text-transform: uppercase;
      letter-spacing: 2px;
      box-shadow: 0 10px 40px rgba(16, 185, 129, 0.6), 0 0 30px rgba(255, 215, 0, 0.4);
      grid-column: 1 / -1;
      margin-top: 30px;
      text-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
    }

    .startButton:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 50px rgba(16, 185, 129, 0.8), 0 0 40px rgba(255, 215, 0, 0.6);
    }

    .startButton:active {
      transform: translateY(-1px);
    }

    .startButton:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(16, 185, 129, 0.5);
    }

    .startButton:active {
      transform: translateY(-1px);
    }

    .rulesOverlay.hidden {
      display: none;
    }

    .rulesOverlay.hidden {
      display: none;
    }

    /* Boutons côté droit */
    .buttonColumn {
      grid-column: 2 / 3;
      grid-row: 3 / 5;
      display: flex;
      flex-direction: column;
      gap: 0;
    }

    .btn {
      border: none;
      border-radius: 0;
      cursor: pointer;
      font-weight: 900;
      font-size: 0.75rem;
      transition: all 0.2s;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      flex: 1;
      min-height: 50px;
    }

    .btn:first-child {
      border-radius: 8px 8px 0 0;
    }

    .btn:last-child {
      border-radius: 0 0 8px 8px;
    }

    .btnAccept {
      background: linear-gradient(135deg, #10B981 0%, #059669 100%);
      color: white;
      border: 1px solid #059669;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }

    .btnAccept:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(16, 185, 129, 0.45);
    }

    .btnReject {
      background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
      color: white;
      border: 1px solid #DC2626;
      box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
    }

    .btnReject:hover {
      transform: translateY(2px);
      box-shadow: 0 6px 16px rgba(239, 68, 68, 0.45);
    }

    /* ===== KPI ZONE ===== */
    .kpiZone {
      background: linear-gradient(135deg, rgba(2, 84, 160, 0.2), rgba(0, 168, 233, 0.1));
      border: 2px solid rgba(0, 168, 233, 0.35);
      border-radius: 12px;
      padding: 15px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(2, 84, 160, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.05);
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .kpiZoneTitle {
      font-size: 0.75rem;
      font-weight: 900;
      color: #FFD700;
      text-transform: uppercase;
      letter-spacing: 0.4px;
      text-shadow: 0 0 8px rgba(255, 215, 0, 0.4);
      text-align: center;
      padding: 4px 0;
      border-bottom: 1px solid rgba(0, 168, 233, 0.2);
      margin-bottom: 6px;
    }

    .kpiSection {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .kpiSectionTitle {
      font-size: 0.65rem;
      font-weight: 900;
      color: #FFD700;
      text-transform: uppercase;
      letter-spacing: 0.3px;
      text-shadow: 0 0 6px rgba(255, 215, 0, 0.4);
      margin-bottom: 3px;
      line-height: 1;
    }

    .kpiBlock {
      background: linear-gradient(135deg, rgba(0, 168, 233, 0.15) 0%, rgba(0, 168, 233, 0.05) 100%);
      border: 1px solid rgba(0, 168, 233, 0.25);
      border-radius: 5px;
      padding: 5px 3px;
      text-align: center;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
      margin-bottom: 3px;
    }

    .kpiLabel {
      font-size: 0.6rem;
      color: #00A8E9;
      text-transform: uppercase;
      margin-bottom: 1px;
      letter-spacing: 0.1px;
      font-weight: 600;
      line-height: 1;
    }

    .kpiValue {
      font-size: 1rem;
      font-weight: 900;
      color: #10B981;
      text-shadow: 0 0 5px rgba(16, 185, 129, 0.4);
      line-height: 1;
      transition: all 0.3s ease;
    }

    .kpiBlockDecisions {
      background: linear-gradient(135deg, rgba(0, 168, 233, 0.15) 0%, rgba(0, 168, 233, 0.05) 100%);
      border: 1px solid rgba(0, 168, 233, 0.25);
      border-radius: 5px;
      padding: 4px 2px;
      text-align: center;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
      margin-bottom: 2px;
    }

    .kpiDecisionsRow {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2px;
      margin-top: 2px;
    }

    .kpiDecisionItem {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 3px;
      padding: 2px;
    }

    .kpiDecisionLabel {
      font-size: 0.48rem;
      color: #00A8E9;
      text-transform: uppercase;
      letter-spacing: 0.1px;
      font-weight: 600;
      line-height: 1;
      margin-bottom: 1px;
    }

    .kpiLabel {
      font-size: 0.52rem;
      color: #00A8E9;
      text-transform: uppercase;
      margin-bottom: 0px;
      letter-spacing: 0.1px;
      font-weight: 600;
      line-height: 1;
    }

    .kpiValue {
      font-size: 0.85rem;
      font-weight: 900;
      color: #10B981;
      text-shadow: 0 0 5px rgba(16, 185, 129, 0.4);
      line-height: 1;
      transition: all 0.3s ease;
    }

    /* Inspected - Gris */
    #kpiInspected {
      color: #888;
      background: rgba(80, 80, 80, 0.15);
      padding: 2px;
      border-radius: 3px;
    }

    /* Quality - Vert vers Doré */
    #kpiQuality {
      transition: all 0.3s ease;
    }

    /* Wrong Decision - Orange/Rouge */
    #kpiWrong {
      color: #FF5716;
      text-shadow: 0 0 5px rgba(255, 87, 22, 0.4);
    }

    /* Combo - Change couleur + animation */
    #kpiCombo {
      transition: all 0.3s ease;
    }

    @keyframes comboGlow {
      0% { text-shadow: 0 0 5px rgba(16, 185, 129, 0.4); }
      50% { text-shadow: 0 0 12px rgba(16, 185, 129, 0.8); }
      100% { text-shadow: 0 0 5px rgba(16, 185, 129, 0.4); }
    }

    /* Average Time - Vert vers Noir */
    #kpiAvgTime {
      transition: all 0.3s ease;
    }

    @keyframes tremble {
      0%, 100% { transform: rotate(0deg) scale(1); }
      10% { transform: rotate(-2deg) scale(1.05); }
      20% { transform: rotate(2deg) scale(1.05); }
      30% { transform: rotate(-2deg) scale(1.05); }
      40% { transform: rotate(2deg) scale(1.05); }
      50% { transform: rotate(-1deg) scale(1.05); }
      60% { transform: rotate(1deg) scale(1.05); }
      70% { transform: rotate(-1deg) scale(1.05); }
      80% { transform: rotate(1deg) scale(1.05); }
      90% { transform: rotate(0deg) scale(1); }
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    #kpiStatus {
      font-size: 1.2rem;
      animation: tremble 0.6s ease-in-out infinite, pulse 1.2s ease-in-out infinite;
      display: inline-block;
    }

    /* ===== RESIZABLE DIVIDER ===== */
    .resizableDivider {
      position: fixed;
      width: 6px;
      height: calc(100vh - 115px);
      top: 115px;
      cursor: col-resize;
      background: linear-gradient(90deg, transparent, rgba(0, 168, 233, 0.3), transparent);
      transition: background 0.2s;
      z-index: 100;
    }

    .resizableDivider:hover {
      background: linear-gradient(90deg, transparent, rgba(0, 168, 233, 0.8), transparent);
    }

    .feedbackMessage {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(135deg, rgba(0, 0, 0, 0.95) 0%, rgba(10, 14, 39, 0.95) 100%);
      color: #FFD700;
      padding: 30px 50px;
      border-radius: 12px;
      font-size: 1.3rem;
      font-weight: bold;
      z-index: 1000;
      display: none;
      text-align: center;
      border: 2px solid rgba(255, 215, 0, 0.3);
      box-shadow: 0 0 40px rgba(255, 215, 0, 0.2);
    }

    @keyframes stampStamp {
      0% {
        transform: translate(-50%, -50%) scale(0.3) rotate(-15deg);
        opacity: 0;
      }
      50% {
        transform: translate(-50%, -50%) scale(1.1) rotate(5deg);
        opacity: 1;
      }
      100% {
        transform: translate(-50%, -50%) scale(1) rotate(0deg);
        opacity: 1;
      }
    }

    .stamp {
      position: fixed;
      top: 50%;
      left: 50%;
      font-size: 8rem;
      font-weight: bold;
      z-index: 999;
      pointer-events: none;
      animation: stampStamp 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    }

    .stamp.accept {
      color: #10B981;
      text-shadow: 0 0 30px rgba(16, 185, 129, 0.8);
      transform: translate(-50%, -50%) rotate(25deg);
    }

    .stamp.reject {
      color: #EF4444;
      text-shadow: 0 0 30px rgba(239, 68, 68, 0.8);
      transform: translate(-50%, -50%) rotate(-25deg);
    }
  </style>
</head>



<body>
<!-- INTRO SCREEN -->
  <div id="introScreenAnimated" style="position: fixed; inset: 0; background: linear-gradient(135deg, #0254A0 0%, #00A8E9 100%); display: flex; z-index: 2000; align-items: center; justify-content: flex-start; flex-direction: column; padding: 40px 20px; overflow-y: auto;">
    
    <!-- TITRE AVEC LOGOS À GAUCHE ET DROITE -->
    <div style="display: flex; align-items: center; justify-content: center; gap: 30px; margin-bottom: 40px; margin-top: 20px;">
      <!-- Logo COU à gauche -->
      <div style="text-align: center; flex-shrink: 0;">
        <img src="./img/COU.png" style="max-height: 60px; animation: bounce 2s infinite;">
      </div>
      
      <!-- TITRE CENTRÉ -->
      <h1 style="font-size: 2.8rem; font-weight: 900; color: white; text-shadow: 0 0 20px rgba(255,255,255,0.3); animation: bounce 2s infinite; cursor: pointer; white-space: nowrap;" id="titleHeart" onclick="window.FIRST_showEasterEgg()">🔍 Quality Week 2025 💗</h1>
      
      <!-- Logo EDFPS à droite -->
      <div style="text-align: center; flex-shrink: 0;">
        <img src="./img/EDFPS.png" style="max-height: 60px; animation: bounce 2s infinite;">
      </div>
    </div>
    
    <!-- Container principal pour tout aligner proprement -->
    <div style="width: 100%; max-width: 950px; margin-left: auto; margin-right: auto;">
    
    <!-- Layout 2 colonnes : gauche texte, droite input -->
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 40px; align-items: start; padding: 0 20px; box-sizing: border-box;">
      
      <!-- GAUCHE : Introduction -->
      <div style="text-align: left;">
        <!-- 2 MINUTES GAME -->
        <div style="background: rgba(0,0,0,0.3); border: 2px solid #FFD700; border-radius: 10px; padding: 15px; margin-bottom: 15px;">
          <div style="font-size: 0.95rem; font-weight: 700; color: white; margin-bottom: 8px; text-shadow: 0 1px 3px rgba(0,0,0,0.5);">
            ⏱️ <span style="color: #FFD700; font-weight: 900;">~2 MINUTES GAME</span>
          </div>
          <div style="font-size: 0.85rem; color: #FFFFFF; line-height: 1.6; font-weight: 600; text-shadow: 0 1px 3px rgba(0,0,0,0.5);">
            You are a <strong>Quality Inspector</strong> for EDF.
            <br/><br/>
            Products will pass in front of you and you must inspect them as <strong>fast AND accurate</strong> as possible.
          </div>
        </div>
      </div>

      <!-- DROITE : Input du nom -->
      <div class="player-name-box" style="width: 100% !important;">
        <label class="player-name-label">👤 Enter Your Name:</label>
        <div style="position: relative; display: flex; align-items: center;">
          <input type="text" id="playerNameInput" class="player-name-input" placeholder="Type your name..." maxlength="30" onkeypress="if(event.key==='Enter') window.FIRST_validatePlayerName()" style="flex: 1; margin-bottom: 0 !important; padding-right: 35px !important;">
          <button id="clearNameBtn" onclick="window.FIRST_clearPlayerName()" style="position: absolute; right: 8px; background: none; border: none; cursor: pointer; font-size: 1.5rem; color: rgba(2, 84, 160, 0.8); transition: all 0.2s; display: none; padding: 0; width: 30px; height: 30px; line-height: 30px; text-align: center;" title="Clear name">✕</button>
        </div>
        <button class="validate-btn" onclick="window.FIRST_validatePlayerName()" style="margin-top: 10px; width: 100%;">✓ Validate Name</button>
      </div>

    </div>

    <!-- INSPECTION DILEMMA CONDENSÉ -->
    <div style="background: rgba(20, 30, 50, 0.8); backdrop-filter: blur(10px); border: 2px solid rgba(0, 168, 233, 0.4); border-radius: 15px; padding: 30px; margin-bottom: 40px; margin-left: 20px; margin-right: 20px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.1);">
      
      <div style="text-align: center; margin-bottom: 20px;">
        <div style="font-size: 1.2rem; font-weight: 900; color: #FFD700; letter-spacing: 2px; text-shadow: 0 2px 8px rgba(0,0,0,0.5);">🎯 INSPECTION DILEMMA 🎯</div>
        <div style="font-size: 0.8rem; color: #00A8E9; font-weight: 600; text-shadow: 0 1px 3px rgba(0,0,0,0.5);">Every Quality Inspector faces this fundamental choice...</div>
      </div>
      
      <div style="display: flex; align-items: center; justify-content: center; gap: 20px;">
        
        <!-- OPTION 1: SLOW -->
        <div style="flex: 1; background: linear-gradient(135deg, rgba(16,185,129,0.2) 0%, rgba(16,185,129,0.05) 100%); border: 2px solid #10B981; border-radius: 12px; padding: 18px; text-align: center; box-shadow: 0 6px 15px rgba(16, 185, 129, 0.2);">
          <div style="font-size: 1.8rem; margin-bottom: 10px; animation: bounce 2s infinite;">⏱️</div>
          <div style="font-size: 0.95rem; font-weight: 900; color: #10B981; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px;">SLOW</div>
          <div style="font-size: 0.75rem; color: #FFFFFF; margin-bottom: 12px; line-height: 1.4;">Take your time</div>
          <div style="background: rgba(16, 185, 129, 0.15); border-left: 3px solid #10B981; padding: 10px; border-radius: 6px; text-align: left; font-size: 0.7rem;">
            <div style="color: #10B981; font-weight: 900; margin-bottom: 5px;">✅ PROS:</div>
            <div style="color: #FFFFFF; margin-bottom: 8px; line-height: 1.3;">• Catch defects • High quality</div>
            <div style="color: #EF4444; font-weight: 900; margin-bottom: 5px;">⚠️ CONS:</div>
            <div style="color: #FFFFFF;">• Low score</div>
          </div>
        </div>

        <!-- CENTER: VS -->
        <div style="display: flex; flex-direction: column; align-items: center; gap: 5px; font-size: 0.65rem;">
          <div style="font-size: 2.5rem; font-weight: 900; color: #FFD700; animation: pulse 1.5s infinite; text-shadow: 0 2px 8px rgba(255, 215, 0, 0.6);">VS</div>
          <div style="color: #FFD700; font-weight: 900; text-transform: uppercase; letter-spacing: 1px; text-align: center;">Choose</div>
        </div>

        <!-- OPTION 2: FAST -->
        <div style="flex: 1; background: linear-gradient(135deg, rgba(239,68,68,0.2) 0%, rgba(239,68,68,0.05) 100%); border: 2px solid #EF4444; border-radius: 12px; padding: 18px; text-align: center; box-shadow: 0 6px 15px rgba(239, 68, 68, 0.2);">
          <div style="font-size: 1.8rem; margin-bottom: 10px; animation: electric-pulse 3s linear infinite;">⚡</div>
          <div style="font-size: 0.95rem; font-weight: 900; color: #EF4444; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px;">FAST</div>
          <div style="font-size: 0.75rem; color: #FFFFFF; margin-bottom: 12px; line-height: 1.4;">Maximize output</div>
          <div style="background: rgba(239, 68, 68, 0.15); border-left: 3px solid #EF4444; padding: 10px; border-radius: 6px; text-align: left; font-size: 0.7rem;">
            <div style="color: #10B981; font-weight: 900; margin-bottom: 5px;"><span style="animation: electric-pulse 1s ease-in-out infinite; display: inline-block;">⚡</span> PROS:</div>
            <div style="color: #FFFFFF; margin-bottom: 8px; line-height: 1.3;">• High score • Many products</div>
            <div style="color: #EF4444; font-weight: 900; margin-bottom: 5px;">⚠️ CONS:</div>
            <div style="color: #FFFFFF;">• Miss defects</div>
          </div>
        </div>

      </div>

    </div>

    <!-- TRADE-OFF et HALL OF FAME côte à côte -->
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 40px; padding: 0 20px; box-sizing: border-box;">
      
      <!-- TRADE-OFF à gauche -->
      <div id="rulesContainer">
        <div class="collapsible-header" onclick="window.FIRST_toggleCollapse('rulesContent')">
          <span class="chevron collapsed" id="rulesChevron">▶</span>
          <span style="color: white; font-weight: 900; text-shadow: 0 2px 8px rgba(0,0,0,0.3);" id="rulesTrigger">📋 THE TRADE-OFF</span>
        </div>
        <div id="rulesContent" class="collapsible-content collapsed">
        
        <!-- FIND YOUR BALANCE au dessus -->
        <div style="background: rgba(0,0,0,0.4); border: 2px solid #00A8E9; border-radius: 8px; padding: 15px; margin-bottom: 15px; text-align: center;">
          <div style="font-size: 1rem; font-weight: 900; color: #FFD700; margin-bottom: 8px;">⚖️ FIND YOUR BALANCE</div>
          <div style="font-size: 0.8rem; color: #FFFFFF; font-weight: 700; text-shadow: 0 1px 3px rgba(0,0,0,0.5); line-height: 1.6;">
            The challenge is to find the sweet spot between speed and accuracy. Which strategy will you choose?
          </div>
        </div>

        <!-- 2 colonnes avec meilleure explication -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; background: rgba(0,0,0,0.4); padding: 15px; border-radius: 10px;">
          
          <div style="background: rgba(16,185,129,0.25); border: 2px solid #10B981; border-radius: 8px; padding: 12px;">
            <div style="text-align: center; margin-bottom: 10px;">
              <div style="font-size: 2rem; margin-bottom: 4px;">⏱️ 🔍</div>
              <div style="font-size: 0.85rem; font-weight: 900; color: #FFD700;">SLOW & CAREFUL</div>
            </div>
            <div style="font-size: 0.75rem; color: #FFFFFF; font-weight: 700; line-height: 1.8; text-shadow: 0 1px 3px rgba(0,0,0,0.5);">
              <div style="margin-bottom: 8px; border-bottom: 1px solid rgba(255,255,255,0.3); padding-bottom: 8px;">
                <div style="color: #10B981; font-weight: 900;">✅ ADVANTAGES:</div>
                <div>• Catch defects</div>
                <div>• High quality</div>
                <div>• Keep reputation</div>
              </div>
              <div>
                <div style="color: #EF4444; font-weight: 900;">❌ DISADVANTAGES:</div>
                <div>• Fewer inspections</div>
                <div>• Low Game Score</div>
              </div>
            </div>
          </div>

          <div style="background: rgba(239,68,68,0.25); border: 2px solid #EF4444; border-radius: 8px; padding: 12px;">
            <div style="text-align: center; margin-bottom: 10px;">
              <div style="font-size: 2rem; margin-bottom: 4px; display: flex; align-items: center; justify-content: center; gap: 8px;">
                <span style="animation: electric-pulse 3s linear infinite;">⚡</span>
                <span>💨</span>
              </div>
              <div style="font-size: 0.85rem; font-weight: 900; color: #FFD700;">FAST & CARELESS</div>
            </div>
            <div style="font-size: 0.75rem; color: #FFFFFF; font-weight: 700; line-height: 1.8; text-shadow: 0 1px 3px rgba(0,0,0,0.5);">
              <div style="margin-bottom: 8px; border-bottom: 1px solid rgba(255,255,255,0.3); padding-bottom: 8px;">
                <div style="color: #10B981; font-weight: 900;">✅ ADVANTAGES:</div>
                <div>• More inspections</div>
                <div>• Better Game Score</div>
                <div>• High throughput</div>
              </div>
              <div>
                <div style="color: #EF4444; font-weight: 900;">❌ DISADVANTAGES:</div>
                <div>• Miss defects</div>
                <div>• Lost reputation</div>
              </div>
            </div>
          </div>

        </div>
      </div>
      </div>

      <!-- HALL OF FAME à droite -->
      <div id="hallofFameContainer">
        <div class="collapsible-header" onclick="window.FIRST_toggleCollapse('hallContent')" style="justify-content: space-between;">
          <div style="display: flex; align-items: center; gap: 8px;">
            <span class="chevron collapsed" id="hallChevron">▶</span>
            <span style="color: white; font-weight: 900; text-shadow: 0 2px 8px rgba(0,0,0,0.3);">🏆 HALL OF FAME</span>
            <span id="hallSourceIcon" style="font-size: 1rem; cursor: pointer; transition: transform 0.3s;" title="Source des données - Cliquez pour actualiser" onclick="event.stopPropagation(); document.getElementById('hallSourceIcon').style.transform='rotate(360deg)'; setTimeout(() => document.getElementById('hallSourceIcon').style.transform='rotate(0deg)', 500); FIRST_loadLeaderboard();">💻</span>
          </div>
          <div id="hallUpdateTime" style="font-size: 0.65rem; color: #FFD700; font-weight: 700; background: rgba(255, 215, 0, 0.12); padding: 5px 12px; border-radius: 20px; border: 1.5px solid rgba(255, 215, 0, 0.3); letter-spacing: 0.3px; transition: all 0.3s ease; box-shadow: 0 0 10px rgba(255, 215, 0, 0.15);">
            <span id="updateTimeText" style="font-family: 'Courier New', monospace; white-space: nowrap;">--:--:--</span>
          </div>
        </div>
        <div id="hallContent" class="collapsible-content collapsed">
          <div id="introLeaderboardList" style="display: flex; flex-direction: column; gap: 0; background: transparent; border-radius: 8px; border: none; overflow: hidden; margin-top: 10px; padding-right: 8px;">
            <div style="text-align: center; color: rgba(255,255,255,0.95); font-weight: bold; font-size: 0.95rem;"><p style="margin-bottom: 3px;">⭐ No scores yet!</p><p>Be the first!</p></div>
          </div>
        </div>
      </div>

    </div>
    
    <!-- Fin du container principal -->
    </div>

    <div id="historyTableContainer" style="display: none; margin-top: 30px; width: 100%; max-width: 650px; margin-left: auto; margin-right: auto;">
      <div style="color: #00A8E9; font-weight: 900; font-size: 0.9rem; margin-bottom: 10px; text-transform: uppercase;" id="historyTableTitle">📊 Your Previous Games</div>
      <table class="history-table">
        <thead>
          <tr>
            <th style="width: 45%;">Date & Time</th>
            <th style="width: 27%;">Score</th>
            <th style="width: 28%;">Quality</th>
          </tr>
        </thead>
        <tbody id="historyTableBody">
        </tbody>
      </table>
    </div>

    <!-- Historique des games de l'utilisateur -->
    <div id="gameHistoryContainer" style="display: none; margin-top: 30px; width: 90%; max-width: 650px; margin-left: auto; margin-right: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
      <h3 id="gameHistoryTitle" style="color: #0254A0; text-align: center; margin-bottom: 15px; font-size: 1.1rem;">📊 Game History</h3>
      <table style="width: 100%; border-collapse: collapse; background: white;">
        <thead>
          <tr style="background: linear-gradient(90deg, #0254A0 0%, #00A8E9 100%); color: white;">
            <th style="padding: 12px; text-align: left; font-weight: 900;">Date</th>
            <th style="padding: 12px; text-align: center; font-weight: 900;">Score</th>
            <th style="padding: 12px; text-align: center; font-weight: 900;">Rank</th>
          </tr>
        </thead>
        <tbody id="gameHistoryBody" style="color: #333;">
        </tbody>
      </table>
    </div>

    <button id="startGameBtn" onclick="window.FIRST_startGame()" style="margin-top: 20px; padding: 14px 40px; font-size: 1.2rem; font-weight: 900; color: white; background: linear-gradient(135deg, #FF5716 0%, #E84E0F 100%); border: none; border-radius: 50px; cursor: pointer; box-shadow: 0 10px 40px rgba(255,87,22,0.4); animation: pulse 2s infinite; text-transform: uppercase; letter-spacing: 1px; opacity: 0.5; transition: opacity 0.3s;">▶ OPEN INSPECTION</button>
  </div>

  <!-- EASTER EGG -->

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // Configuration Supabase
    const SUPABASE_URL = 'https://xhntnoyhcnqpjntcbzsk.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhobnRub3loY25xcGpudGNienNrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEzMzU4OTMsImV4cCI6MjA3NjkxMTg5M30.6B3-TZNUermMdSoEGOuE7VSut6I0bDeaGREd53kr2Ro';
    
    
    let supabase = null;
    try {
      supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
      
      // Test de connexion
      supabase.from('leaderboard').select('*', { count: 'exact', head: true }).then(({ error, count }) => {
        if (error) {
          console.error('❌ Erreur de connexion Supabase:', error.message);
        } else {
        }
      });
    } catch (err) {
      console.error('❌ Erreur lors de la création du client Supabase:', err);
    }

    let currentLanguage = 'en';
    let gameTimer = null;
    const RANK_MESSAGES = {
      fr: { E: { emoji: '😅', messages: ['Continue à pratiquer!'] }, D: { emoji: '😐', messages: ['Pas mal!'] }, C: { emoji: '👍', messages: ['Pas mal!'] }, B: { emoji: '😊', messages: ['Brilliant!'] }, A: { emoji: '⚡', messages: ['Awesome!'] }, S: { emoji: '👑', messages: ['SPLENDID!'] } },
      en: { E: { emoji: '😅', messages: ['Keep practicing!'] }, D: { emoji: '😐', messages: ['Not bad!'] }, C: { emoji: '👍', messages: ['Pretty good!'] }, B: { emoji: '😊', messages: ['Brilliant!'] }, A: { emoji: '⚡', messages: ['Awesome!'] }, S: { emoji: '👑', messages: ['SPLENDID!'] } }
    };

    function formatTimeOnly(date) {
      const hours = String(date.getHours()).padStart(2, '0');
      const mins = String(date.getMinutes()).padStart(2, '0');
      const secs = String(date.getSeconds()).padStart(2, '0');
      return `${hours}:${mins}:${secs}`;
    }

    window.FIRST_toggleCollapse = function(contentId) {
      const content = document.getElementById(contentId);
      const isCollapsed = content.classList.contains('collapsed');
      
      if (contentId === 'rulesContent') {
        const chevron = document.getElementById('rulesChevron');
        content.classList.toggle('collapsed');
        chevron.classList.toggle('collapsed');
      } else if (contentId === 'hallContent') {
        const chevron = document.getElementById('hallChevron');
        content.classList.toggle('collapsed');
        chevron.classList.toggle('collapsed');
      }
    };

    window.FIRST_expandAllSections = function() {
      document.getElementById('rulesContent').classList.remove('collapsed');
      document.getElementById('rulesChevron').classList.remove('collapsed');
      
      document.getElementById('hallContent').classList.remove('collapsed');
      document.getElementById('hallChevron').classList.remove('collapsed');
    };

    window.FIRST_loadGameHistory = async function(username) {
      try {
        const { data, error } = await supabase
          .from('leaderboard')
          .select('*')
          .eq('name', username)
          .order('date', { ascending: false })
          .limit(20);
        
        if (error) throw error;
        
        FIRST_displayGameHistory(username, data || []);
      } catch (err) {FIRST_displayGameHistory(username, []);
      }
    };

    function FIRST_displayGameHistory(username, games) {
      const container = document.getElementById('gameHistoryContainer');
      const tbody = document.getElementById('gameHistoryBody');
      const titleElement = document.getElementById('gameHistoryTitle');
      
      // Mettre le titre avec le prénom coloré
      titleElement.innerHTML = `📊 <span style="color: #00A8E9; font-weight: 900;">${username}</span>'s Game History`;
      
      if (games && games.length > 0) {
        tbody.innerHTML = games.map((game, index) => {
          const date = new Date(game.date || Date.now());
          const day = String(date.getDate()).padStart(2, '0');
          const month = String(date.getMonth() + 1).padStart(2, '0');
          const year = String(date.getFullYear()).slice(-2);
          const hours = String(date.getHours()).padStart(2, '0');
          const mins = String(date.getMinutes()).padStart(2, '0');
          const secs = String(date.getSeconds()).padStart(2, '0');
          
          return `
            <tr style="border-bottom: 1px solid #e0e0e0; background-color: #f9f9f9;">
              <td style="padding: 10px 12px; color: #333;">${day}/${month}/${year} ${hours}:${mins}:${secs}</td>
              <td style="padding: 10px 12px; text-align: center; color: #0254A0; font-weight: 700;">${game.score}</td>
              <td style="padding: 10px 12px; text-align: center; color: #00A8E9; font-weight: 900;">#${index + 1}</td>
            </tr>
          `;
        }).join('');
      } else {
        tbody.innerHTML = '<tr style="border-bottom: 1px solid #e0e0e0;"><td colspan="3" style="padding: 20px; text-align: center; color: #999;">No games yet</td></tr>';
      }
      
      container.style.display = 'block';
    }

    window.FIRST_validatePlayerName = function() {
      const input = document.getElementById('playerNameInput');
      const clearBtn = document.getElementById('clearNameBtn');
      FIRST_playerName = input.value.trim();if (!FIRST_playerName) { 
        alert('Please enter a name!'); 
        return; 
      }
      
      FIRST_playerNameValidated = true;localStorage.setItem('playerName', FIRST_playerName);
      input.disabled = true;
      clearBtn.style.display = 'block';
      clearBtn.onmouseover = function() { this.style.color = 'rgba(2, 84, 160, 1)'; };
      clearBtn.onmouseout = function() { this.style.color = 'rgba(2, 84, 160, 0.6)'; };
      
      // Charger l'historique depuis Supabase
      window.FIRST_loadGameHistory(FIRST_playerName);
      
      const startBtn = document.getElementById('startGameBtn');
      startBtn.disabled = false;
      startBtn.style.opacity = '1';
      startBtn.style.cursor = 'pointer';window.FIRST_expandAllSections();
      
      setTimeout(() => {
        const historyContainer = document.getElementById('gameHistoryContainer');
        if (historyContainer.style.display !== 'none') {
          historyContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      }, 100);
    };

    window.FIRST_clearPlayerName = function() {
      const input = document.getElementById('playerNameInput');
      const clearBtn = document.getElementById('clearNameBtn');
      input.value = '';
      input.disabled = false;
      input.focus();
      clearBtn.style.display = 'none';
      FIRST_playerName = '';
      FIRST_playerNameValidated = false;
      
      document.getElementById('startGameBtn').disabled = true;
      document.getElementById('startGameBtn').style.opacity = '0.5';
      
      // Replier les sections
      document.getElementById('rulesContent').classList.add('collapsed');
      document.getElementById('rulesChevron').classList.add('collapsed');
      document.getElementById('hallContent').classList.add('collapsed');
      document.getElementById('hallChevron').classList.add('collapsed');
      
      document.getElementById('historyTableContainer').style.display = 'none';
    };

    window.FIRST_startGame = function() {
      if (!FIRST_playerNameValidated) {
        // Créer un popup stylé
        const popup = document.createElement('div');
        popup.style.cssText = `
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background: linear-gradient(135deg, #0254A0 0%, #00A8E9 100%);
          border: 3px solid #FFD700;
          border-radius: 15px;
          padding: 30px;
          text-align: center;
          z-index: 10000;
          box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
          min-width: 300px;
          animation: popupIn 0.3s ease-out;
        `;
        popup.innerHTML = `
          <div style="font-size: 2rem; margin-bottom: 15px;">⚠️</div>
          <div style="color: white; font-size: 1.2rem; font-weight: 900; margin-bottom: 15px;">WAIT!</div>
          <div style="color: #FFD700; font-size: 1rem; font-weight: 700; margin-bottom: 20px;">Please enter your name first!</div>
          <button onclick="this.parentElement.parentElement.remove()" style="padding: 12px 30px; background: #FFD700; color: #0254A0; border: none; border-radius: 8px; font-weight: 900; cursor: pointer; font-size: 1rem;">Got it!</button>
        `;
        
        // Ajouter l'animation au CSS
        if (!document.getElementById('popupInAnimation')) {
          const style = document.createElement('style');
          style.id = 'popupInAnimation';
          style.innerHTML = `
            @keyframes popupIn {
              0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
              100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            }
          `;
          document.head.appendChild(style);
        }
        
        document.body.appendChild(popup);
        return;
      }
      
      // Si le nom est validé, afficher l'overlay des règles
      const intro = document.getElementById('introScreenAnimated');
      const rulesOverlay = document.getElementById('rulesOverlay');
      
      if (intro) intro.style.display = 'none';
      if (rulesOverlay) rulesOverlay.classList.remove('hidden');
    };

    function FIRST_drawBlade(ctx, x, y) {
      // Turbine blade section
      ctx.fillStyle = '#F5F5F5';
      ctx.beginPath();
      ctx.ellipse(x, y, 50, 90, Math.PI / 6, 0, Math.PI * 2);
      ctx.fill();
      
      ctx.strokeStyle = '#333333';
      ctx.lineWidth = 2;
      ctx.stroke();
      
      // Surface pattern
      ctx.strokeStyle = '#CCCCCC';
      ctx.lineWidth = 1;
      for (let i = -3; i < 3; i++) {
        ctx.beginPath();
        ctx.moveTo(x + i * 15, y - 90);
        ctx.lineTo(x + i * 15, y + 90);
        ctx.stroke();
      }
      
      // Label
      ctx.fillStyle = '#555555';
      ctx.font = 'bold 12px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('BLADE SECTION', x, y + 110);
    }
    
    function FIRST_drawBolt(ctx, x, y) {
      // Large bolt
      const boltSize = 40;
      
      // Bolt head
      ctx.fillStyle = '#C0C0C0';
      ctx.beginPath();
      ctx.arc(x, y - 20, boltSize, 0, Math.PI * 2);
      ctx.fill();
      
      ctx.strokeStyle = '#808080';
      ctx.lineWidth = 2;
      ctx.stroke();
      
      // Hexagon pattern
      ctx.strokeStyle = '#999999';
      ctx.lineWidth = 1;
      ctx.beginPath();
      for (let i = 0; i < 6; i++) {
        const angle = (i / 6) * Math.PI * 2;
        const px = x + Math.cos(angle) * 25;
        const py = y - 20 + Math.sin(angle) * 25;
        if (i === 0) ctx.moveTo(px, py);
        else ctx.lineTo(px, py);
      }
      ctx.closePath();
      ctx.stroke();
      
      // Bolt shaft
      ctx.fillStyle = '#A9A9A9';
      ctx.fillRect(x - 15, y, 30, 80);
      
      ctx.strokeStyle = '#808080';
      ctx.lineWidth = 1;
      ctx.strokeRect(x - 15, y, 30, 80);
      
      // Threading
      ctx.strokeStyle = '#999999';
      ctx.lineWidth = 1;
      for (let i = 0; i < 5; i++) {
        ctx.beginPath();
        ctx.moveTo(x - 15, y + i * 20);
        ctx.lineTo(x + 15, y + i * 20);
        ctx.stroke();
      }
      
      // Label
      ctx.fillStyle = '#555555';
      ctx.font = 'bold 12px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('FOUNDATION BOLT', x, y + 115);
    }
    
    function FIRST_drawCable(ctx, x, y) {
      // Cable connector with multiple pins
      ctx.fillStyle = '#FFD700';
      ctx.beginPath();
      ctx.rect(x - 45, y - 35, 90, 70);
      ctx.fill();
      
      ctx.strokeStyle = '#FF8C00';
      ctx.lineWidth = 2;
      ctx.stroke();
      
      // Connection points (pins)
      for (let i = 0; i < 4; i++) {
        ctx.fillStyle = '#C0C0C0';
        ctx.beginPath();
        ctx.arc(x - 25 + i * 17, y + 25, 5, 0, Math.PI * 2);
        ctx.fill();
        
        ctx.strokeStyle = '#808080';
        ctx.lineWidth = 1;
        ctx.stroke();
      }
      
      // Cable ports
      ctx.fillStyle = '#444444';
      ctx.fillRect(x - 50, y - 10, 8, 20);
      ctx.fillRect(x + 42, y - 10, 8, 20);
      
      // Label
      ctx.fillStyle = '#555555';
      ctx.font = 'bold 12px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('CABLE CONNECTOR', x, y + 60);
    }
    
    function drawTowerSection(ctx, x, y) {
      // Tower section
      ctx.fillStyle = '#E8E8E8';
      ctx.beginPath();
      ctx.rect(x - 40, y - 70, 80, 140);
      ctx.fill();
      
      ctx.strokeStyle = '#333333';
      ctx.lineWidth = 2;
      ctx.stroke();
      
      // Weld points
      ctx.fillStyle = '#FF6B6B';
      for (let i = 0; i < 3; i++) {
        ctx.beginPath();
        ctx.arc(x - 50, y - 40 + i * 70, 4, 0, Math.PI * 2);
        ctx.fill();
        
        ctx.beginPath();
        ctx.arc(x + 50, y - 40 + i * 70, 4, 0, Math.PI * 2);
        ctx.fill();
      }
      
      // Rust/corrosion spots
      ctx.fillStyle = 'rgba(139, 69, 19, 0.3)';
      for (let i = 0; i < 8; i++) {
        ctx.beginPath();
        ctx.arc(x - 30 + Math.random() * 60, y - 50 + Math.random() * 100, Math.random() * 6 + 2, 0, Math.PI * 2);
        ctx.fill();
      }
      
      // Label
      ctx.fillStyle = '#555555';
      ctx.font = 'bold 12px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('TOWER SECTION', x, y + 95);
    }
    
    function FIRST_updateStatus() {
      const status = document.getElementById('productStatus');
      if (!status) return;
      
      // Message neutre - ne pas révéler s'il y a des défauts
      status.textContent = '🔍 Inspect the product...';
      status.style.color = '#00D4FF';
    }
    
    // Gérer les clics sur le canvas pour trouver les défauts
    document.addEventListener('DOMContentLoaded', function() {
      const canvas = document.getElementById('productCanvas');
      if (canvas) {
        canvas.addEventListener('click', function(e) {
          if (!gameActive || currentDefects.length === 0) return;
          
          const rect = canvas.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;
          
          // Vérifier si un défaut est cliqué
          for (let defect of currentDefects) {
            if (!foundDefects.includes(defect)) {
              const dist = Math.sqrt((x - defect.x) ** 2 + (y - defect.y) ** 2);
              if (dist < 15) {
                foundDefects.push(defect);
                FIRST_drawDefect(defect.x, defect.y);
                
                if (foundDefects.length === currentDefects.length) {
                  FIRST_updateStatus();
                }
                return;
              }
            }
          }
        });
      }
    });
    
    function FIRST_drawDefect(x, y) {
      const canvas = document.getElementById('productCanvas');
      if (!canvas) return;
      
      const ctx = canvas.getContext('2d');
      // Redessiner le défaut en vert (trouvé)
      ctx.fillStyle = '#10B981';
      ctx.beginPath();
      ctx.arc(x, y, 8, 0, Math.PI * 2);
      ctx.fill();
      
      // Bordure blanche
      ctx.strokeStyle = '#FFFFFF';
      ctx.lineWidth = 2.5;
      ctx.stroke();
      
      // Ajouter une checkmark visible
      ctx.strokeStyle = '#FFFFFF';
      ctx.lineWidth = 2.5;
      ctx.beginPath();
      ctx.moveTo(x - 3, y);
      ctx.lineTo(x, y + 3);
      ctx.lineTo(x + 4, y - 2);
      ctx.stroke();
    }

    window.submitScoreNow = function() {
      const score = {
        name: FIRST_playerName,
        score: gameStats.totalScore,
        good_count: gameStats.productsGood,
        total_count: gameStats.productsInspected,
        quality: gameStats.quality,
        avg_time: (gameStats.productsInspected > 0 ? (gameStats.totalInspectionTime / gameStats.productsInspected).toFixed(1) : 0),
        date: new Date().toISOString()
      };
      
      const local = JSON.parse(localStorage.getItem('leaderboard') || '[]');
      local.push(score);
      local.sort((a, b) => b.score - a.score);
      if (local.length > 100) local.pop();
      localStorage.setItem('leaderboard', JSON.stringify(local));
      
      FIRST_loadLeaderboard();
      FIRST_showLeaderboard();
    };

    function FIRST_showLeaderboard() {
      const local = JSON.parse(localStorage.getItem('leaderboard') || '[]');
      const list = document.getElementById('leaderboardList');
      list.innerHTML = '';
      
      const playerRank = local.findIndex(s => s.name === FIRST_playerName && s.score === gameStats.totalScore) + 1;
      
      document.getElementById('finalEmoji').textContent = RANK_MESSAGES[currentLanguage][gameStats.quality >= 90 ? 'S' : gameStats.quality >= 75 ? 'A' : gameStats.quality >= 60 ? 'B' : gameStats.quality >= 40 ? 'C' : gameStats.quality >= 20 ? 'D' : 'E'].emoji;
      document.getElementById('finalPlayerText').textContent = RANK_MESSAGES[currentLanguage][gameStats.quality >= 90 ? 'S' : gameStats.quality >= 75 ? 'A' : gameStats.quality >= 60 ? 'B' : gameStats.quality >= 40 ? 'C' : gameStats.quality >= 20 ? 'D' : 'E'].messages[0];
      document.getElementById('finalPlayerScore').textContent = gameStats.totalScore;
      document.getElementById('finalPlayerRatio').textContent = `${gameStats.productsGood}/${gameStats.productsInspected} = ${gameStats.quality}%`;
      
      local.slice(0, 20).forEach((s, i) => {
        const grade = s.quality >= 90 ? 'S' : s.quality >= 75 ? 'A' : s.quality >= 60 ? 'B' : s.quality >= 40 ? 'C' : s.quality >= 20 ? 'D' : 'E';
        const isCurrentPlayer = s.name === FIRST_playerName && s.score === gameStats.totalScore;
        const row = document.createElement('div');
        row.className = 'leaderboard-row' + (isCurrentPlayer ? ' highlight' : '');
        row.innerHTML = `
          <div class="leaderboard-rank">#${i+1}</div>
          <div class="leaderboard-name">${s.name}</div>
          <div class="leaderboard-score">${s.score}</div>
          <div class="leaderboard-grade">${grade}</div>
        `;
        list.appendChild(row);
      });
      
      const end = document.getElementById('endGameScreen');
      const board = document.getElementById('leaderboardScreen');
      if (end) end.classList.add('hidden');
      if (board) board.classList.remove('hidden');
    }

    window.showIntroScreenNow = function() {
      const intro = document.getElementById('introScreenAnimated');
      const board = document.getElementById('leaderboardScreen');
      
      FIRST_playerNameValidated = false;
      document.getElementById('playerNameInput').disabled = false;
      document.getElementById('playerNameInput').value = '';
      document.getElementById('clearNameBtn').style.display = 'none';
      document.getElementById('gameNumberBox').style.display = 'none';
      document.getElementById('startGameBtn').disabled = true;
      document.getElementById('startGameBtn').style.opacity = '0.5';
      
      // Bien replier les sections
      document.getElementById('rulesContent').classList.add('collapsed');
      document.getElementById('rulesChevron').classList.add('collapsed');
      document.getElementById('hallContent').classList.add('collapsed');
      document.getElementById('hallChevron').classList.add('collapsed');
      
      document.getElementById('historyTableContainer').style.display = 'none';
      
      if (intro) intro.style.display = 'flex';
      if (board) board.classList.add('hidden');
    };

    window.FIRST_showEasterEgg = function() {
      const overlay = document.getElementById('easterOverlay');
      if (overlay) {
        overlay.style.display = 'flex';
        FIRST_createFireworks();
        setTimeout(() => { overlay.style.display = 'none'; }, 5000);
      }
    };

    function FIRST_createFireworks() {
      const container = document.getElementById('fireworksContainer');
      if (!container) return;
      container.innerHTML = '';
      const colors = ['#FF5716', '#FFD700', '#00A8E9'];
      for (let i = 0; i < 80; i++) {
        setTimeout(() => {
          const fw = document.createElement('div');
          fw.className = 'firework';
          fw.style.background = colors[Math.floor(Math.random() * colors.length)];
          fw.style.left = (50 + Math.cos((Math.PI * 2 * i) / 80) * 30) + '%';
          fw.style.top = (50 + Math.sin((Math.PI * 2 * i) / 80) * 30) + '%';
          fw.style.setProperty('--tx', Math.cos((Math.PI * 2 * i) / 80) * 150 + 'px');
          fw.style.setProperty('--ty', Math.sin((Math.PI * 2 * i) / 80) * 150 + 'px');
          fw.style.animation = `firework ${1.2 + Math.random() * 0.6}s ease-out forwards`;
          container.appendChild(fw);
        }, i * 20);
      }
    }

    window.quitGameNow = function() {
      gameActive = false;
      if (gameTimer) clearInterval(gameTimer);
      
      gameStats.quality = gameStats.productsInspected > 0 ? Math.round((gameStats.productsGood / gameStats.productsInspected) * 100) : 0;
      const rank = gameStats.quality >= 90 ? 'S' : gameStats.quality >= 75 ? 'A' : gameStats.quality >= 60 ? 'B' : gameStats.quality >= 40 ? 'C' : gameStats.quality >= 20 ? 'D' : 'E';
      
      document.querySelectorAll('.rank-node').forEach(n => n.classList.remove('active'));
      const nodeEl = document.querySelector(`.rank-node.${rank}`);
      if (nodeEl) nodeEl.classList.add('active');

      document.getElementById('performanceEmoji').textContent = RANK_MESSAGES[currentLanguage][rank].emoji;
      document.getElementById('performanceText').innerHTML = `<strong style="font-size: 1.3rem; color: #00A8E9;">${RANK_MESSAGES[currentLanguage][rank].messages[0]}</strong>`;
      document.getElementById('finalRatio').textContent = `${gameStats.productsGood}/${gameStats.productsInspected} = ${gameStats.quality}%`;
      document.getElementById('finalScore').textContent = gameStats.totalScore;
      document.getElementById('maxComboDisplay').textContent = gameStats.maxCombo;
      document.getElementById('avgTime').textContent = (gameStats.productsInspected > 0 ? (gameStats.totalInspectionTime / gameStats.productsInspected).toFixed(1) : 0) + 's';

      const gameScreen = document.getElementById('gameScreen');
      const endScreen = document.getElementById('endGameScreen');
      if (gameScreen) gameScreen.classList.add('hidden');
      if (endScreen) endScreen.classList.remove('hidden');
    };

    async function FIRST_loadLeaderboard() {
      // Essayer Supabase d'abord
      try {
        if (typeof supabase !== 'undefined') {
          const { data, error } = await supabase
            .from('leaderboard')
            .select('*')
            .order('score', { ascending: false })
            .limit(20);
          
          if (!error && data && data.length > 0) {
            // Formater les données pour l'affichage
            const formattedData = data.map(item => ({
              name: item.name,
              score: item.score,
              grade: item.grade,
              good: item.good,
              total: item.total,
              quality: item.quality,
              date: item.created_at
            }));
            
            FIRST_displayLeaderboard(formattedData);
            FIRST_updateTimestamp(true);
            FIRST_displaySourceIcon(true);
            return;
          }
        }
      } catch (err) {
      }
      
      // Fallback sur localStorage
      FIRST_loadLeaderboardFallback();
    }

     function FIRST_loadLeaderboardFallback() {
      const local = JSON.parse(localStorage.getItem('leaderboard') || '[]');
      FIRST_displayLeaderboard(local.slice(0, 20));
      FIRST_updateTimestamp(false);
      FIRST_displaySourceIcon(false);
    }
    
    function FIRST_displaySourceIcon(isCloud) {
      const icon = isCloud ? '☁️' : '💻';
      const tooltip = isCloud ? 'Données cloud (Supabase) - Cliquez pour actualiser' : 'Données locales (localStorage) - Cliquez pour actualiser';
      
      const iconEl = document.getElementById('hallSourceIcon');
      if (iconEl) {
        iconEl.textContent = icon;
        iconEl.title = tooltip;
      }
    }

    function FIRST_updateTimestamp(isCloud) {
      const date = new Date();
      const day = String(date.getDate()).padStart(2, '0');
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const year = String(date.getFullYear()).slice(-2);
      const hours = String(date.getHours()).padStart(2, '0');
      const mins = String(date.getMinutes()).padStart(2, '0');
      const secs = String(date.getSeconds()).padStart(2, '0');
      
      const icon = isCloud ? '☁️' : '💻';
      document.getElementById('updateTimeText').textContent = `${icon} Updated ${day}/${month}/${year} ${hours}:${mins}:${secs}`;
    }

    function FIRST_displayLeaderboard(scores) {
      const introList = document.getElementById('introLeaderboardList');
      introList.innerHTML = '';
      
      if (!scores || scores.length === 0) {
        introList.innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.95); font-weight: bold; font-size: 0.95rem;"><p style="margin-bottom: 3px;">⭐ No scores yet!</p><p>Be the first!</p></div>';
        return;
      }
      
      scores.slice(0, 15).forEach((s, i) => {
        const grade = s.quality >= 90 ? 'S' : s.quality >= 75 ? 'A' : s.quality >= 60 ? 'B' : s.quality >= 40 ? 'C' : s.quality >= 20 ? 'D' : 'E';
        const medals = { 1: '🥇', 2: '🥈', 3: '🥉' };
        const medal = medals[i + 1] || '🎖️';
        
        // Couleurs du grade - alignées avec le leaderboard final
        const gradeColors = {
          'S': '#FFD700',
          'A': '#FF6B00',
          'B': '#FF5716',
          'C': '#10B981',
          'D': '#00A8E9',
          'E': '#EF4444'
        };
        const gradeColor = gradeColors[grade] || '#FFD700';
        
        // Couleurs éclatantes par rang
        const rankColors = {
          1: { bg: '#FFD700', glow: 'rgba(255, 215, 0, 0.6)', textLight: '#000' },
          2: { bg: '#E8E8E8', glow: 'rgba(232, 232, 232, 0.6)', textLight: '#000' },
          3: { bg: '#FF8C00', glow: 'rgba(255, 140, 0, 0.6)', textLight: '#fff' }
        };
        const defaultColor = { bg: 'rgba(0, 168, 233, 0.7)', glow: 'rgba(0, 168, 233, 0.4)', textLight: '#fff' };
        const colors = rankColors[i + 1] || defaultColor;
        
        const date = new Date(s.date || Date.now());
        const day = String(date.getDate()).padStart(2, '0');
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const year = String(date.getFullYear()).slice(-2);
        const hours = String(date.getHours()).padStart(2, '0');
        const mins = String(date.getMinutes()).padStart(2, '0');
        
        const row = document.createElement('div');
        row.style.cssText = `
          display: flex;
          align-items: center;
          gap: 12px;
          padding: 10px 12px;
          background: ${i + 1 <= 3 ? colors.bg : 'rgba(20, 30, 50, 0.8)'};
          border: 2px solid ${i + 1 <= 3 ? colors.bg : 'rgba(0, 168, 233, 0.5)'};
          border-radius: 8px;
          margin-bottom: 6px;
          transition: all 0.25s;
          box-shadow: ${i + 1 <= 3 ? `0 0 15px ${colors.glow}` : '0 2px 6px rgba(0, 0, 0, 0.4)'};
        `;
        row.onmouseover = function() { 
          this.style.transform = 'translateX(8px) scale(1.02)';
          this.style.boxShadow = i + 1 <= 3 
            ? `0 0 25px ${colors.glow}, 0 8px 16px rgba(0, 0, 0, 0.4)` 
            : '0 4px 12px rgba(0, 168, 233, 0.5)';
        };
        row.onmouseout = function() { 
          this.style.transform = 'translateX(0) scale(1)';
          this.style.boxShadow = i + 1 <= 3 
            ? `0 0 15px ${colors.glow}` 
            : '0 2px 6px rgba(0, 0, 0, 0.4)';
        };
        
        row.innerHTML = `
          <div style="display: flex; align-items: center; gap: 6px; min-width: 50px; flex-shrink: 0;">
            <div style="color: ${i + 1 <= 3 ? colors.textLight : '#FFD700'}; font-weight: 900; font-size: 0.9rem;">#${i+1}</div>
            <div style="font-size: 1.8rem;">${medal}</div>
          </div>
          
          <div style="flex: 1; min-width: 0; overflow: hidden;">
            <div style="color: ${i + 1 <= 3 ? colors.textLight : '#FFFFFF'}; font-weight: 900; font-size: 1rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; ${i + 1 <= 3 ? 'text-shadow: 0 1px 2px rgba(0,0,0,0.3)' : ''};">${s.name}</div>
            <div style="color: ${i + 1 <= 3 ? colors.textLight : '#00A8E9'}; font-weight: 600; font-size: 0.7rem; opacity: ${i + 1 <= 3 ? '0.8' : '0.9'};">${day}/${month}/${year} ${hours}:${mins}</div>
          </div>
          
          <div style="text-align: right; min-width: 70px; flex-shrink: 0;">
            <div style="color: ${i + 1 <= 3 ? colors.textLight : '#10B981'}; font-weight: 900; font-size: 1.15rem; ${i + 1 <= 3 ? 'text-shadow: 0 1px 2px rgba(0,0,0,0.3)' : 'text-shadow: 0 1px 3px rgba(0,0,0,0.5)'};">${s.score}</div>
            <div style="color: ${gradeColor}; font-weight: 900; font-size: 0.85rem; opacity: 1;">${grade}</div>
          </div>
        `;
        introList.appendChild(row);
      });
    }

    window.addEventListener('load', () => {
      const saved = localStorage.getItem('playerName');
      if (saved) document.getElementById('playerNameInput').value = saved;
      
      FIRST_loadLeaderboard();
    });
  </script>

  
TYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Offshore Equipment Inspector</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;900&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: 'Poppins', sans-serif; 
      background: linear-gradient(135deg, #0a0e27 0%, #1a1f2e 100%);
      color: #ccc; 
      overflow: hidden; 
      height: 100vh;
    }

    /* ===== HEADER ===== */
    .header {
      background: linear-gradient(90deg, #0254A0 0%, #00A8E9 100%);
      height: 45px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 20px;
      border-bottom: 3px solid #00A8E9;
      box-shadow: 0 4px 20px rgba(0, 168, 233, 0.4);
    }

    .headerTitle { 
      font-size: 1rem; 
      font-weight: 900; 
      color: white;
    }

    .headerRight {
      font-size: 0.75rem;
      color: white;
    }

    /* ===== TIMER BAR ===== */
    .gameStatusBar {
      background: linear-gradient(90deg, #0254A0 0%, #00A8E9 100%);
      height: 70px;
      display: flex;
      justify-content: flex-start;
      align-items: center;
      padding: 0 20px;
      gap: 8px;
      border-bottom: 2px solid #00A8E9;
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.1), 0 4px 20px rgba(0, 168, 233, 0.2);
    }

    .timerDisplay {
      font-size: 2rem;
      font-weight: 900;
      color: #FFD700;
      font-family: 'Courier New', monospace;
      letter-spacing: 2px;
      min-width: 90px;
      animation: electric-pulse 0.4s ease-in-out infinite;
      filter: drop-shadow(0 0 12px rgba(255, 215, 0, 0.9));
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
    }


    .windmill {
      width: 45px;
      height: 45px;
      animation: spin 1.5s linear infinite;
      filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.4));
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .timerBarContainer {
      flex: 1;
      max-width: none;
      height: 20px;
      background: linear-gradient(90deg, #000000 0%, rgba(0, 0, 0, 0.7) 50%, #000000 100%);
      border-radius: 15px;
      overflow: hidden;
      border: 2px solid rgba(0, 168, 233, 0.7);
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.8), 0 0 15px rgba(0, 168, 233, 0.3);
    }

    .timerFill {
      height: 100%;
      background: linear-gradient(90deg, 
        transparent 0%, 
        rgba(0, 212, 255, 0.3) 20%,
        rgba(0, 168, 233, 0.6) 50%, 
        rgba(0, 212, 255, 0.3) 80%,
        transparent 100%);
      background-size: 200% 100%;
      animation: electricity-flow 1.5s linear infinite;
      width: 100%;
      box-shadow: 
        inset 0 0 30px rgba(0, 212, 255, 0.6),
        inset -3px 0 15px rgba(0, 212, 255, 0.5),
        0 0 30px rgba(0, 168, 233, 0.5);
    }

    @keyframes electricity-flow {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    .windWave {
      font-size: 1.3rem;
      animation: wave 0.6s ease-in-out infinite;
      margin-right: -8px;
      margin-left: -5px;
    }

    @keyframes wave {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 1; }
    }

    /* ===== GAME ZONE ===== */
    .gameZone {
      display: grid;
      grid-template-columns: 1fr 18%;
      gap: 15px;
      padding: 15px;
      height: calc(100vh - 115px);
      background: linear-gradient(135deg, #0a0e27 0%, #1a1f2e 100%);
    }

    /* ===== INSPECTION ZONE (TABLEAU 2 COL) ===== */
    .inspectionZone {
      display: grid;
      grid-template-columns: 1fr 140px;
      grid-template-rows: auto auto 1fr;
      gap: 12px;
      background: rgba(2, 84, 160, 0.1);
      border: 2px solid rgba(0, 168, 233, 0.25);
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 4px 15px rgba(2, 84, 160, 0.15);
    }

    /* Ligne 1: INSPECTION | Give Up */
    .inspectionHeader {
      grid-column: 1 / 2;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .inspectionTitle {
      font-size: 1rem;
      font-weight: 900;
      color: #FFD700;
      text-shadow: 0 0 8px rgba(255, 215, 0, 0.4);
    }

    .giveUpBtn {
      grid-column: 2 / 3;
      grid-row: 1 / 2;
      padding: 8px 14px;
      background: linear-gradient(135deg, #7B7B7B 0%, #5C5C5C 100%);
      color: white;
      border: 1px solid #4a4a4a;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      font-size: 0.8rem;
      transition: all 0.2s;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .giveUpBtn:hover {
      transform: translateY(-1px);
      background: linear-gradient(135deg, #8A8A8A 0%, #6B6B6B 100%);
    }

    /* Ligne 2: Status | (vide) */
    .statusBox {
      grid-column: 1 / 2;
      grid-row: 2 / 3;
      background: linear-gradient(90deg, rgba(0, 168, 233, 0.15), rgba(0, 168, 233, 0.08));
      border: 2px solid rgba(0, 168, 233, 0.35);
      border-radius: 8px;
      padding: 10px;
      text-align: center;
      min-height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 10px rgba(0, 168, 233, 0.1);
    }

    .statusMessage {
      color: #00A8E9;
      font-size: 0.8rem;
      font-weight: 600;
    }

    /* Ligne 3-4: ZONE DESSIN (fusionnée 2 lignes) | BUTTONS */
    .drawingZone {
      grid-column: 1 / 2;
      grid-row: 3 / 5;
      background: linear-gradient(135deg, #001a33 0%, #003d66 100%);
      border: 3px solid #10B981;
      border-radius: 12px;
      padding: 15px;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: auto;
      box-shadow: 0 8px 30px rgba(16, 185, 129, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.05);
    }

    #productCanvas {
      max-width: 280px;
      max-height: 280px;
      background: linear-gradient(135deg, #001a33 0%, #003d66 100%);
      border-radius: 8px;
      cursor: none;
    }

    /* ===== LOUPE INTERACTIVE ===== */
    .magnifyingGlass {
      position: fixed;
      width: 35px;
      height: 35px;
      border: 1.5px solid #FFD700;
      border-radius: 50%;
      pointer-events: none;
      z-index: 500;
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.6), inset 0 0 10px rgba(255, 215, 0, 0.2);
      display: none;
    }

    .magnifyingGlass.active {
      display: block;
    }

    .magnifyingGlassHandle {
      position: fixed;
      width: 3px;
      height: 12px;
      background: linear-gradient(45deg, #FFD700, #FFA500);
      pointer-events: none;
      z-index: 500;
      display: none;
      transform: rotate(45deg);
      bottom: -10px;
      right: -10px;
      box-shadow: 0 0 8px rgba(255, 215, 0, 0.5);
    }

    .magnifyingGlassHandle.active {
      display: block;
    }

    .searchZone {
      position: fixed;
      background: rgba(0, 0, 0, 0.8);
      border: 1px solid rgba(255, 215, 0, 0.4);
      border-radius: 4px;
      padding: 2px 6px;
      font-size: 0.6rem;
      color: #FFD700;
      pointer-events: none;
      z-index: 501;
      display: none;
      white-space: nowrap;
      text-shadow: 0 0 8px rgba(255, 215, 0, 0.4);
    }

    .searchZone.active {
      display: block;
    }

    /* ===== OVERLAY RÈGLES ===== */
    .rulesOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(0, 0, 0, 0.4) 0%, rgba(2, 84, 160, 0.25) 100%);
      z-index: 1000;
      display: flex;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(3px);
      padding: 20px;
    }

    .rulesContainer {
      background: linear-gradient(135deg, rgba(2, 84, 160, 0.3) 0%, rgba(0, 168, 233, 0.2) 100%);
      border: 2px solid rgba(0, 168, 233, 0.5);
      border-radius: 16px;
      padding: 25px;
      max-width: 95vw;
      max-height: 65vh;
      width: 100%;
      text-align: center;
      box-shadow: 0 0 50px rgba(0, 168, 233, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.05);
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 20px;
      align-items: start;
    }

    @media (max-width: 1200px) {
      .rulesContainer {
        grid-template-columns: 1fr 1fr;
      }
    }

    @media (max-width: 768px) {
      .rulesContainer {
        grid-template-columns: 1fr;
        padding: 20px;
      }
    }

    .rulesTitle {
      font-size: 1.6rem;
      font-weight: 900;
      color: #FFD700;
      margin-bottom: 12px;
      text-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
      letter-spacing: 1px;
      grid-column: 1 / -1;
    }

    .rulesSection {
      text-align: left;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .rulesSectionTitle {
      font-size: 1rem;
      font-weight: 900;
      color: #FFD700;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .rulesContent {
      color: #00A8E9;
      font-size: 0.8rem;
      line-height: 1.5;
    }

    .rulesContent ul {
      list-style: none;
      padding: 0;
    }

    .rulesContent li {
      margin: 4px 0;
      padding-left: 18px;
      position: relative;
    }

    .rulesContent li:before {
      content: "✓";
      position: absolute;
      left: 0;
      color: #10B981;
      font-weight: bold;
      font-size: 0.9rem;
    }

    .rulesStat {
      background: rgba(0, 168, 233, 0.1);
      border-left: 2px solid #FFD700;
      padding: 6px;
      margin: 4px 0;
      border-radius: 3px;
      font-weight: 600;
      font-size: 0.78rem;
    }

    .startButton {
      padding: 11px 40px;
      background: linear-gradient(135deg, #10B981 0%, #059669 100%);
      color: white;
      border: 2px solid #059669;
      border-radius: 8px;
      font-size: 0.95rem;
      font-weight: 900;
      cursor: pointer;
      transition: all 0.3s;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      box-shadow: 0 6px 15px rgba(16, 185, 129, 0.3);
      grid-column: 1 / -1;
      margin-top: 10px;
    }

    .startButton:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(16, 185, 129, 0.5);
    }

    .startButton:active {
      transform: translateY(-1px);
    }

    .rulesOverlay.hidden {
      display: none;
    }

    .rulesOverlay.hidden {
      display: none;
    }

    /* Boutons côté droit */
    .buttonColumn {
      grid-column: 2 / 3;
      grid-row: 3 / 5;
      display: flex;
      flex-direction: column;
      gap: 0;
    }

    .btn {
      border: none;
      border-radius: 0;
      cursor: pointer;
      font-weight: 900;
      font-size: 0.75rem;
      transition: all 0.2s;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      flex: 1;
      min-height: 50px;
    }

    .btn:first-child {
      border-radius: 8px 8px 0 0;
    }

    .btn:last-child {
      border-radius: 0 0 8px 8px;
    }

    .btnAccept {
      background: linear-gradient(135deg, #10B981 0%, #059669 100%);
      color: white;
      border: 1px solid #059669;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }

    .btnAccept:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(16, 185, 129, 0.45);
    }

    .btnReject {
      background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
      color: white;
      border: 1px solid #DC2626;
      box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
    }

    .btnReject:hover {
      transform: translateY(2px);
      box-shadow: 0 6px 16px rgba(239, 68, 68, 0.45);
    }

    /* ===== KPI ZONE ===== */
    .kpiZone {
      background: linear-gradient(135deg, rgba(2, 84, 160, 0.2), rgba(0, 168, 233, 0.1));
      border: 2px solid rgba(0, 168, 233, 0.35);
      border-radius: 12px;
      padding: 15px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(2, 84, 160, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.05);
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .kpiZoneTitle {
      font-size: 0.75rem;
      font-weight: 900;
      color: #FFD700;
      text-transform: uppercase;
      letter-spacing: 0.4px;
      text-shadow: 0 0 8px rgba(255, 215, 0, 0.4);
      text-align: center;
      padding: 4px 0;
      border-bottom: 1px solid rgba(0, 168, 233, 0.2);
      margin-bottom: 6px;
    }

    .kpiSection {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .kpiSectionTitle {
      font-size: 0.65rem;
      font-weight: 900;
      color: #FFD700;
      text-transform: uppercase;
      letter-spacing: 0.3px;
      text-shadow: 0 0 6px rgba(255, 215, 0, 0.4);
      margin-bottom: 3px;
      line-height: 1;
    }

    .kpiBlock {
      background: linear-gradient(135deg, rgba(0, 168, 233, 0.15) 0%, rgba(0, 168, 233, 0.05) 100%);
      border: 1px solid rgba(0, 168, 233, 0.25);
      border-radius: 5px;
      padding: 5px 3px;
      text-align: center;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
      margin-bottom: 3px;
    }

    .kpiLabel {
      font-size: 0.6rem;
      color: #00A8E9;
      text-transform: uppercase;
      margin-bottom: 1px;
      letter-spacing: 0.1px;
      font-weight: 600;
      line-height: 1;
    }

    .kpiValue {
      font-size: 1rem;
      font-weight: 900;
      color: #10B981;
      text-shadow: 0 0 5px rgba(16, 185, 129, 0.4);
      line-height: 1;
      transition: all 0.3s ease;
    }

    .kpiBlockDecisions {
      background: linear-gradient(135deg, rgba(0, 168, 233, 0.15) 0%, rgba(0, 168, 233, 0.05) 100%);
      border: 1px solid rgba(0, 168, 233, 0.25);
      border-radius: 5px;
      padding: 4px 2px;
      text-align: center;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
      margin-bottom: 2px;
    }

    .kpiDecisionsRow {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2px;
      margin-top: 2px;
    }

    .kpiDecisionItem {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 3px;
      padding: 2px;
    }

    .kpiDecisionLabel {
      font-size: 0.48rem;
      color: #00A8E9;
      text-transform: uppercase;
      letter-spacing: 0.1px;
      font-weight: 600;
      line-height: 1;
      margin-bottom: 1px;
    }

    .kpiLabel {
      font-size: 0.52rem;
      color: #00A8E9;
      text-transform: uppercase;
      margin-bottom: 0px;
      letter-spacing: 0.1px;
      font-weight: 600;
      line-height: 1;
    }

    .kpiValue {
      font-size: 0.85rem;
      font-weight: 900;
      color: #10B981;
      text-shadow: 0 0 5px rgba(16, 185, 129, 0.4);
      line-height: 1;
      transition: all 0.3s ease;
    }

    /* Inspected - Gris */
    #kpiInspected {
      color: #888;
      background: rgba(80, 80, 80, 0.15);
      padding: 2px;
      border-radius: 3px;
    }

    /* Quality - Vert vers Doré */
    #kpiQuality {
      transition: all 0.3s ease;
    }

    /* Wrong Decision - Orange/Rouge */
    #kpiWrong {
      color: #FF5716;
      text-shadow: 0 0 5px rgba(255, 87, 22, 0.4);
    }

    /* Combo - Change couleur + animation */
    #kpiCombo {
      transition: all 0.3s ease;
    }

    @keyframes comboGlow {
      0% { text-shadow: 0 0 5px rgba(16, 185, 129, 0.4); }
      50% { text-shadow: 0 0 12px rgba(16, 185, 129, 0.8); }
      100% { text-shadow: 0 0 5px rgba(16, 185, 129, 0.4); }
    }

    /* Average Time - Vert vers Noir */
    #kpiAvgTime {
      transition: all 0.3s ease;
    }

    @keyframes tremble {
      0%, 100% { transform: rotate(0deg) scale(1); }
      10% { transform: rotate(-2deg) scale(1.05); }
      20% { transform: rotate(2deg) scale(1.05); }
      30% { transform: rotate(-2deg) scale(1.05); }
      40% { transform: rotate(2deg) scale(1.05); }
      50% { transform: rotate(-1deg) scale(1.05); }
      60% { transform: rotate(1deg) scale(1.05); }
      70% { transform: rotate(-1deg) scale(1.05); }
      80% { transform: rotate(1deg) scale(1.05); }
      90% { transform: rotate(0deg) scale(1); }
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    #kpiStatus {
      font-size: 1.2rem;
      animation: tremble 0.6s ease-in-out infinite, pulse 1.2s ease-in-out infinite;
      display: inline-block;
    }

    /* ===== RESIZABLE DIVIDER ===== */
    .resizableDivider {
      position: fixed;
      width: 6px;
      height: calc(100vh - 115px);
      top: 115px;
      cursor: col-resize;
      background: linear-gradient(90deg, transparent, rgba(0, 168, 233, 0.3), transparent);
      transition: background 0.2s;
      z-index: 100;
    }

    .resizableDivider:hover {
      background: linear-gradient(90deg, transparent, rgba(0, 168, 233, 0.8), transparent);
    }

    .feedbackMessage {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(135deg, rgba(0, 0, 0, 0.95) 0%, rgba(10, 14, 39, 0.95) 100%);
      color: #FFD700;
      padding: 30px 50px;
      border-radius: 12px;
      font-size: 1.3rem;
      font-weight: bold;
      z-index: 1000;
      display: none;
      text-align: center;
      border: 2px solid rgba(255, 215, 0, 0.3);
      box-shadow: 0 0 40px rgba(255, 215, 0, 0.2);
    }

    @keyframes stampStamp {
      0% {
        transform: translate(-50%, -50%) scale(0.3) rotate(-15deg);
        opacity: 0;
      }
      50% {
        transform: translate(-50%, -50%) scale(1.1) rotate(5deg);
        opacity: 1;
      }
      100% {
        transform: translate(-50%, -50%) scale(1) rotate(0deg);
        opacity: 1;
      }
    }

    .stamp {
      position: fixed;
      top: 50%;
      left: 50%;
      font-size: 8rem;
      font-weight: bold;
      z-index: 999;
      pointer-events: none;
      animation: stampStamp 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    }

    .stamp.accept {
      color: #10B981;
      text-shadow: 0 0 30px rgba(16, 185, 129, 0.8);
      transform: translate(-50%, -50%) rotate(25deg);
    }

    .stamp.reject {
      color: #EF4444;
      text-shadow: 0 0 30px rgba(239, 68, 68, 0.8);
      transform: translate(-50%, -50%) rotate(-25deg);
    }
  

    /* ===== LEADERBOARD PAGE STYLES ===== */
    #leaderboardPage {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #0254A0 0%, #00A8E9 100%);
      z-index: 10000;
      padding: 10px;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .leaderboard-container {
      background: rgba(0, 0, 0, 0.3);
      border: 3px solid #FFD700;
      border-radius: 15px;
      padding: 15px;
      max-width: 1200px;
      width: 100%;
      overflow: auto;
      display: flex;
      flex-direction: column;
      max-height: 95vh;
      min-height: 80vh;
    }

    .header-section {
      position: relative;
      width: 100%;
      margin-bottom: 12px;
    }

    .header-section h1 {
      text-align: center;
      font-size: 1.8rem;
      font-weight: 900;
      color: #FFD700;
      margin: 0;
      text-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
    }

    .play-again-btn {
      position: absolute;
      top: 0;
      right: 0;
      padding: 4px 8px;
      font-size: 0.6rem;
      background: linear-gradient(135deg, #0254A0, #00A8E9);
      border: 2px solid #FFD700;
      color: #FFD700;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 900;
    }

    .play-again-btn:hover {
      background: linear-gradient(135deg, #00A8E9, #0254A0);
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
    }

    .main-layout {
      display: grid;
      grid-template-columns: 40% 60%;
      gap: 12px;
    }

    .left-panel {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .well-done {
      color: #FFFFFF;
      font-size: 1.3rem;
      font-weight: 900;
      text-align: center;
      margin-bottom: 8px;
      text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
    }

    .ranks-results-container { display: flex; flex-direction: column; gap: 8px; }
    .ranks-table { width: 100%; border-collapse: collapse; background: rgba(0, 0, 0, 0.2); border-radius: 8px; overflow: hidden; border: 2px solid #FFD700; box-shadow: 0 0 15px rgba(255, 215, 0, 0.4); }
    .ranks-table tr { border-bottom: 1px solid rgba(0, 168, 233, 0.2); height: 24px; }
    .ranks-table tr:last-child { border-bottom: none; }
    .ranks-table tbody tr:hover .rank-letter,
    .ranks-table tbody tr:hover .rank-word-cell {
      opacity: 1 !important;
      filter: brightness(1.3) !important;
    }
    .ranks-table tbody tr:hover .rank-letter {
      filter: brightness(1.5) drop-shadow(0 0 10px currentColor) !important;
    }
    .ranks-table td { padding: 1px 6px; vertical-align: middle; }
    .rank-letter-cell { width: 40px; text-align: center; }
    .rank-letter { font-size: 2.5rem; font-weight: 900; font-style: italic; line-height: 1; opacity: 0.2; filter: brightness(0.4); cursor: pointer; transition: all 0.3s ease; }
    .rank-letter:hover { opacity: 1; filter: brightness(1.2); }
    .rank-letter.rank-s { color: #FF1493; }
    .rank-letter.active-rank { opacity: 1 !important; filter: brightness(1.3) drop-shadow(0 0 8px currentColor) !important; }

    /* ===== RANKS TABLE - NEW LIST FORMAT ===== */
    .ranks-table-list {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 8px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      overflow: hidden;
      border: 2px solid #FFD700;
      padding: 8px;
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
    }

    .rank-row {
      display: grid;
      grid-template-columns: 30px 40px 95px 1fr;
      gap: 12px;
      align-items: center;
      justify-items: start;
      padding: 12px 12px;
      border-radius: 8px;
      background: linear-gradient(135deg, rgba(20, 30, 50, 0.6) 0%, rgba(15, 23, 42, 0.6) 100%);
      border: 1px solid rgba(0, 168, 233, 0.2);
      transition: all 0.3s ease;
      cursor: pointer;
      opacity: 0.5;
      filter: brightness(0.6);
    }

    .rank-row:hover {
      opacity: 1 !important;
      filter: brightness(1) !important;
      border-color: rgba(0, 168, 233, 0.6) !important;
      box-shadow: 0 0 15px rgba(0, 168, 233, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1) !important;
      transform: translateX(4px);
    }

    .rank-row.active-rank {
      opacity: 1 !important;
      filter: brightness(1) !important;
      border-color: #FFD700 !important;
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.2) !important;
    }

    .rank-emoji {
      font-size: 1.5rem;
      flex-shrink: 0;
      text-align: center;
    }

    .rank-letter {
      font-size: 1.8rem;
      font-weight: 900;
      font-style: italic;
      text-align: center;
      flex-shrink: 0;
      transition: all 0.3s ease;
    }

    .rank-range {
      font-size: 0.85rem;
      font-weight: 700;
      color: #00D4FF;
      text-align: center;
      flex-shrink: 0;
      transition: all 0.3s ease;
      min-width: 80px;
    }

    .rank-word {
      font-size: 1rem;
      font-weight: 900;
      font-style: italic;
      letter-spacing: 1px;
      text-transform: uppercase;
      transition: all 0.3s ease;
      text-align: left;
    }

    /* Color definitions for each rank */
    .rank-s-row .rank-letter { color: #FF1493; }
    .rank-a-row .rank-letter { color: #00A8E9; }
    .rank-b-row .rank-letter { color: #10B981; }
    .rank-c-row .rank-letter { color: #ADFF2F; }
    .rank-d-row .rank-letter { color: #FFD700; }
    .rank-e-row .rank-letter { color: #E8E8E8; }

    .rank-s-row .rank-word { color: #FF1493; text-shadow: 0 0 8px rgba(255, 20, 147, 0.6); }
    .rank-a-row .rank-word { color: #00A8E9; text-shadow: 0 0 8px rgba(0, 168, 233, 0.6); }
    .rank-b-row .rank-word { color: #10B981; text-shadow: 0 0 8px rgba(16, 185, 129, 0.6); }
    .rank-c-row .rank-word { color: #ADFF2F; text-shadow: 0 0 8px rgba(173, 255, 47, 0.6); }
    .rank-d-row .rank-word { color: #FFD700; text-shadow: 0 0 8px rgba(255, 215, 0, 0.6); }
    .rank-e-row .rank-word { color: #E8E8E8; text-shadow: 0 0 8px rgba(232, 232, 232, 0.4); }
    .rank-letter.active-rank.rank-s { color: #FF1493; text-shadow: 0 0 15px rgba(255, 20, 147, 0.8); }
    .rank-letter.active-rank.rank-a { color: #00BFFF; text-shadow: 0 0 15px rgba(0, 191, 255, 0.8); }
    .rank-letter.active-rank.rank-b { color: #00FF00; text-shadow: 0 0 15px rgba(0, 255, 0, 0.8); }
    .rank-letter.active-rank.rank-c { color: #ADFF2F; text-shadow: 0 0 15px rgba(173, 255, 47, 0.8); }
    .rank-letter.active-rank.rank-d { color: #FFD700; text-shadow: 0 0 15px rgba(255, 215, 0, 0.8); }
    .rank-letter.active-rank.rank-e { color: #E8E8E8; text-shadow: 0 0 15px rgba(232, 232, 232, 0.8); }
    .rank-word-cell.rank-s-word { 
      color: #FF1493; 
    }
    .rank-word-cell.rank-a-word { 
      color: #00BFFF; 
    }
    .rank-word-cell.rank-b-word { 
      color: #00FF00; 
    }
    .rank-word-cell.rank-c-word { 
      color: #ADFF2F; 
    }
    .rank-word-cell.rank-d-word { 
      color: #FF8C00; 
    }
    .rank-word-cell.rank-e-word { 
      color: #E8E8E8; 
    }
    .rank-word-cell.active-rank { 
      opacity: 1 !important; 
      filter: brightness(1.3) !important; 
      font-weight: 900; 
    }

    .ranks-score-box { 
      background: rgba(0, 0, 0, 0.4); 
      border: 2px solid #FFD700; 
      border-radius: 8px; 
      padding: 20px 15px; 
      display: flex; 
      flex-direction: column; 
      gap: 12px; 
      text-align: center; 
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.3); 
    }
    .player-name-score { 
      color: #00BFFF; 
      font-weight: 900; 
      font-size: 1rem; 
    }
    .score-emoji { 
      font-size: 2.5rem; 
      line-height: 1; 
      margin: 4px 0; 
    }
    .score-label { 
      color: #FFD700; 
      font-weight: 900; 
      font-size: 0.9rem; 
      letter-spacing: 1px; 
      text-transform: uppercase; 
      transition: all 0.3s ease;
    }
    .score-label.rank-s { 
      color: #FF1493; 
      text-shadow: 0 0 15px rgba(255, 20, 147, 0.8); 
    }
    .score-label.rank-a { 
      color: #00BFFF; 
      text-shadow: 0 0 15px rgba(0, 191, 255, 0.8); 
    }
    .score-label.rank-b { 
      color: #00FF00; 
      text-shadow: 0 0 15px rgba(0, 255, 0, 0.8); 
    }
    .score-label.rank-c { 
      color: #ADFF2F; 
      text-shadow: 0 0 15px rgba(173, 255, 47, 0.8); 
    }
    .score-label.rank-d { 
      color: #FFD700; 
      text-shadow: 0 0 15px rgba(255, 215, 0, 0.8); 
    }
    .score-label.rank-e { 
      color: #E8E8E8; 
      text-shadow: 0 0 15px rgba(232, 232, 232, 0.8); 
    }
    .score-value { 
      color: #10B981; 
      font-weight: 900; 
      font-size: 2rem; 
      text-shadow: 0 0 8px rgba(16, 185, 129, 0.5); 
      line-height: 1; 
    }
    .score-ratio { 
      color: #00D4FF; 
      font-weight: 700; 
      font-size: 0.85rem; 
    }

    .ranks-results-box { background: rgba(0, 0, 0, 0.4); border: 2px solid #FFD700; border-radius: 8px; padding: 8px; box-shadow: 0 0 15px rgba(255, 215, 0, 0.3); }
    .results-title { color: #FFD700; font-weight: 900; text-align: center; margin-bottom: 4px; font-size: 0.9rem; }
    .results-list { display: grid; grid-template-columns: repeat(4, 1fr); gap: 4px; width: 100%; }
    .result-group { display: flex; gap: 3px; justify-content: center; }
    .result-emoji { font-size: 0.9rem; font-weight: bold; }
    .result-emoji.success { color: #10B981; text-shadow: 0 0 5px rgba(16, 185, 129, 0.5); }
    .result-emoji.error { color: #EF4444; text-shadow: 0 0 5px rgba(239, 68, 68, 0.5); }

    .right-panel {
            overflow-y: auto;
            max-height: 600px;
            flex: 1;
        }

        .leaderboard-row {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            margin-bottom: 6px;
            background: rgba(0, 168, 233, 0.15);
            border-radius: 6px;
            border: 1px solid rgba(0, 168, 233, 0.3);
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }

        .leaderboard-row:hover {
            background: rgba(0, 168, 233, 0.25);
            border-color: rgba(255, 215, 0, 0.6);
            box-shadow: 0 0 10px rgba(0, 168, 233, 0.4);
        }

        .leaderboard-row.top-3 {
            background: rgba(255, 215, 0, 0.12);
            border: 1px solid rgba(255, 215, 0, 0.4);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.2);
        }

        .leaderboard-rank {
            color: #00BFFF;
            font-weight: 900;
            min-width: 35px;
            text-align: center;
            font-size: 0.9rem;
        }

        .leaderboard-medal {
            font-size: 1.2rem;
            min-width: 25px;
            text-align: center;
        }

        .leaderboard-name {
            flex: 1;
            color: #fff;
            font-weight: 600;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-size: 0.95rem;
        }

        .leaderboard-score {
            color: #10B981;
            font-weight: 900;
            min-width: 40px;
            text-align: right;
            font-size: 0.95rem;
        }

        .leaderboard-grade {
            color: #FFD700;
            font-weight: 900;
            min-width: 25px;
            text-align: center;
            font-size: 0.95rem;
        }

        .leaderboard-date {
            color: #00A8E9;
            font-size: 0.75rem;
            min-width: 80px;
            text-align: right;
            opacity: 0.8;
        }

    /* ===== STYLES NEW3 LEADERBOARD (SCOPÉ) ===== */
#leaderboardPage * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        #leaderboardPage {
            background: linear-gradient(135deg, #0254A0 0%, #00A8E9 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Poppins', sans-serif;
            padding: 10px;
        }

    .gaussian-chart-container {
      background: rgba(0, 0, 0, 0.3);
      border: 2px solid #FF6B00;
      border-radius: 10px;
      padding: 15px;
      margin-top: 15px;
      box-shadow: 0 0 15px rgba(255, 107, 0, 0.3);
    }
    
    .gaussian-chart-title {
      color: #FFD700;
      font-weight: 900;
      text-align: center;
      margin-bottom: 10px;
      font-size: 0.95rem;
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.4);
    }
    
    #gaussianChart {
      max-height: 220px;
    }

    #leaderboardPage .leaderboard-container {
            background: rgba(0, 0, 0, 0.3);
            border: 3px solid #FFD700;
            border-radius: 15px;
            padding: 15px;
            max-width: 1200px;
            width: 100%;
            overflow: visible;
            display: flex;
            flex-direction: column;
        }

    #leaderboardPage .header-section {
            position: relative;
            width: 100%;
            margin-bottom: 12px;
        }

    #leaderboardPage .header-section h1 {
            text-align: center;
            font-size: 1.8rem;
            font-weight: 900;
            color: #FFD700;
            margin: 0;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
        }

    #leaderboardPage .play-again-btn {
            position: absolute;
            top: 0;
            right: 0;
            padding: 4px 8px;
            font-size: 0.6rem;
            background: linear-gradient(135deg, #0254A0, #00A8E9);
            border: 2px solid #FFD700;
            color: #FFD700;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 900;
        }

    #leaderboardPage .main-layout {
            display: grid;
            grid-template-columns: 40% 60%;
            gap: 12px;
        }

    #leaderboardPage .left-panel {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

    #leaderboardPage .well-done {
            color: #FFFFFF;
            font-size: 1.3rem;
            font-weight: 900;
            text-align: center;
            margin-bottom: 8px;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }

        /* TABLEAU 1: Rangs */
    #leaderboardPage .ranks-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 8px;
            border: 2px solid #FFD700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
        }

    #leaderboardPage .ranks-table tr {
            border-bottom: 1px solid rgba(0, 168, 233, 0.2);
            height: 24px;
        }

    #leaderboardPage .ranks-table tr:last-child {
            border-bottom: none;
        }

    #leaderboardPage .ranks-table td {
            padding: 1px 6px;
            vertical-align: middle;
        }

    #leaderboardPage .rank-letter-cell {
            width: 40px;
            text-align: center;
        }

    #leaderboardPage .rank-letter {
            font-size: 2rem;
            font-weight: 900;
            font-style: italic;
            line-height: 1;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s;
            cursor: pointer;
            opacity: 0.2;
            filter: brightness(0.4);
        }

    #leaderboardPage .rank-letter:hover {
            opacity: 1;
            filter: brightness(1.2);
        }

    #leaderboardPage .rank-letter.active-rank {
            opacity: 1 !important;
            filter: brightness(1.2) !important;
        }

    #leaderboardPage .rank-word-cell.active-rank {
            opacity: 1 !important;
            filter: brightness(1.2) !important;
        }

    #leaderboardPage .rank-letter.rank-s {
            color: #FF1493;
            filter: drop-shadow(0 0 2px #FF69B4) drop-shadow(0 0 1px #FF1493);
            animation: breathingOutline 3s ease-in-out infinite;
        }

    #leaderboardPage .rank-word-cell {
            font-size: 1rem;
            font-weight: 700;
            font-style: italic;
            transition: color 0.3s;
            opacity: 0.2;
            filter: brightness(0.4);
        }

    #leaderboardPage .rank-word-cell.rank-s-word {
            color: #FF1493;
            filter: drop-shadow(0 0 1px #FF69B4);
            opacity: 1 !important;
        }

    #leaderboardPage .rank-word-cell.rank-a-word {
            color: #00A8E9;
            opacity: 1 !important;
            filter: brightness(1) !important;
        }

    #leaderboardPage .rank-word-cell.rank-b-word {
            color: #10B981;
            opacity: 1 !important;
            filter: brightness(1) !important;
        }

    #leaderboardPage .rank-word-cell.rank-c-word {
            color: #ADFF2F;
            opacity: 1 !important;
            filter: brightness(1) !important;
        }

    #leaderboardPage .rank-word-cell.rank-d-word {
            color: #FFD700;
            opacity: 1 !important;
            filter: brightness(1) !important;
        }

    #leaderboardPage .rank-word-cell.rank-e-word {
            color: #E8E8E8;
            opacity: 1 !important;
            filter: brightness(1) !important;
        }
        }

        /* Hover sur les rangs */
    #leaderboardPage .ranks-table tr:hover .rank-letter:not(.rank-s) {
            opacity: 1;
            filter: brightness(1.3);
        }

    #leaderboardPage .ranks-table:has(tr:hover) tr:not(:hover) .rank-letter:not(.rank-s) {
            opacity: 0.3;
            filter: brightness(0.5);
        }

    #leaderboardPage .ranks-table:has(tr:hover) tr:not(:hover) .rank-word-cell {
            opacity: 0.3;
            filter: brightness(0.5);
        }

        .rank-letter:hover ~ .rank-word-cell,
    #leaderboardPage .ranks-table tr:hover .rank-word-cell {
            color: inherit !important;
        }

    #leaderboardPage .rank-letter.rank-e {
            color: #E8E8E8;
            text-shadow: 3px 3px 0px rgba(255, 255, 255, 0.2), 2px 2px 0px rgba(0, 0, 0, 0.5);
        }

    #leaderboardPage .rank-letter.rank-d {
            color: #FFD700;
            filter: drop-shadow(0 0 2px #FFD700) drop-shadow(0 0 1px #FFD700);
        }

    #leaderboardPage .rank-letter.rank-c {
            color: #ADFF2F;
            filter: drop-shadow(0 0 2px #7FFF00) drop-shadow(0 0 1px #ADFF2F);
        }

    #leaderboardPage .rank-letter.rank-b {
            color: #00FF00;
            filter: drop-shadow(0 0 2px #00FF7F) drop-shadow(0 0 1px #00FF00);
        }

    #leaderboardPage .rank-letter.rank-a {
            color: #00BFFF;
            filter: drop-shadow(0 0 2px #1E90FF) drop-shadow(0 0 1px #00BFFF);
        }

    #leaderboardPage .rank-letter.rank-s {
            color: #FF1493;
            filter: drop-shadow(0 0 2px #FF69B4) drop-shadow(0 0 1px #FF1493);
            animation: breathingOutline 3s ease-in-out infinite;
        }

        @keyframes breathingOutline {
    #leaderboardPage 0%, 100% {
                text-shadow: 0 0 2px rgba(255, 255, 255, 0.2), 
                            1px 1px 0px rgba(255, 255, 255, 0.3);
            }
    #leaderboardPage 50% {
                text-shadow: -3px -3px 0px rgba(255, 255, 255, 0.8),
                            -2px -2px 0px rgba(255, 255, 255, 0.8),
                            -1px -1px 0px rgba(255, 255, 255, 0.8),
                            3px 3px 0px rgba(255, 255, 255, 0.8),
                            2px 2px 0px rgba(255, 255, 255, 0.8),
                            1px 1px 0px rgba(255, 255, 255, 0.8),
                            -3px 0px 0px rgba(255, 255, 255, 0.8),
                            3px 0px 0px rgba(255, 255, 255, 0.8),
                            0px -3px 0px rgba(255, 255, 255, 0.8),
                            0px 3px 0px rgba(255, 255, 255, 0.8);
            }
        }

        /* Score et Results combinés dans rangs */
    #leaderboardPage .ranks-results-container {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 8px;
            width: 100%;
        }

    #leaderboardPage .ranks-score-box {
            background: rgba(0, 0, 0, 0.2);
            border: 2px solid rgba(255, 215, 0, 0.2);
            border-radius: 8px;
            padding: 8px;
            text-align: center;
            animation: tableBreathing 3s ease-in-out infinite;
        }

        @keyframes tableBreathing {
    #leaderboardPage 0%, 100% {
                border-color: rgba(255, 215, 0, 0.2);
                box-shadow: 0 0 8px rgba(255, 215, 0, 0.1);
            }
    #leaderboardPage 50% {
                border-color: rgba(255, 215, 0, 0.6);
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
            }
        }

    #leaderboardPage .player-name-score {
            color: #FFD700;
            font-size: 1.1rem;
            font-weight: 900;
            margin-bottom: 4px;
            text-shadow: 0 0 8px rgba(255, 215, 0, 0.5);
            display: block;
        }

    #leaderboardPage .score-emoji {
            font-size: 1.8rem;
            margin-bottom: 4px;
            display: block;
        }

    #leaderboardPage .score-label {
            background: linear-gradient(90deg, #FF0000, #FF6600, #FFFF00, #00FF00, #00FFFF);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 900;
            font-size: 0.9rem;
            margin-bottom: 2px;
            font-style: italic;
            display: block;
        }

    #leaderboardPage .score-value {
            background: linear-gradient(90deg, #FF0000, #FF6600, #FFFF00, #00FF00, #00FFFF, #FF00FF);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 900;
            font-size: 1.6rem;
            margin-bottom: 2px;
            font-style: italic;
            display: block;
        }

    #leaderboardPage .score-ratio {
            color: #FFD700;
            font-weight: 700;
            font-size: 0.8rem;
            display: block;
        }

    #leaderboardPage .ranks-results-box {
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid #FFD700;
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
        }

    #leaderboardPage .results-title {
            color: #FFD700;
            font-weight: 900;
            text-transform: uppercase;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
            font-size: 0.75rem;
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
        }

    #leaderboardPage .results-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
        }

    #leaderboardPage .result-group {
            display: flex;
            gap: 2px;
            padding: 3px 6px;
            background: rgba(0, 168, 233, 0.15);
            border-radius: 4px;
            border: 1px solid rgba(0, 168, 233, 0.3);
            flex: 0 0 calc(33.333% - 6px);
            justify-content: center;
            box-shadow: 0 0 5px rgba(0, 168, 233, 0.2);
        }

    #leaderboardPage .result-emoji {
            width: 14px;
            height: 14px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

    #leaderboardPage .result-emoji.success {
            color: #10B981;
            text-shadow: 0 0 3px rgba(16, 185, 129, 0.8);
        }

    #leaderboardPage .result-emoji.error {
            color: #EF4444;
            text-shadow: 0 0 3px rgba(239, 68, 68, 0.8);
        }

        /* LEADERBOARD DROIT */
    #leaderboardPage .right-panel {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #00A8E9;
            border-radius: 8px;
            padding: 10px;
            overflow-y: auto;
            max-height: calc(100vh - 350px);
            flex: 1;
        }

    .right-panel::-webkit-scrollbar {
            width: 6px;
        }

    .right-panel::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
        }

    .right-panel::-webkit-scrollbar-thumb {
            background: #00A8E9;
            border-radius: 3px;
        }

    #leaderboardPage .leaderboard-row {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: rgba(0, 168, 233, 0.1);
            border: 1px solid rgba(0, 168, 233, 0.3);
            border-radius: 6px;
            margin-bottom: 4px;
            transition: all 0.2s;
            font-size: 0.95rem;
        }

    #leaderboardPage .leaderboard-row:hover {
            background: rgba(0, 168, 233, 0.4);
            border-color: #FFD700;
            transform: translateX(4px);
            box-shadow: 0 0 15px rgba(0, 168, 233, 0.6), inset 0 0 10px rgba(0, 168, 233, 0.3);
        }

    #leaderboardPage .right-panel:has(> .leaderboard-row:hover) .leaderboard-row:not(:hover) {
            opacity: 0.5;
            filter: brightness(0.7);
        }

    #leaderboardPage .leaderboard-row.top-3 {
            background: rgba(255, 215, 0, 0.15);
            border-color: #FFD700;
        }

    #leaderboardPage .leaderboard-row.top-3:hover {
            background: rgba(255, 215, 0, 0.3);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.6), inset 0 0 10px rgba(255, 215, 0, 0.3);
        }

    #leaderboardPage .leaderboard-rank {
            color: #FFD700;
            font-weight: 900;
            min-width: 25px;
            text-align: center;
            font-size: 0.9rem;
        }

    #leaderboardPage .leaderboard-medal {
            font-size: 1.2rem;
            min-width: 20px;
            text-align: center;
        }

    #leaderboardPage .leaderboard-name {
            flex: 1;
            color: #fff;
            font-weight: 600;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-size: 0.95rem;
        }

    #leaderboardPage .leaderboard-score {
            color: #10B981;
            font-weight: 900;
            min-width: 35px;
            text-align: right;
            font-size: 0.95rem;
        }

    #leaderboardPage .leaderboard-grade {
            color: #FFD700;
            font-weight: 900;
            min-width: 20px;
            text-align: center;
            font-size: 0.95rem;
        }

    #leaderboardPage .leaderboard-date {
            color: #00A8E9;
            font-size: 0.75rem;
            min-width: 75px;
            text-align: right;
            opacity: 0.8;
        }
  </style>
</head>
  <!-- RULES OVERLAY -->
  <div class="rulesOverlay hidden" id="rulesOverlay">
    <div class="rulesContainer">
      <div class="rulesTitle">Quality Inspector Simulator</div>

      <div class="rulesSection">
        <div class="rulesSectionTitle">🎯 YOUR MISSION</div>
        <div class="rulesContent">
          <ul>
            <li>🔍 Scan components with magnifier</li>
            
            <li>✅ ACCEPT if no defects</li>
            <li>❌ REJECT if defects found</li>
            <li>⏱️ 2 minutes total time</li>
          </ul>
        </div>
      </div>

      <div class="rulesSection">
        <div class="rulesSectionTitle">🏆 SCORING RULES</div>
        <div class="rulesContent">
          <div class="rulesStat">✅ Correct Answer: <strong>+10 Points</strong></div>
          <div class="rulesStat">❌ Wrong Answer: <strong>-20 Points</strong></div>
          <div class="rulesStat">🔥 Combo (5 Correct): <strong>+5, +10, +15, +20...</strong></div>
          <div class="rulesStat">💎 Grades: <strong>S / A / B / C / D / E</strong></div>
        </div>
      </div>

      <div class="rulesSection">
        <div class="rulesSectionTitle">📊 RANK TABLE</div>
        <div class="rankTable">
          <div class="rankRow rank-s" style="display: flex; align-items: center; gap: 12px; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
            <span class="rankLetter" style="min-width: 20px;">👑</span>
            <strong style="min-width: 15px;">S</strong>
            <span style="min-width: 85px; text-align: center; color: #00D4FF;">2250-2700</span>
            <span style="color: #FF1493; font-weight: 900; flex-grow: 1; text-align: right;">STYLISH!</span>
          </div>
          <div class="rankRow rank-a" style="display: flex; align-items: center; gap: 12px; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
            <span class="rankLetter" style="min-width: 20px;">⭐</span>
            <strong style="min-width: 15px;">A</strong>
            <span style="min-width: 85px; text-align: center; color: #00D4FF;">1800-2249</span>
            <span style="color: #00A8E9; font-weight: 900; flex-grow: 1; text-align: right;">ABSOLUTE!</span>
          </div>
          <div class="rankRow rank-b" style="display: flex; align-items: center; gap: 12px; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
            <span class="rankLetter" style="min-width: 20px;">🎯</span>
            <strong style="min-width: 15px;">B</strong>
            <span style="min-width: 85px; text-align: center; color: #00D4FF;">1350-1799</span>
            <span style="color: #10B981; font-weight: 900; flex-grow: 1; text-align: right;">BRAVO!</span>
          </div>
          <div class="rankRow rank-c" style="display: flex; align-items: center; gap: 12px; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
            <span class="rankLetter" style="min-width: 20px;">💪</span>
            <strong style="min-width: 15px;">C</strong>
            <span style="min-width: 85px; text-align: center; color: #00D4FF;">900-1349</span>
            <span style="color: #ADFF2F; font-weight: 900; flex-grow: 1; text-align: right;">COOL!</span>
          </div>
          <div class="rankRow rank-d" style="display: flex; align-items: center; gap: 12px; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
            <span class="rankLetter" style="min-width: 20px;">👌</span>
            <strong style="min-width: 15px;">D</strong>
            <span style="min-width: 85px; text-align: center; color: #00D4FF;">450-899</span>
            <span style="color: #FFD700; font-weight: 900; flex-grow: 1; text-align: right;">DULL!</span>
          </div>
          <div class="rankRow rank-e" style="display: flex; align-items: center; gap: 12px; padding: 10px 0;">
            <span class="rankLetter" style="min-width: 20px;">🤔</span>
            <strong style="min-width: 15px;">E</strong>
            <span style="min-width: 85px; text-align: center; color: #00D4FF;">0-449</span>
            <span style="color: #E8E8E8; font-weight: 900; flex-grow: 1; text-align: right;">EMPTY!</span>
          </div>
        </div>
      </div>

      <button class="startButton" onclick="startGame()">▶ START INSPECTING ▶</button>
    </div>
  </div>

  <!-- FEEDBACK MESSAGE -->
  <div class="feedbackMessage" id="feedbackMessage"></div>

  <!-- HEADER -->
  <div class="header">
    <div style="display: flex; align-items: center; gap: 15px;">
      <img src="./img/COU.png" alt="COU Logo" style="height: 35px; filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.3));">
      <div class="headerTitle">EDF POWER SOLUTIONS</div>
    </div>
    <div class="headerRight">⚡ QUALITY INSPECTOR SIMULATOR - Quality Week 2025</div>
  </div>

  <!-- GAME STATUS BAR -->
  <div class="gameStatusBar">
    <div class="timerDisplay" id="timerDisplay">2:00</div>
    <svg class="windmill" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
      <circle cx="50" cy="50" r="45" fill="none" stroke="#FFD700" stroke-width="2"/>
      <circle cx="50" cy="50" r="8" fill="#FFD700"/>
      <ellipse cx="50" cy="25" rx="8" ry="18" fill="#FF5716" opacity="0.8"/>
      <ellipse cx="50" cy="25" rx="8" ry="18" fill="#FF8C00" opacity="0.8" transform="rotate(120 50 50)"/>
      <ellipse cx="50" cy="25" rx="8" ry="18" fill="#FFA500" opacity="0.8" transform="rotate(240 50 50)"/>
    </svg>
    <div class="windWave">💨</div>
    <div class="timerBarContainer">
      <div class="timerFill" id="timerFill" style="width: 100%;"></div>
    </div>
  </div>

  <!-- GAME ZONE -->
  <div class="gameZone" id="gameZone">
    
    <!-- INSPECTION ZONE (TABLEAU 2 COLONNES) -->
    <div class="inspectionZone">
      <!-- Ligne 1 -->
      <div class="inspectionHeader">
        <div class="inspectionTitle">🔍 INSPECTION</div>
      </div>
      <button class="giveUpBtn" onclick="window.quitGame()">🚪 I GIVE UP!</button>

      <!-- Ligne 2 -->
      <div class="statusBox">
        <div class="statusMessage" id="productStatus">Inspect the equipment...</div>
      </div>
      <!-- Colonne 2 Row 2 vide -->

      <!-- Ligne 3-4: Drawing Zone + Buttons -->
      <div class="drawingZone">
        <canvas id="productCanvas" width="400" height="300"></canvas>
      </div>

      <div class="buttonColumn">
        <button class="btn btnAccept" onclick="window.makeDecision('accept')">✅ ACCEPT</button>
        <button class="btn btnReject" onclick="window.makeDecision('reject')">❌ REJECT</button>
      </div>
    </div>

    <!-- LOUPE INTERACTIVE -->
    <div class="magnifyingGlass" id="magnifyingGlass"></div>
    <div class="magnifyingGlassHandle" id="magnifyingGlassHandle"></div>
    <div class="searchZone" id="searchZone"></div>

    <!-- KPI ZONE -->
    <div class="kpiZone" id="kpiZone">
      <div class="kpiZoneTitle">📊 KPI Zone</div>

      <!-- Quality KPI -->
      <div class="kpiSection">
        <div class="kpiSectionTitle">Quality KPI</div>
        
        <div class="kpiBlock">
          <div class="kpiLabel">Inspected</div>
          <div class="kpiValue" id="kpiInspected">0</div>
        </div>

        <div class="kpiBlock" style="padding: 8px 3px; margin-bottom: 4px; border-radius: 8px;">
          <div class="kpiLabel" style="font-size: 0.58rem; margin-bottom: 2px;">Quality / Status</div>
          <div class="kpiValue" style="font-size: 1.3rem; letter-spacing: 2px;">
            <span id="kpiQuality">0%</span> <span id="kpiStatus" style="font-size: 1.2rem;">😐</span>
          </div>
        </div>

        <div class="kpiBlockDecisions">
          <div class="kpiLabel">Decisions</div>
          <div class="kpiDecisionsRow">
            <div class="kpiDecisionItem">
              <div class="kpiDecisionLabel">Good</div>
              <div class="kpiValue" id="kpiGood">0</div>
            </div>
            <div class="kpiDecisionItem">
              <div class="kpiDecisionLabel">Wrong</div>
              <div class="kpiValue" id="kpiWrong">0</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Performance KPI -->
      <div class="kpiSection">
        <div class="kpiSectionTitle">Performance KPI</div>

        <div class="kpiBlock">
          <div class="kpiLabel">Time Elapsed</div>
          <div class="kpiValue" id="kpiTimer">2:00</div>
        </div>

        <div class="kpiBlock">
          <div class="kpiLabel">Combo</div>
          <div class="kpiValue" id="kpiCombo">0</div>
        </div>

        <div class="kpiBlock">
          <div class="kpiLabel">Avg Time</div>
          <div class="kpiValue" id="kpiAvgTime">0s</div>
        </div>
      </div>
    </div>

  </div>

  <script>
    let gameActive = false;
    let gameStartTime = 0;
    let correctCombo = 0;
    let currentProduct = null;
    let currentProductIndex = 0;
    let currentDefects = [];
    let foundDefects = [];
    let productStartTime = 0;
    let allProducts = [];
    
    let gameStats = {
        responseTimes: [],
        responseTimesCorrect: [],
        
      inspected: 0,
      good: 0,
      wrong: 0,
      maxCombo: 0,
      totalTime: 0
    };

    function showStamp(isAccept) {
      const canvas = document.getElementById('productCanvas');
      const rect = canvas.getBoundingClientRect();
      
      const stamp = document.createElement('div');
      stamp.className = `stamp ${isAccept ? 'accept' : 'reject'}`;
      stamp.textContent = isAccept ? '✓' : '✕';
      stamp.style.left = (rect.left + rect.width / 2) + 'px';
      stamp.style.top = (rect.top + rect.height / 2) + 'px';
      document.body.appendChild(stamp);
      
      setTimeout(() => {
        stamp.remove();
      }, 600);
    }

    function showFeedback(msg, isCorrect) {
      const status = document.getElementById('productStatus');
      const productNum = currentProductIndex + 1;
      
      if (isCorrect) {
        status.textContent = `✅ CORRECT!`;
        status.style.color = '#10B981';
      } else {
        status.textContent = `❌ WRONG!`;
        status.style.color = '#EF4444';
      }
      
      setTimeout(() => {
        status.textContent = `Scanning Product ${productNum + 1} : ...`;
        status.style.color = '#00A8E9';
      }, 800);
    }

    function updateKPI() {
      document.getElementById('kpiInspected').textContent = gameStats.inspected;
      document.getElementById('kpiGood').textContent = gameStats.good;
      document.getElementById('kpiWrong').textContent = gameStats.wrong;
      
      const quality = gameStats.inspected > 0 ? Math.round((gameStats.good / gameStats.inspected) * 100) : 0;
      const qualityEl = document.getElementById('kpiQuality');
      qualityEl.textContent = quality + '%';
      
      // Quality: Vert vers Doré
      if (quality >= 80) {
        qualityEl.style.color = '#FFD700';
        qualityEl.style.textShadow = '0 0 10px rgba(255, 215, 0, 0.6)';
      } else if (quality >= 60) {
        qualityEl.style.color = '#7BC92E';
        qualityEl.style.textShadow = '0 0 8px rgba(123, 201, 46, 0.5)';
      } else if (quality >= 40) {
        qualityEl.style.color = '#FFA500';
        qualityEl.style.textShadow = '0 0 8px rgba(255, 165, 0, 0.5)';
      } else {
        qualityEl.style.color = '#EF4444';
        qualityEl.style.textShadow = '0 0 8px rgba(239, 68, 68, 0.5)';
      }

      document.getElementById('kpiCombo').textContent = gameStats.maxCombo;
      
      // Combo: change couleur selon valeur
      const comboEl = document.getElementById('kpiCombo');
      if (gameStats.maxCombo >= 10) {
        comboEl.style.color = '#8B0000';
        comboEl.style.textShadow = '0 0 10px rgba(139, 0, 0, 0.8)';
      } else if (gameStats.maxCombo >= 7) {
        comboEl.style.color = '#DC2626';
        comboEl.style.textShadow = '0 0 8px rgba(220, 38, 38, 0.6)';
      } else if (gameStats.maxCombo >= 4) {
        comboEl.style.color = '#FF5716';
        comboEl.style.textShadow = '0 0 8px rgba(255, 87, 22, 0.5)';
      } else {
        comboEl.style.color = '#10B981';
        comboEl.style.textShadow = '0 0 8px rgba(16, 185, 129, 0.5)';
      }
      
      const avgTime = gameStats.inspected > 0 ? Math.round(gameStats.totalTime / gameStats.inspected) : 0;
      const timeEl = document.getElementById('kpiAvgTime');
      timeEl.textContent = avgTime + 's';
      
      // Average Time: Vert -> Orange -> Rouge -> Noir avec fond adapté
      if (avgTime <= 5) {
        timeEl.style.color = '#10B981';
        timeEl.style.textShadow = '0 0 8px rgba(16, 185, 129, 0.5)';
        timeEl.style.background = 'rgba(16, 185, 129, 0.15)';
        timeEl.style.borderColor = 'rgba(16, 185, 129, 0.4)';
      } else if (avgTime <= 7) {
        timeEl.style.color = '#7BC92E';
        timeEl.style.textShadow = '0 0 8px rgba(123, 201, 46, 0.5)';
        timeEl.style.background = 'rgba(123, 201, 46, 0.15)';
        timeEl.style.borderColor = 'rgba(123, 201, 46, 0.4)';
      } else if (avgTime <= 10) {
        timeEl.style.color = '#FFA500';
        timeEl.style.textShadow = '0 0 8px rgba(255, 165, 0, 0.5)';
        timeEl.style.background = 'rgba(255, 165, 0, 0.15)';
        timeEl.style.borderColor = 'rgba(255, 165, 0, 0.4)';
      } else if (avgTime <= 15) {
        timeEl.style.color = '#FF5716';
        timeEl.style.textShadow = '0 0 8px rgba(255, 87, 22, 0.5)';
        timeEl.style.background = 'rgba(255, 87, 22, 0.15)';
        timeEl.style.borderColor = 'rgba(255, 87, 22, 0.4)';
      } else {
        timeEl.style.color = '#333';
        timeEl.style.textShadow = '0 0 8px rgba(51, 51, 51, 0.5)';
        timeEl.style.background = 'rgba(51, 51, 51, 0.15)';
        timeEl.style.borderColor = 'rgba(51, 51, 51, 0.4)';
      }

      const quality_pct = gameStats.inspected > 0 ? Math.round((gameStats.good / gameStats.inspected) * 100) : 0;
      if (quality_pct >= 90) document.getElementById('kpiStatus').textContent = '😍';
      else if (quality_pct >= 75) document.getElementById('kpiStatus').textContent = '😊';
      else if (quality_pct >= 50) document.getElementById('kpiStatus').textContent = '😐';
      else if (quality_pct >= 25) document.getElementById('kpiStatus').textContent = '😕';
      else document.getElementById('kpiStatus').textContent = '😡';
    }

    function updateProductStatus() {
      const status = document.getElementById('productStatus');
      if (!status) return;
      
      const inspectedPercent = gameStats.inspected > 0 ? Math.round((gameStats.inspected / allProducts.length) * 100) : 0;
      const productNum = currentProductIndex + 1;
      
      // Message neutre - ne pas révéler s'il y a des défauts
      status.textContent = `Scanning Product ${productNum}`;
      status.style.color = '#00A8E9';
    }

    let revealedDefects = [];

    function drawProduct() {
      const canvas = document.getElementById('productCanvas');
      if (!canvas) return;
      
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = '#003d66';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // Dessiner en fonction du type de produit
      if (!currentProduct) return;
      
      const productType = currentProduct.type || 'blade';
      
      ctx.save();
      ctx.translate(canvas.width / 2, canvas.height / 2);
      
      if (productType === 'blade') {
        drawBlade(ctx);
      } else if (productType === 'gearbox') {
        drawGearbox(ctx);
      } else if (productType === 'generator') {
        drawGenerator(ctx);
      } else if (productType === 'tower') {
        drawTower(ctx);
      } else if (productType === 'foundation') {
        drawFoundation(ctx);
      } else if (productType === 'nacelle') {
        drawNacelle(ctx);
      } else if (productType === 'bearing') {
        drawBearing(ctx);
      } else if (productType === 'cable') {
        drawCable(ctx);
      }
      
      ctx.restore();
      
      // Dessiner les défauts EN TRANSPARENT (cachés) ou RÉVÉLÉS
      if (currentDefects && currentDefects.length > 0) {
        currentDefects.forEach((defect, i) => {
          const pos = defect.pos;
          if (pos) {
            ctx.save();
            ctx.translate(canvas.width / 2, canvas.height / 2);
            
            if (revealedDefects.includes(i)) {
              // DÉFAUT RÉVÉLÉ - rouge bright avec glow
              ctx.fillStyle = '#FF5716';
              ctx.shadowColor = 'rgba(255, 87, 22, 0.9)';
              ctx.shadowBlur = 15;
            } else {
              // DÉFAUT CACHÉ - très transparent
              ctx.fillStyle = 'rgba(255, 87, 22, 0.1)';
              ctx.shadowColor = 'rgba(255, 87, 22, 0.1)';
              ctx.shadowBlur = 3;
            }
            ctx.beginPath();
            ctx.arc(pos.x, pos.y, 7, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.restore();
          }
        });
      }
    }

    function drawBlade(ctx) {
      // Pale d'éolienne - PLUS GRANDE
      ctx.fillStyle = 'rgba(100, 200, 255, 0.3)';
      ctx.beginPath();
      ctx.ellipse(0, 0, 70, 140, 0, 0, Math.PI * 2);
      ctx.fill();
      
      ctx.strokeStyle = '#00A8E9';
      ctx.lineWidth = 3;
      ctx.stroke();
      
      ctx.fillStyle = '#00A8E9';
      ctx.font = 'bold 16px Poppins';
      ctx.textAlign = 'center';
      ctx.fillText('BLADE', 0, 5);
    }

    function drawGearbox(ctx) {
      // Boîte de vitesse - PLUS GRANDE
      ctx.fillStyle = 'rgba(150, 150, 150, 0.4)';
      ctx.beginPath();
      ctx.rect(-60, -50, 120, 100);
      ctx.fill();
      
      ctx.strokeStyle = '#888';
      ctx.lineWidth = 3;
      ctx.stroke();
      
      // Engrenages
      for (let i = 0; i < 3; i++) {
        ctx.fillStyle = 'rgba(200, 150, 0, 0.3)';
        ctx.beginPath();
        ctx.arc(-30 + i * 30, 0, 18, 0, Math.PI * 2);
        ctx.fill();
        ctx.stroke();
      }
      
      ctx.fillStyle = '#AAA';
      ctx.font = 'bold 14px Poppins';
      ctx.textAlign = 'center';
      ctx.fillText('GEARBOX', 0, 5);
    }

    function drawGenerator(ctx) {
      // Générateur - PLUS GRAND
      ctx.fillStyle = 'rgba(200, 100, 50, 0.3)';
      ctx.beginPath();
      ctx.ellipse(0, 0, 70, 45, 0, 0, Math.PI * 2);
      ctx.fill();
      
      ctx.strokeStyle = '#CC6633';
      ctx.lineWidth = 3;
      ctx.stroke();
      
      // Bobines
      ctx.strokeStyle = 'rgba(200, 100, 50, 0.6)';
      for (let i = -3; i <= 3; i++) {
        ctx.beginPath();
        ctx.arc(i * 20, 0, 12, 0, Math.PI * 2);
        ctx.stroke();
      }
      
      ctx.fillStyle = '#CC6633';
      ctx.font = 'bold 14px Poppins';
      ctx.textAlign = 'center';
      ctx.fillText('GENERATOR', 0, 5);
    }

    function drawTower(ctx) {
      // Tour - PLUS GRANDE
      ctx.fillStyle = 'rgba(100, 100, 150, 0.3)';
      ctx.beginPath();
      ctx.moveTo(0, -110);
      ctx.lineTo(60, 110);
      ctx.lineTo(-60, 110);
      ctx.closePath();
      ctx.fill();
      
      ctx.strokeStyle = '#6666AA';
      ctx.lineWidth = 3;
      ctx.stroke();
      
      // Boulons
      ctx.fillStyle = 'rgba(150, 150, 150, 0.5)';
      for (let i = -2; i <= 2; i++) {
        ctx.beginPath();
        ctx.arc(i * 20, 0, 4, 0, Math.PI * 2);
        ctx.fill();
      }
      
      ctx.fillStyle = '#6666AA';
      ctx.font = 'bold 14px Poppins';
      ctx.textAlign = 'center';
      ctx.fillText('TOWER', 0, 5);
    }

    function drawFoundation(ctx) {
      // Fondation - PLUS GRANDE
      ctx.fillStyle = 'rgba(150, 100, 50, 0.3)';
      ctx.beginPath();
      ctx.rect(-85, -55, 170, 110);
      ctx.fill();
      
      ctx.strokeStyle = '#996633';
      ctx.lineWidth = 3;
      ctx.stroke();
      
      // Pieux
      for (let i = -1; i <= 1; i++) {
        ctx.fillStyle = 'rgba(100, 50, 0, 0.4)';
        ctx.beginPath();
        ctx.rect(i * 35 - 10, 40, 20, 50);
        ctx.fill();
        ctx.stroke();
      }
      
      ctx.fillStyle = '#996633';
      ctx.font = 'bold 14px Poppins';
      ctx.textAlign = 'center';
      ctx.fillText('FOUNDATION', 0, 5);
    }

    function drawNacelle(ctx) {
      // Nacelle - PLUS GRANDE
      ctx.fillStyle = 'rgba(200, 200, 200, 0.3)';
      ctx.beginPath();
      ctx.ellipse(0, 0, 70, 50, 0.2, 0, Math.PI * 2);
      ctx.fill();
      
      ctx.strokeStyle = '#CCCCCC';
      ctx.lineWidth = 3;
      ctx.stroke();
      
      // Fenêtres
      ctx.fillStyle = 'rgba(100, 150, 200, 0.5)';
      ctx.beginPath();
      ctx.rect(-40, -18, 20, 15);
      ctx.fill();
      ctx.beginPath();
      ctx.rect(-10, -18, 20, 15);
      ctx.fill();
      
      ctx.fillStyle = '#CCCCCC';
      ctx.font = 'bold 14px Poppins';
      ctx.textAlign = 'center';
      ctx.fillText('NACELLE', 0, 5);
    }

    function drawBearing(ctx) {
      // Roulement - PLUS GRAND
      ctx.fillStyle = 'rgba(100, 100, 100, 0.3)';
      ctx.beginPath();
      ctx.arc(0, 0, 65, 0, Math.PI * 2);
      ctx.fill();
      
      ctx.strokeStyle = '#666';
      ctx.lineWidth = 3;
      ctx.stroke();
      
      // Billes
      for (let i = 0; i < 8; i++) {
        const angle = (i / 8) * Math.PI * 2;
        const x = Math.cos(angle) * 40;
        const y = Math.sin(angle) * 40;
        ctx.fillStyle = 'rgba(150, 150, 150, 0.5)';
        ctx.beginPath();
        ctx.arc(x, y, 8, 0, Math.PI * 2);
        ctx.fill();
      }
      
      ctx.fillStyle = '#666';
      ctx.font = 'bold 14px Poppins';
      ctx.textAlign = 'center';
      ctx.fillText('BEARING', 0, 5);
    }

    function drawCable(ctx) {
      // Câble - PLUS GROS
      ctx.strokeStyle = 'rgba(200, 150, 50, 0.5)';
      ctx.lineWidth = 10;
      ctx.beginPath();
      ctx.moveTo(-60, -80);
      ctx.quadraticCurveTo(0, 30, 60, 80);
      ctx.stroke();
      
      // Torsade
      ctx.strokeStyle = 'rgba(100, 75, 25, 0.6)';
      ctx.lineWidth = 5;
      for (let i = 0; i < 6; i++) {
        const t = i / 6;
        const x = -60 + t * 120;
        const y = -80 + t * 160;
        ctx.beginPath();
        ctx.arc(x, y, 4, 0, Math.PI * 2);
        ctx.stroke();
      }
      
      ctx.fillStyle = 'rgba(200, 150, 50, 0.8)';
      ctx.font = 'bold 14px Poppins';
      ctx.textAlign = 'center';
      ctx.fillText('CABLE', 0, 5);
    }

    function loadNextProduct() {
      if (currentProductIndex >= allProducts.length || !gameActive) {
        endGame();
        return;
      }
      
      currentProduct = allProducts[currentProductIndex];
      currentDefects = currentProduct.defects || [];
      revealedDefects = [];
      productStartTime = Date.now();
      
      drawProduct();
      updateProductStatus();
    }

    window.makeDecision = function(decision) {
      if (!gameActive || !currentProduct) return;
      
      // Vérifier que les défauts révélés sont valides
      const validDefects = revealedDefects.filter(i => isDefectInObject(currentDefects[i].pos));
      
      // ✅ FIX: Le produit a des défauts s'il y en a SUR LE PRODUIT, pas juste ceux trouvés!
      const hasDefects = currentDefects.length > 0;
      const isCorrect = (decision === 'accept' && !hasDefects) || (decision === 'reject' && hasDefects);

      const productTime = (Date.now() - productStartTime) / 1000;
      gameStats.responseTimes.push(productTime);
      if (isCorrect) gameStats.responseTimesCorrect.push(productTime);
      gameStats.totalTime += productTime;
      gameStats.inspected++;

      if (isCorrect) {
        correctCombo++;
        if (correctCombo > gameStats.maxCombo) gameStats.maxCombo = correctCombo;
        gameStats.good++;
      } else {
        correctCombo = 0;
        gameStats.wrong++;
      }

      showStamp(isCorrect);
      showFeedback(isCorrect ? '✅ CORRECT!' : '❌ WRONG!', isCorrect);
      updateKPI();
      currentProductIndex++;
      setTimeout(() => loadNextProduct(), 800);
    };

    function isDefectInObject(defectPos) {
      if (!defectPos) return false;
      
      // Vérifier si le défaut est dans une zone raisonnable (pas trop loin du centre)
      const dist = Math.hypot(defectPos.x, defectPos.y);
      return dist < 100; // Les défauts sont générés dans une zone de 80px, on accepte 100
    }

    window.quitGame = function() {
      gameActive = false;
      const quality = gameStats.inspected > 0 ? Math.round((gameStats.good / gameStats.inspected) * 100) : 0;
      saveGameScoreAndShowLeaderboard(gameStats.good, gameStats.inspected, quality);
    };

    function startTimer() {
      const timerInterval = setInterval(() => {
        if (!gameActive) {
          clearInterval(timerInterval);
          return;
        }

        const elapsed = Date.now() - gameStartTime;
        const remaining = Math.max(0, 120 - Math.floor(elapsed / 1000));
        
        const mins = Math.floor(remaining / 60);
        const secs = remaining % 60;
        document.getElementById('timerDisplay').textContent = String(mins).padStart(2, '0') + ':' + String(secs).padStart(2, '0');
        
        // Update Time Elapsed in KPI avec décimales
        const elapsedSecs = elapsed / 1000;
        const elapsedMins = Math.floor(elapsedSecs / 60);
        const displaySecs = (elapsedSecs % 60).toFixed(1);
        document.getElementById('kpiTimer').textContent = String(elapsedMins).padStart(2, '0') + ':' + String(parseFloat(displaySecs)).padStart(4, '0');
        
        // Update Avg Time en live avec décimales
        if (gameStats.inspected > 0) {
          const totalProductTime = gameStats.totalTime + ((Date.now() - productStartTime) / 1000);
          const avgTime = (totalProductTime / gameStats.inspected).toFixed(1);
          const timeEl = document.getElementById('kpiAvgTime');
          timeEl.textContent = avgTime + 's';
          
          // Average Time: Vert -> Orange -> Rouge -> Noir
          const avgNum = parseFloat(avgTime);
          if (avgNum <= 5) {
            timeEl.style.color = '#10B981';
            timeEl.style.textShadow = '0 0 8px rgba(16, 185, 129, 0.5)';
          } else if (avgNum <= 7) {
            timeEl.style.color = '#7BC92E';
            timeEl.style.textShadow = '0 0 8px rgba(123, 201, 46, 0.5)';
          } else if (avgNum <= 10) {
            timeEl.style.color = '#FFA500';
            timeEl.style.textShadow = '0 0 8px rgba(255, 165, 0, 0.5)';
          } else if (avgNum <= 15) {
            timeEl.style.color = '#FF5716';
            timeEl.style.textShadow = '0 0 8px rgba(255, 87, 22, 0.5)';
          } else {
            timeEl.style.color = '#333';
            timeEl.style.textShadow = '0 0 8px rgba(51, 51, 51, 0.5)';
          }
        }
        
        const fillPercent = (remaining / 120) * 100;
        document.getElementById('timerFill').style.width = fillPercent + '%';

        if (remaining <= 0) {
          gameActive = false;
          clearInterval(timerInterval);
          endGame();
        }
      }, 100);
    }

    function endGame() {
      gameActive = false;
      const quality = gameStats.inspected > 0 ? Math.round((gameStats.good / gameStats.inspected) * 100) : 0;
      saveGameScoreAndShowLeaderboard(gameStats.good, gameStats.inspected, quality);
    }
    
    async function saveGameScoreAndShowLeaderboard(good, total, quality) {
      // Nouveau système de scoring:
      // - 10 points par bonne réponse
      // - -20 par mauvaise (min 0)
      // - Bonus combo: +5, +10, +15, +20... tous les 5
      
      let score = 0;
      let currentCombo = 0;
      
      // Recalculer le score avec le nouveau système
      // On va l'estimer basé sur good/total
      // Score par bonne réponse
      score = good * 10;
      
      // Pénalité par mauvaise réponse
      let wrong = total - good;
      score = Math.max(0, score - (wrong * 20));
      
      // Bonus pour les combos (on estime: toutes les 5 bonnes réponses)
      let combos = Math.floor(good / 5);
      for (let i = 1; i <= combos; i++) {
        score += (i * 5);
      }
      
      // Capper le score au max possible (2700)
      score = Math.min(score, 2700);
      
      // Recalculer le grade selon les nouvelles zones
      const grade = calculateGradeFromScore(score);
      const playerName = FIRST_playerName || 'Anonymous';
      
      
      // Objet de score à sauvegarder
      const gameScore = {
        name: playerName,
        score: score,
        grade: grade,
        good: good,
        total: total,
        quality: quality,
        timestamp: new Date().toISOString()
      };
      
      // Sauvegarder localement d'abord (toujours)
      try {
        const scores = JSON.parse(localStorage.getItem('gameScores')) || [];
        scores.unshift(gameScore);
        localStorage.setItem('gameScores', JSON.stringify(scores.slice(0, 100))); // Garder les 100 derniers
      } catch (e) {
        console.error('Erreur localStorage:', e);
      }
      
      // Essayer de sauvegarder sur Supabase
      try {
        const { error } = await supabase
          .from('leaderboard')
          .insert([gameScore]);
        
        if (error) {
          console.warn('⚠️ Supabase indisponible, utilisé localStorage');
          window.lastSupabaseSuccess = false;
        } else {
          window.lastSupabaseSuccess = true;  // ✅ Supabase fonctionne!
        }
      } catch (err) {
        console.warn('⚠️ Supabase indisponible, utilisé localStorage');
        window.lastSupabaseSuccess = false;
      }
      
      // Afficher la page leaderboard
      await showLeaderboardPage(gameScore);
    }
    
    
    function displaySourceIcon() {
      // Par défaut: 💻 (localStorage) - C'EST LE COMPORTEMENT PAR DÉFAUT!
      let icon = '💻';
      let tooltip = 'Données locales (localStorage) - Cliquez pour actualiser';
      
      // SEULEMENT afficher ☁️ si Supabase a VRAIMENT fonctionné
      if (window.lastSupabaseSuccess === true) {
        icon = '☁️';
        tooltip = 'Données cloud (Supabase) - Cliquez pour actualiser';
      }
      
      const iconEl = document.getElementById('leaderboardSourceIcon');
      if (iconEl) {
        iconEl.textContent = icon;
        iconEl.title = tooltip;
      }
      
      // Mettre à jour le timestamp
      const date = new Date();
      const day = String(date.getDate()).padStart(2, '0');
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const year = String(date.getFullYear()).slice(-2);
      const hours = String(date.getHours()).padStart(2, '0');
      const mins = String(date.getMinutes()).padStart(2, '0');
      const secs = String(date.getSeconds()).padStart(2, '0');
      
      const timestampEl = document.getElementById('leaderboardUpdateTime');
      if (timestampEl) {
        timestampEl.textContent = `Updated ${day}/${month}/${year} ${hours}:${mins}:${secs}`;
      }
    }

    async function showLeaderboardPage(currentScore) {
      // Masquer le jeu
      document.getElementById('rulesOverlay').classList.add('hidden');
      
      // Afficher la page leaderboard (avec display flex)
      const leaderboardPage = document.getElementById('leaderboardPage');
      if (leaderboardPage) {
        leaderboardPage.style.display = 'flex';
        leaderboardPage.style.alignItems = 'center';
        leaderboardPage.style.justifyContent = 'center';
      } else {
        console.error('❌ leaderboardPage non trouvée');
      }
      
      // Mettre à jour les infos du joueur actuel
      updatePlayerInfo(currentScore);
      
      // Charger et afficher le leaderboard
      await loadAndDisplayLeaderboard();
      
      // Dessiner les graphiques de qualité - avec vérification
      try {
        if (typeof drawQualityChart === 'function') {
          drawQualityChart();
        }
      } catch(e) {
        console.warn('⚠️ drawQualityChart non disponible:', e);
      }
      
      try {
        if (typeof drawGaussianChart === 'function') {
          drawGaussianChart();
        }
      } catch(e) {
        console.warn('⚠️ drawGaussianChart non disponible:', e);
      }
      
      // Afficher l'icône source
      displaySourceIcon();
    }
    
    function updatePlayerInfo(score) {
      // Mapping des grades vers les textes complets et emojis
      const gradeTexts = {
        'S': 'STYLISH!',
        'A': 'ABSOLUTE!',
        'B': 'BRAVO!',
        'C': 'COOL!',
        'D': 'DULL!',
        'E': 'EMPTY!'
      };
      
      const gradeEmojis = {
        'S': '👑',
        'A': '⭐',
        'B': '🎯',
        'C': '💪',
        'D': '👌',
        'E': '🤔'
      };
      
      document.getElementById('playerNameScore').textContent = score.name;
      document.getElementById('scoreGrade').textContent = gradeTexts[score.grade] || score.grade;
      document.getElementById('scoreValue').textContent = score.score;
      document.getElementById('scoreRatio').textContent = `${score.good}/${score.total} = ${score.quality}%`;
      document.getElementById('resultsTotal').textContent = `${score.good}/${score.total}`;
      
      // Ajouter l'emoji du grade
      const scoreEmojiEl = document.querySelector('.score-emoji');
      if (scoreEmojiEl) {
        scoreEmojiEl.textContent = gradeEmojis[score.grade] || '🎮';
      }
      
      // Colorier le scoreLabel (COOL!, STYLISH!, etc.) selon le grade
      const scoreLabel = document.getElementById('scoreGrade');
      if (scoreLabel) {
        scoreLabel.classList.remove('rank-s', 'rank-a', 'rank-b', 'rank-c', 'rank-d', 'rank-e');
        scoreLabel.classList.add('rank-' + score.grade.toLowerCase());
      }
      
      const rankMap = { 'S': 'rank-s', 'A': 'rank-a', 'B': 'rank-b', 'C': 'rank-c', 'D': 'rank-d', 'E': 'rank-e' };
      const rankClass = rankMap[score.grade];
      
      // ÉTAPE 1: Retirer la classe 'active-rank' de TOUS les rangs (anciens et nouveaux)
      document.querySelectorAll('#leaderboardPage .rank-letter').forEach(el => {
        el.classList.remove('active-rank');
      });
      document.querySelectorAll('#leaderboardPage .rank-word-cell').forEach(el => {
        el.classList.remove('active-rank');
      });
      document.querySelectorAll('#leaderboardPage .rank-row').forEach(el => {
        el.classList.remove('active-rank');
      });
      
      // ÉTAPE 2: Ajouter la classe 'active-rank' au rang obtenu SEULEMENT
      if (rankClass) {
        const rankLetter = document.querySelector(`#leaderboardPage .rank-letter.${rankClass}`);
        const rankWord = document.querySelector(`#leaderboardPage .rank-word-cell.${rankClass}-word`);
        const rankRow = document.querySelector(`#leaderboardPage .rank-row.${rankClass}-row`);
        
        if (rankLetter) {
          rankLetter.classList.add('active-rank');
        }
        if (rankWord) {
          rankWord.classList.add('active-rank');
        }
        if (rankRow) {
          rankRow.classList.add('active-rank');
        }
      }
      
      // Générer les résultats en format horizontal plus clair
      let resultEmojis = '';
      for (let i = 0; i < score.total; i += 5) {
        resultEmojis += '<div class="result-group">';
        for (let j = 0; j < 5 && i + j < score.total; j++) {
          const emoji = i + j < score.good ? '✔' : '✖';
          const className = i + j < score.good ? 'success' : 'error';
          resultEmojis += `<span class="result-emoji ${className}">${emoji}</span>`;
        }
        resultEmojis += '</div>';
      }
      document.getElementById('resultsEmojis').innerHTML = resultEmojis;
    }
    
    async function loadAndDisplayLeaderboard() {
      let leaderboardData = [];
      
      // Essayer Supabase d'abord
      try {
        const { data, error } = await supabase
          .from('leaderboard')
          .select('*')
          .order('score', { ascending: false })
          .limit(12);
        
        if (!error && data) {
          leaderboardData = data;
          window.lastSupabaseSuccess = true;  // ✅ Supabase fonctionne!
        }
      } catch (err) {
        console.warn('⚠️ Supabase indisponible');
        window.lastSupabaseSuccess = false;
      }
      
      // Si Supabase est vide, utiliser localStorage
      if (leaderboardData.length === 0) {
        try {
          leaderboardData = JSON.parse(localStorage.getItem('gameScores')) || [];
          window.lastSupabaseSuccess = false;  // ❌ On utilise localStorage
        } catch (e) {
          console.error('Erreur localStorage:', e);
        }
      }
      
      // Afficher le leaderboard
      const leaderboardPanel = document.querySelector('#leaderboardPage .right-panel');
      if (leaderboardPanel && leaderboardData.length > 0) {
        let html = '';
        leaderboardData.slice(0, 12).forEach((entry, index) => {
          const isTop3 = index < 3;
          const medals = ['🥇', '🥈', '🥉', '🎖️'];
          const medal = medals[Math.min(index, 3)];
          
          // Formater la date
          const date = new Date(entry.timestamp || entry.created_at);
          const dateStr = date.toLocaleDateString('fr-FR') + ' ' + date.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
          
          html += `<div class="leaderboard-row ${isTop3 ? 'top-3' : ''}">
            <div class="leaderboard-rank">#${index + 1}</div>
            <div class="leaderboard-medal">${medal}</div>
            <div class="leaderboard-name">${entry.name || 'Anonymous'}</div>
            <div class="leaderboard-score">${entry.score}</div>
            <div class="leaderboard-grade">${entry.grade}</div>
            <div class="leaderboard-date">${dateStr}</div>
          </div>`;
        });
        leaderboardPanel.innerHTML = html;
      }
    }
    
    function calculateGradeFromScore(score) {
      // Zones équidistantes basées sur score max de 2700
      // 2700 ÷ 6 = 450 par zone
      if (score >= 2250) return 'S';  // STYLISH! - 2250-2700
      if (score >= 1800) return 'A';  // ABSOLUTE! - 1800-2249
      if (score >= 1350) return 'B';  // BRAVO! - 1350-1799
      if (score >= 900) return 'C';   // COOL! - 900-1349
      if (score >= 450) return 'D';   // DULL! - 450-899
      return 'E';                     // EMPTY! - 0-449
    }
    
    function calculateGrade(quality) {
      if (quality >= 90) return 'S';
      if (quality >= 80) return 'A';
      if (quality >= 70) return 'B';
      if (quality >= 60) return 'C';
      if (quality >= 50) return 'D';
      return 'E';
    }
    
    function returnToMenu() {
      
      // Masquer la page leaderboard
      const leaderboardPage = document.getElementById('leaderboardPage');
      if (leaderboardPage) leaderboardPage.style.display = 'none';
      
      // Masquer l'overlay des règles
      const rulesOverlay = document.getElementById('rulesOverlay');
      if (rulesOverlay) rulesOverlay.classList.add('hidden');
      
      // Afficher la page 1 (intro)
      const introScreen = document.getElementById('introScreenAnimated');
      if (introScreen) introScreen.style.display = 'flex';
      
      // Réinitialiser le jeu
      gameActive = false;
      gameStats = {
        responseTimes: [],
        responseTimesCorrect: [],
         inspected: 0, good: 0, wrong: 0, maxCombo: 0, totalTime: 0 };
      currentProductIndex = 0;
      revealedDefects = [];
      
      // Réinitialiser le champ de nom
      const nameInput = document.getElementById('playerNameInput');
      if (nameInput) {
        nameInput.disabled = false;
        nameInput.value = '';
      }
      
      // Désactiver le bouton START
      const startBtn = document.getElementById('openGameBtn');
      if (startBtn) {
        startBtn.disabled = true;
        startBtn.style.opacity = '0.5';
        startBtn.style.cursor = 'not-allowed';
        startBtn.textContent = '▶ OPEN INSPECTION';
      }
      
      // Réinitialiser le bouton de démarrage de la page 1
      const startGameBtn = document.getElementById('startGameBtn');
      if (startGameBtn) {
        startGameBtn.disabled = true;
        startGameBtn.style.opacity = '0.5';
      }
    }

    window.addEventListener('load', () => {
      const productTypes = ['blade', 'gearbox', 'generator', 'tower', 'foundation', 'nacelle', 'bearing', 'cable'];
      const defectTypes = [
        { name: 'Crack', severity: 'high' },
        { name: 'Corrosion', severity: 'medium' },
        { name: 'Fatigue', severity: 'high' },
        { name: 'Misalignment', severity: 'medium' },
        { name: 'Wear', severity: 'low' },
        { name: 'Deformation', severity: 'high' },
        { name: 'Rust', severity: 'medium' },
        { name: 'Fracture', severity: 'high' }
      ];
      
      allProducts = [];
      for (let i = 0; i < 30; i++) {
        const hasDefects = Math.random() > 0.4;
        const defects = [];
        
        if (hasDefects) {
          const numDefects = Math.floor(Math.random() * 3) + 1;
          for (let d = 0; d < numDefects; d++) {
            const defect = defectTypes[Math.floor(Math.random() * defectTypes.length)];
            defects.push({
              name: defect.name,
              severity: defect.severity,
              pos: {
                x: (Math.random() - 0.5) * 80,
                y: (Math.random() - 0.5) * 80
              }
            });
          }
        }
        
        allProducts.push({
          name: 'Offshore Component ' + (i + 1),
          id: i,
          type: productTypes[i % productTypes.length],
          value: 150 + Math.random() * 200,
          defects: defects
        });
      }

      // L'overlay de règles s'affiche automatiquement
      // Le jeu ne démarre que quand on clique sur "Start My Inspection"
      setupResizableDivider();
    });

    
    function drawResponseTimeChart() {
      if (!gameStats.responseTimes || gameStats.responseTimes.length === 0) return;
      
      const times = gameStats.responseTimes;
      const mean = times.reduce((a, b) => a + b, 0) / times.length;
      const variance = times.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / times.length;
      const stdDev = Math.sqrt(variance);
      
      document.getElementById('avgTime').textContent = mean.toFixed(2) + ' s';
      document.getElementById('stdDeviation').textContent = stdDev.toFixed(2) + ' s';
      
      const ctx = document.getElementById('responseTimeChart');
      if (!ctx) return;
      
      if (window.responseTimeChart) window.responseTimeChart.destroy();
      
      const timePoints = times.map((t, i) => ({ x: i + 1, y: t }));
      
      window.responseTimeChart = new Chart(ctx, {
        type: 'scatter',
        data: {
          datasets: [
            {
              label: 'Response Times',
              data: timePoints,
              backgroundColor: 'rgba(0, 168, 233, 0.5)',
              borderColor: '#00A8E9',
              borderWidth: 2,
              pointRadius: 3
            },
            {
              label: 'x̄ = ' + mean.toFixed(2) + 's',
              type: 'line',
              data: [{ x: 1, y: mean }, { x: times.length, y: mean }],
              borderColor: '#10B981',
              borderWidth: 3,
              borderDash: [5, 5],
              fill: false,
              pointRadius: 0
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: true, labels: { color: '#FFD700', font: { size: 11 } } },
            tooltip: { backgroundColor: 'rgba(0, 0, 0, 0.9)', titleColor: '#FFD700', bodyColor: '#00A8E9' }
          },
          scales: {
            x: { ticks: { color: '#00D4FF' }, grid: { color: 'rgba(0, 168, 233, 0.1)' } },
            y: { ticks: { color: '#00D4FF' }, grid: { color: 'rgba(0, 168, 233, 0.1)' } }
          }
        }
      });
    }

    function setupResizableDivider() {
      const gameZone = document.getElementById('gameZone');
      const divider = document.createElement('div');
      divider.className = 'resizableDivider';
      divider.id = 'resizableDivider';
      document.body.appendChild(divider);

      updateDividerPosition();

      let isResizing = false;
      let startX = 0;

      divider.addEventListener('mousedown', (e) => {
        isResizing = true;
        startX = e.clientX;
        document.body.style.userSelect = 'none';
      });

      document.addEventListener('mousemove', (e) => {
        if (!isResizing) return;

        const diff = e.clientX - startX;
        const gameRect = gameZone.getBoundingClientRect();
        
        const kpiZone = document.getElementById('kpiZone');
        const currentKpiPercent = (kpiZone.offsetWidth / gameRect.width) * 100;
        const newKpiPercent = Math.max(12, Math.min(40, currentKpiPercent - (diff / gameRect.width) * 100));
        
        const inspectionPercent = 100 - newKpiPercent;
        gameZone.style.gridTemplateColumns = `${inspectionPercent}fr ${newKpiPercent}%`;
        updateDividerPosition();
        startX = e.clientX;
      });

      document.addEventListener('mouseup', () => {
        isResizing = false;
        document.body.style.userSelect = 'auto';
      });

      window.addEventListener('resize', updateDividerPosition);
    }

    function updateDividerPosition() {
      const divider = document.getElementById('resizableDivider');
      const kpiZone = document.getElementById('kpiZone');
      if (!divider || !kpiZone) return;
      
      const kpiRect = kpiZone.getBoundingClientRect();
      divider.style.left = (kpiRect.left - 3) + 'px';
    }

    function startGame() {
      document.getElementById('rulesOverlay').classList.add('hidden');
      gameActive = true;
      gameStartTime = Date.now();
      gameStats = {
        responseTimes: [],
        responseTimesCorrect: [],
         inspected: 0, good: 0, wrong: 0, maxCombo: 0, totalTime: 0 };
      
      loadNextProduct();
      updateKPI();
      startTimer();
      setupMagnifyingGlass();
    }

    function setupMagnifyingGlass() {
      const canvas = document.getElementById('productCanvas');
      const magnifyingGlass = document.getElementById('magnifyingGlass');
      const handle = document.getElementById('magnifyingGlassHandle');
      const searchZone = document.getElementById('searchZone');

      canvas.addEventListener('mousemove', (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        // Vérifier si on est dans le canvas
        if (x >= 0 && x <= rect.width && y >= 0 && y <= rect.height) {
          magnifyingGlass.classList.add('active');
          handle.classList.add('active');
          searchZone.classList.add('active');

          // Position la loupe
          magnifyingGlass.style.left = (e.clientX - 17.5) + 'px';
          magnifyingGlass.style.top = (e.clientY - 17.5) + 'px';
          handle.style.right = (window.innerWidth - e.clientX - 15) + 'px';
          handle.style.bottom = (window.innerHeight - e.clientY - 15) + 'px';

          // Zone de recherche
          searchZone.style.left = (e.clientX + 20) + 'px';
          searchZone.style.top = (e.clientY - 20) + 'px';

          // Vérifier les défauts sous la loupe
          let defectUnder = null;
          if (currentDefects && currentDefects.length > 0) {
            currentDefects.forEach((defect, i) => {
              if (defect.pos) {
                const canvasRect = canvas.getBoundingClientRect();
                const defectScreenX = canvasRect.left + (200 + defect.pos.x);
                const defectScreenY = canvasRect.top + (150 + defect.pos.y);

                const dist = Math.hypot(e.clientX - defectScreenX, e.clientY - defectScreenY);
                if (dist < 40) {
                  defectUnder = { name: defect.name, index: i, screenX: defectScreenX, screenY: defectScreenY };
                  
                  // RÉVÉLER LE DÉFAUT
                  if (!revealedDefects.includes(i)) {
                    revealedDefects.push(i);
                    drawProduct();
                  }
                }
              }
            });
          }

          if (defectUnder) {
            searchZone.textContent = '🔍 DEFECT FOUND!';
            searchZone.style.color = '#EF4444';
            magnifyingGlass.style.boxShadow = '0 0 40px rgba(239, 68, 68, 1), inset 0 0 20px rgba(239, 68, 68, 0.5), 0 0 60px rgba(239, 68, 68, 0.6)';
            canvas.style.cursor = 'default';
            
            // Update le message du haut
            const productNum = currentProductIndex + 1;
            const status = document.getElementById('productStatus');
            status.textContent = `Scanning Product ${productNum} : Defect Found !`;
            status.style.color = '#EF4444';
          } else {
            searchZone.textContent = '🔍 Scanning...';
            searchZone.style.color = '#FFD700';
            magnifyingGlass.style.boxShadow = '0 0 20px rgba(255, 215, 0, 0.6), inset 0 0 15px rgba(255, 215, 0, 0.2)';
            canvas.style.cursor = 'default';
          }
        } else {
          magnifyingGlass.classList.remove('active');
          handle.classList.remove('active');
          searchZone.classList.remove('active');
          canvas.style.cursor = 'auto';
        }
      });

      canvas.addEventListener('mouseleave', () => {
        magnifyingGlass.classList.remove('active');
        handle.classList.remove('active');
        searchZone.classList.remove('active');
        canvas.style.cursor = 'auto';
      });
    }
  </script>


<!-- Easter Egg Overlay -->
  <div id="easterOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, rgba(10, 14, 39, 0.98) 0%, rgba(20, 30, 60, 0.98) 100%); z-index: 9999; align-items: center; justify-content: center;">
    <!-- Conteneur principal avec photo à gauche et texte à droite -->
    <div style="display: flex; align-items: center; justify-content: center; gap: 60px; max-width: 90vw; height: 90vh;">
      <!-- Photo à gauche (75% max height) -->
      <div style="position: relative; max-height: 75vh; padding: 12px; background: linear-gradient(135deg, #FFD700 0%, #FF6B00 50%, #FFD700 100%); border-radius: 20px; box-shadow: 0 0 40px rgba(255, 107, 0, 0.9), 0 0 80px rgba(255, 215, 0, 0.6), inset 0 0 30px rgba(255, 215, 0, 0.4); animation: glow-pulse 2s ease-in-out infinite;">
        <img src="./img/qualiteam.jpg" style="max-height: calc(75vh - 24px); width: auto; border-radius: 12px; display: block; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);">
      </div>
      
      <!-- Texte à droite avec animation derrière -->
      <div style="text-align: center; color: white; position: relative; z-index: 2;">
        <!-- Animation derrière le texte -->
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 300px; height: 300px; background: radial-gradient(circle, rgba(255, 107, 0, 0.3) 0%, rgba(255, 215, 0, 0.2) 40%, transparent 70%); border-radius: 50%; animation: pulse-glow 2s ease-in-out infinite; z-index: -1; filter: blur(20px);"></div>
        
        <h2 style="font-size: 3rem; font-weight: 900; margin-bottom: 20px; text-shadow: 0 0 20px rgba(255, 107, 0, 0.8), 0 0 40px rgba(255, 215, 0, 0.6), 0 4px 15px rgba(0, 0, 0, 0.5); animation: text-pulse 1.5s infinite; background: linear-gradient(135deg, #FFD700, #FF6B00, #FFD700); background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Made with Love 💗</h2>
        
        <p style="font-size: 2.2rem; font-weight: 700; letter-spacing: 3px; text-shadow: 0 0 15px rgba(255, 107, 0, 0.7), 0 0 30px rgba(255, 215, 0, 0.5), 0 3px 10px rgba(0, 0, 0, 0.4); color: #FFD700; animation: text-pulse 1.5s infinite 0.5s;">QualiTeam 💗</p>
      </div>
    </div>
    
    <!-- Conteneur des feux d'artifice -->
    <div id="fireworksContainer" style="position: absolute; width: 100%; height: 100%; pointer-events: none; z-index: 1;"></div>
  </div>

  <style>
    @keyframes glow-pulse {
      0%, 100% {
        box-shadow: 0 0 40px rgba(255, 107, 0, 0.9), 0 0 80px rgba(255, 215, 0, 0.6), inset 0 0 30px rgba(255, 215, 0, 0.4);
      }
      50% {
        box-shadow: 0 0 60px rgba(255, 107, 0, 1), 0 0 120px rgba(255, 215, 0, 0.8), inset 0 0 40px rgba(255, 215, 0, 0.6);
      }
    }
    
    @keyframes pulse-glow {
      0%, 100% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 0.6;
      }
      50% {
        transform: translate(-50%, -50%) scale(1.2);
        opacity: 0.9;
      }
    }
    
    @keyframes text-pulse {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.05);
      }
    }
  </style>

    <!-- LEADERBOARD PAGE -->
  <div id="leaderboardPage" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #0254A0 0%, #00A8E9 100%); align-items: center; justify-content: center; z-index: 10000;">
    <div class="leaderboard-container">
        <div class="header-section">
            <h1 style="display: flex; align-items: center; justify-content: center; gap: 10px;">
              <span>🏆 LEADERBOARD</span>
              <span id="leaderboardSourceIcon" style="font-size: 1.2rem; cursor: pointer; transition: transform 0.3s;" title="Source des données - Cliquez pour actualiser" onclick="event.stopPropagation(); this.style.transform='rotate(360deg)'; setTimeout(() => this.style.transform='rotate(0deg)', 500); loadAndDisplayLeaderboard();">💻</span>
            </h1>
            <div style="position: absolute; top: 0; right: 120px; font-size: 0.65rem; color: #FFD700; font-weight: 700; background: rgba(255, 215, 0, 0.12); padding: 5px 12px; border-radius: 20px; border: 1.5px solid rgba(255, 215, 0, 0.3);">
              <span id="leaderboardUpdateTime">--:--:--</span>
            </div>
            <button class="play-again-btn" onclick="returnToMenu()">▶ AGAIN</button>
        </div>

        <div class="main-layout">
            <!-- LEFT PANEL -->
            <div class="left-panel">
                <div class="well-done">Well Done! 👍</div>

                <div class="ranks-results-container">
                    <!-- TABLE RANGS -->
                    <div class="ranks-table-list">
                        <div class="rank-row rank-s-row">
                            <span class="rank-emoji">👑</span>
                            <span class="rank-letter rank-s">S</span>
                            <span class="rank-range">2250-2700</span>
                            <span class="rank-word rank-s-word">STYLISH!</span>
                        </div>
                        <div class="rank-row rank-a-row">
                            <span class="rank-emoji">⭐</span>
                            <span class="rank-letter rank-a">A</span>
                            <span class="rank-range">1800-2249</span>
                            <span class="rank-word rank-a-word">ABSOLUTE!</span>
                        </div>
                        <div class="rank-row rank-b-row">
                            <span class="rank-emoji">🎯</span>
                            <span class="rank-letter rank-b">B</span>
                            <span class="rank-range">1350-1799</span>
                            <span class="rank-word rank-b-word">BRAVO!</span>
                        </div>
                        <div class="rank-row rank-c-row">
                            <span class="rank-emoji">💪</span>
                            <span class="rank-letter rank-c">C</span>
                            <span class="rank-range">900-1349</span>
                            <span class="rank-word rank-c-word">COOL!</span>
                        </div>
                        <div class="rank-row rank-d-row">
                            <span class="rank-emoji">👌</span>
                            <span class="rank-letter rank-d">D</span>
                            <span class="rank-range">450-899</span>
                            <span class="rank-word rank-d-word">DULL!</span>
                        </div>
                        <div class="rank-row rank-e-row">
                            <span class="rank-emoji">🤔</span>
                            <span class="rank-letter rank-e">E</span>
                            <span class="rank-range">0-449</span>
                            <span class="rank-word rank-e-word">EMPTY!</span>
                        </div>
                    </div>

                    <!-- SCORE BOX -->
                    <div class="ranks-score-box">
                        <span class="player-name-score" id="playerNameScore">-</span>
                        <span class="score-emoji"></span>
                        <span class="score-label" id="scoreGrade"></span>
                        <span class="score-value" id="scoreValue"></span>
                        <span class="score-ratio" id="scoreRatio"></span>
                    </div>
                </div>

                <!-- RESULTS BOX -->
                <div class="ranks-results-box">
                    <div class="results-title">RESULTS: <span id="resultsTotal">0/0</span></div>
                    <div class="results-list" id="resultsEmojis">
                        <!-- Will be filled by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- RIGHT PANEL: GRAPHIQUES + LEADERBOARD -->
            <div class="right-panel">
                <div style="background: rgba(0, 0, 0, 0.3); border: 2px solid #FFD700; border-radius: 8px; padding: 12px; margin-bottom: 12px; text-align: center; color: #00D4FF; font-weight: 700; font-size: 0.9rem;">
                    <div>⏱️ Avg Time: <span id="avgTime">--</span></div>
                    <div>📊 Std Dev: <span id="stdDeviation">--</span></div>
                </div>
                <div style="background: rgba(0, 0, 0, 0.3); border: 2px solid #00A8E9; border-radius: 8px; padding: 12px; margin-bottom: 12px; height: 320px;">
                    <div style="color: #00D4FF; font-weight: 900; margin-bottom: 8px; font-size: 0.9rem;">📈 RESPONSE TIME (Correct Only)</div>
                    <canvas id="responseTimeChart" width="100" height="50"></canvas>
                </div>
                <div style="background: rgba(0, 0, 0, 0.3); border: 2px solid #FF6B00; border-radius: 8px; padding: 12px; margin-bottom: 12px; height: 320px;">
                    <div style="color: #FF6B00; font-weight: 900; margin-bottom: 8px; font-size: 0.9rem;">🔔 GAUSSIAN DISTRIBUTION (σ Spread)</div>
                    <canvas id="gaussChart" width="100" height="50"></canvas>
                </div>
                <div style="color: #FFD700; font-weight: 900; margin-bottom: 8px; font-size: 0.9rem;">📊 LEADERBOARD TOP 20:</div>
                <div style="flex: 1; overflow-y: auto;">
                    <div class="leaderboard-row top-3">
                        <div class="leaderboard-rank"></div>
                        <div class="leaderboard-medal"></div>
                        <div class="leaderboard-name"></div>
                        <div class="leaderboard-score"></div>
                        <div class="leaderboard-grade"></div>
                        <div class="leaderboard-date"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js">
    function drawGaussianChart() {
      if (!gameStats.responseTimesCorrect || gameStats.responseTimesCorrect.length === 0) return;
      
      // Utiliser UNIQUEMENT les temps de réponse CORRECTS
      const correctTimes = gameStats.responseTimesCorrect;
      const mean = correctTimes.reduce((a, b) => a + b) / correctTimes.length;
      const variance = correctTimes.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / correctTimes.length;
      const stdDev = Math.sqrt(variance);
      
      // Générer les points de la courbe de Gauss
      const gaussPoints = [];
      const xMin = Math.max(0, mean - 3 * stdDev);
      const xMax = mean + 3 * stdDev;
      const step = (xMax - xMin) / 100;
      
      for (let x = xMin; x <= xMax; x += step) {
        // Formule de la distribution normale: f(x) = (1/(σ√(2π))) * e^(-(x-μ)²/(2σ²))
        const coefficient = 1 / (stdDev * Math.sqrt(2 * Math.PI));
        const exponent = -Math.pow(x - mean, 2) / (2 * stdDev * stdDev);
        const y = coefficient * Math.exp(exponent);
        gaussPoints.push({ x: x.toFixed(2), y: y.toFixed(6) });
      }
      
      const ctx = document.getElementById('gaussChart');
      if (!ctx) return;
      
      // Détruire le graphique existant
      if (window.gaussChart) {
        window.gaussChart.destroy();
      }
      
      const maxY = 1 / (stdDev * Math.sqrt(2 * Math.PI));
      
      window.gaussChart = new Chart(ctx, {
        type: 'line',
        data: {
          datasets: [
            {
              label: 'Distribution (μ = ' + mean.toFixed(2) + 's)',
              data: gaussPoints,
              borderColor: '#FF6B00',
              borderWidth: 3,
              backgroundColor: 'rgba(255, 107, 0, 0.15)',
              fill: true,
              pointRadius: 0,
              tension: 0.4
            },
            {
              label: 'Mean (μ)',
              type: 'line',
              data: [
                { x: mean.toFixed(2), y: 0 },
                { x: mean.toFixed(2), y: maxY }
              ],
              borderColor: '#10B981',
              borderWidth: 3,
              borderDash: [8, 4],
              pointRadius: 0,
              fill: false
            },
            {
              label: '+σ = ' + (mean + stdDev).toFixed(2) + 's',
              type: 'line',
              data: [
                { x: (mean + stdDev).toFixed(2), y: 0 },
                { x: (mean + stdDev).toFixed(2), y: maxY * Math.exp(-0.5) }
              ],
              borderColor: '#FF69B4',
              borderWidth: 2,
              borderDash: [4, 4],
              pointRadius: 0,
              fill: false
            },
            {
              label: '-σ = ' + Math.max(0, mean - stdDev).toFixed(2) + 's',
              type: 'line',
              data: [
                { x: Math.max(0, mean - stdDev).toFixed(2), y: 0 },
                { x: Math.max(0, mean - stdDev).toFixed(2), y: maxY * Math.exp(-0.5) }
              ],
              borderColor: '#FF69B4',
              borderWidth: 2,
              borderDash: [4, 4],
              pointRadius: 0,
              fill: false
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: true,
              labels: {
                color: '#FFD700',
                font: { weight: 'bold', size: 11 },
                padding: 12
              }
            },
            tooltip: {
              backgroundColor: 'rgba(0, 0, 0, 0.8)',
              titleColor: '#FF6B00',
              bodyColor: '#10B981',
              borderColor: '#FF6B00',
              borderWidth: 1,
              callbacks: {
                label: function(context) {
                  return 'σ = ' + stdDev.toFixed(3);
                }
              }
            }
          },
          scales: {
            x: {
              type: 'linear',
              title: {
                display: true,
                text: 'Response Time (seconds)',
                color: '#FFD700',
                font: { weight: 'bold', size: 12 }
              },
              ticks: {
                color: '#00D4FF',
                callback: function(value) {
                  return value.toFixed(1);
                }
              },
              grid: {
                color: 'rgba(0, 168, 233, 0.1)'
              }
            },
            y: {
              title: {
                display: true,
                text: 'Probability Density',
                color: '#FFD700',
                font: { weight: 'bold', size: 12 }
              },
              ticks: {
                color: '#00D4FF',
                callback: function(value) {
                  return (value * 100).toFixed(2) + '%';
                }
              },
              grid: {
                color: 'rgba(0, 168, 233, 0.1)'
              }
            }
          }
        }
      });
    }

  
    function drawQualityChart() {
      if (!gameStats.responseTimesCorrect || gameStats.responseTimesCorrect.length === 0) return;
      
      // Utiliser UNIQUEMENT les temps de réponse CORRECTS
      const correctTimes = gameStats.responseTimesCorrect;
      const mean = correctTimes.reduce((a, b) => a + b) / correctTimes.length;
      const variance = correctTimes.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / correctTimes.length;
      const stdDev = Math.sqrt(variance);
      
      document.getElementById('avgTime').textContent = mean.toFixed(2) + ' s';
      document.getElementById('stdDeviation').textContent = stdDev.toFixed(2) + ' s';
      
      const ctx = document.getElementById('responseTimeChart');
      if (!ctx || !window.Chart) return;
      
      if (window.responseTimeChart) window.responseTimeChart.destroy();
      
      // Créer les points avec index comme X (jusqu'à 120s max sur l'axe)
      const timePoints = correctTimes.map((t, i) => ({ x: i + 1, y: t }));
      
      window.responseTimeChart = new Chart(ctx, {
        type: 'scatter',
        data: {
          datasets: [
            {
              label: 'Inspection Times (Correct)',
              data: timePoints,
              backgroundColor: 'rgba(0, 168, 233, 0.6)',
              borderColor: '#00A8E9',
              borderWidth: 2,
              pointRadius: 4,
              pointHoverRadius: 6
            },
            {
              label: 'Mean (x̄) = ' + mean.toFixed(2) + 's',
              type: 'line',
              data: [{ x: 1, y: mean }, { x: correctTimes.length, y: mean }],
              borderColor: '#10B981',
              borderWidth: 3,
              borderDash: [8, 4],
              fill: false,
              pointRadius: 0
            },
            {
              label: 'σ = ' + stdDev.toFixed(2) + 's',
              type: 'line',
              data: [
                { x: 1, y: mean + stdDev },
                { x: correctTimes.length, y: mean + stdDev }
              ],
              borderColor: '#FF6B00',
              borderWidth: 1,
              borderDash: [3, 3],
              fill: false,
              pointRadius: 0
            },
            {
              label: 'σ lower',
              type: 'line',
              data: [
                { x: 1, y: Math.max(0, mean - stdDev) },
                { x: correctTimes.length, y: Math.max(0, mean - stdDev) }
              ],
              borderColor: '#FF6B00',
              borderWidth: 1,
              borderDash: [3, 3],
              fill: false,
              pointRadius: 0
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { 
              labels: { 
                color: '#FFD700', 
                font: { size: 11, weight: 'bold' },
                padding: 10
              } 
            },
            tooltip: { 
              backgroundColor: 'rgba(0,0,0,0.8)', 
              titleColor: '#00A8E9', 
              bodyColor: '#10B981',
              borderColor: '#00A8E9',
              borderWidth: 1
            }
          },
          scales: {
            x: { 
              title: { display: true, text: 'Inspection #', color: '#FFD700', font: { weight: 'bold' } }, 
              ticks: { color: '#00D4FF' }, 
              grid: { color: 'rgba(0,168,233,0.1)' } 
            },
            y: { 
              title: { display: true, text: 'Time (seconds)', color: '#FFD700', font: { weight: 'bold' } }, 
              max: 120,
              ticks: { color: '#00D4FF' }, 
              grid: { color: 'rgba(0,168,233,0.1)' } 
            }
          }
        }
      });
    }

  </script>
</body>

</html>